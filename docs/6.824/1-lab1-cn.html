<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Lab 1 (Chinese) - everystep</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../favicon.svg">
    <link rel="shortcut icon" href="../favicon.png">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/chrome.css">
    <link rel="stylesheet" href="../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../highlight.css">
    <link rel="stylesheet" href="../tomorrow-night.css">
    <link rel="stylesheet" href="../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../theme/style.css">


</head>
<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">ç®€ä»‹</a></li><li class="chapter-item affix "><li class="part-title">ğŸ­ æ“ä½œç³»ç»Ÿ</li><li class="spacer"></li><li class="chapter-item "><a href="../6.S081/0-summary.html"><strong aria-hidden="true">1.</strong> 6.S081</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../6.S081/1-lab1.html"><strong aria-hidden="true">1.1.</strong> Lab 1</a></li><li class="chapter-item "><a href="../6.S081/2-lab2.html"><strong aria-hidden="true">1.2.</strong> Lab 2</a></li><li class="chapter-item "><a href="../6.S081/3-lab3.html"><strong aria-hidden="true">1.3.</strong> Lab 3</a></li><li class="chapter-item "><a href="../6.S081/4-lab4.html"><strong aria-hidden="true">1.4.</strong> Lab 4</a></li><li class="chapter-item "><a href="../6.S081/5-lab5.html"><strong aria-hidden="true">1.5.</strong> Lab 5</a></li><li class="chapter-item "><a href="../6.S081/6-lab6.html"><strong aria-hidden="true">1.6.</strong> Lab 6</a></li><li class="chapter-item "><a href="../6.S081/7-lab7.html"><strong aria-hidden="true">1.7.</strong> Lab 7</a></li><li class="chapter-item "><a href="../6.S081/8-lab8.html"><strong aria-hidden="true">1.8.</strong> Lab 8</a></li><li class="chapter-item "><a href="../6.S081/9-lab9.html"><strong aria-hidden="true">1.9.</strong> Lab 9</a></li><li class="chapter-item "><a href="../6.S081/10-lab10.html"><strong aria-hidden="true">1.10.</strong> Lab 10</a></li><li class="chapter-item "><a href="../6.S081/11-lab11.html"><strong aria-hidden="true">1.11.</strong> Lab 11</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸš€ æ•°æ®åº“</li><li class="spacer"></li><li class="chapter-item "><a href="../bitcask/index.html"><strong aria-hidden="true">2.</strong> ä»é›¶å®ç° BitCask å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.1.</strong> BitCask ç®€ä»‹</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.2.</strong> åˆ›å»º C++ é¡¹ç›®</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.3.</strong> æ•°æ®åœ¨å†…å­˜ä¸­</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.4.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Š</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.5.</strong> BenchMark</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.6.</strong> å®ç°åˆå¹¶</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.7.</strong> å®ç°åƒåœ¾å›æ”¶</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.8.</strong> hintfile å®ç°</a></li><li class="chapter-item "><a href="../bitcask/p1.html"><strong aria-hidden="true">2.9.</strong> å“ˆå¸Œè¡¨ä¼˜åŒ–ä¸ºå¤šçº¿ç¨‹</a></li><li class="chapter-item "><a href="../bitcask/ch1.html"><strong aria-hidden="true">2.10.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Šå¦‚ä½•å­˜æ”¾ï¼Ÿ</a></li><li class="chapter-item "><a href="../bitcask/ch2.html"><strong aria-hidden="true">2.11.</strong> å­˜å‚¨å¼•æ“çš„æ¥å£è®¾è®¡</a></li><li class="chapter-item "><a href="../bitcask/ch3.html"><strong aria-hidden="true">2.12.</strong> å®ç° Setã€Get</a></li><li class="chapter-item "><a href="../bitcask/ch4.html"><strong aria-hidden="true">2.13.</strong> åˆ é™¤é€»è¾‘å’Œ Compact </a></li></ol></li><li class="chapter-item "><a href="../abyssdb/p0.html"><strong aria-hidden="true">3.</strong> ä»é›¶å®ç°å…³ç³»å‹æ•°æ®åº“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../abyssdb/p1.html"><strong aria-hidden="true">3.1.</strong> ä» Table å¼€å§‹</a></li><li class="chapter-item "><a href="../abyssdb/p2.html"><strong aria-hidden="true">3.2.</strong> Part 2. å®ç° Tuple</a></li><li class="chapter-item "><a href="../abyssdb/p3.html"><strong aria-hidden="true">3.3.</strong> Part 3. å®ç° Page</a></li><li class="chapter-item "><a href="../abyssdb/p4.html"><strong aria-hidden="true">3.4.</strong> Part 4. å®ç° HeapFile</a></li><li class="chapter-item "><a href="../abyssdb/p5.html"><strong aria-hidden="true">3.5.</strong> Part 5. å®ç° BufferPool</a></li><li class="chapter-item "><a href="../abyssdb/p6.html"><strong aria-hidden="true">3.6.</strong> Part 6. æ”¯æŒ int å’Œ string ç­‰æ•°æ®ç±»å‹ã€‚</a></li><li class="chapter-item "><a href="../abyssdb/p7.html"><strong aria-hidden="true">3.7.</strong> Part 7. å®ç° Catalog</a></li></ol></li><li class="chapter-item "><a href="../6.830/1-lab0.html"><strong aria-hidden="true">4.</strong> 6.830</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../6.830/ans/2-lab1-ans.html"><strong aria-hidden="true">4.1.</strong> Lab 1 Answers</a></li><li class="chapter-item "><a href="../6.830/ans/3-lab2-ans.html"><strong aria-hidden="true">4.2.</strong> Lab 2 Answers</a></li><li class="chapter-item "><a href="../6.830/ans/4-lab3-ans.html"><strong aria-hidden="true">4.3.</strong> Lab 3 Answers</a></li><li class="chapter-item "><a href="../6.830/ans/5-lab4-ans.html"><strong aria-hidden="true">4.4.</strong> Lab 4 Answers</a></li><li class="chapter-item "><a href="../6.830/ans/6-lab5-ans.html"><strong aria-hidden="true">4.5.</strong> Lab 5 Answers</a></li><li class="chapter-item "><a href="../6.830/ans/7-lab6-ans.html"><strong aria-hidden="true">4.6.</strong> Lab 6 Answers</a></li><li class="chapter-item "><a href="../6.830/cn/2-lab1.html"><strong aria-hidden="true">4.7.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item "><a href="../6.830/cn/3-lab2.html"><strong aria-hidden="true">4.8.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../6.830/cn/4-lab3.html"><strong aria-hidden="true">4.9.</strong> Lab 3 (Chinese)</a></li><li class="chapter-item "><a href="../6.830/cn/5-lab4.html"><strong aria-hidden="true">4.10.</strong> Lab 4 (Chinese)</a></li><li class="chapter-item "><a href="../6.830/cn/6-lab5.html"><strong aria-hidden="true">4.11.</strong> Lab 5 (Chinese)</a></li><li class="chapter-item "><a href="../6.830/cn/7-lab6.html"><strong aria-hidden="true">4.12.</strong> Lab 6 (Chinese)</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ§Š åˆ†å¸ƒå¼</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../6.824/0-lab0.html"><strong aria-hidden="true">5.</strong> 6.824</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../6.824/1-lab1-cn.html" class="active"><strong aria-hidden="true">5.1.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item "><a href="../6.824/1-lab1.html"><strong aria-hidden="true">5.2.</strong> Lab 1</a></li><li class="chapter-item "><a href="../6.824/2-lab2-cn.html"><strong aria-hidden="true">5.3.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../6.824/2-lab2.html"><strong aria-hidden="true">5.4.</strong> Lab 2</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ”¥ å…¶ä»–</li><li class="spacer"></li><li class="chapter-item "><a href="../6.828/0-sum.html"><strong aria-hidden="true">6.</strong> 6.828</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../6.828/1-env.html"><strong aria-hidden="true">6.1.</strong> Environment Setup</a></li><li class="chapter-item "><a href="../6.828/1-part1.html"><strong aria-hidden="true">6.2.</strong> Part 1</a></li></ol></li><li class="chapter-item "><a href="../review/1_go.html"><strong aria-hidden="true">7.</strong> å…«è‚¡</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../review/2_cpp.html"><strong aria-hidden="true">7.1.</strong> C++</a></li><li class="chapter-item "><a href="../review/3_cn.html"><strong aria-hidden="true">7.2.</strong> Computer Networks</a></li></ol></li><li class="chapter-item "><a href="../lsm/index.html"><strong aria-hidden="true">8.</strong> ä»é›¶å®ç° LSM-Tree å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../lsm/ch1.html"><strong aria-hidden="true">8.1.</strong> Part 1</a></li><li class="chapter-item "><a href="../lsm/ch2.html"><strong aria-hidden="true">8.2.</strong> Part 2</a></li><li class="chapter-item "><a href="../lsm/ch3.html"><strong aria-hidden="true">8.3.</strong> Part 3</a></li><li class="chapter-item "><a href="../lsm/ch4.html"><strong aria-hidden="true">8.4.</strong> Part 4</a></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">everystep</h1>

                <div class="right-buttons">
                    <a href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep/edit/master/src/6.824/1-lab1-cn.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');

                // Get viewed page store
                var viewed_key = 'mdbook-viewed';
                var viewed_map = {};
                try {
                    var viewed_storage = localStorage.getItem(viewed_key);
                    if (viewed_storage) {
                        viewed_map = JSON.parse(viewed_storage)
                    }
                } catch (e) { }

                Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);

                    // Apply viewed style
                    if (viewed_map[link.pathname]) {
                        link.classList.add('md-viewed')
                    }
                }); 

                // Mark viewed after 30s
                setTimeout(function() {
                    viewed_map[location.pathname] = 1;
                    localStorage.setItem(viewed_key, JSON.stringify(viewed_map));
                }, 30000)
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc"><nav class="pagetoc"></nav></div>
                <main>
                    <h1 id="lab-1-mapreduce-ç¿»è¯‘"><a class="header" href="#lab-1-mapreduce-ç¿»è¯‘">Lab 1: MapReduce ç¿»è¯‘</a></h1>
<p>Due: Friday Feb 11 23:59ET (MIT Time)
Collaboration policy // Submit lab // Setup Go // Guidance // Piazza</p>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>In this lab you'll build a MapReduce system. You'll implement a worker process that calls application Map and Reduce functions and handles reading and writing files, and a coordinator process that hands out tasks to workers and copes with failed workers. You'll be building something similar to the MapReduce paper. (Note: this lab uses &quot;coordinator&quot; instead of the paper's &quot;master&quot;.)</p>
<p>åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªMapReduceç³»ç»Ÿã€‚æ‚¨å°†å®ç°ä¸€ä¸ªè°ƒç”¨åº”ç”¨ç¨‹åºMapå’ŒReduceå‡½æ•°å¹¶å¤„ç†è¯»å†™æ–‡ä»¶çš„å·¥ä½œè¿›ç¨‹ï¼Œä»¥åŠä¸€ä¸ªå°†ä»»åŠ¡åˆ†é…ç»™å·¥ä½œäººå‘˜å¹¶å¤„ç†å¤±è´¥å·¥ä½œäººå‘˜çš„åè°ƒè¿›ç¨‹ã€‚æ‚¨å°†æ„å»ºç±»ä¼¼äºMapReduceè®ºæ–‡çš„ä¸œè¥¿ã€‚ï¼ˆæ³¨æ„ï¼šè¿™ä¸ªå®éªŒä½¿ç”¨â€œåè°ƒè€…â€è€Œä¸æ˜¯è®ºæ–‡çš„â€œä¸»äººâ€ã€‚ï¼‰</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h2>
<p>You need to setup Go to do the labs.</p>
<p>ä½ éœ€è¦è®¾ç½®Goæ¥åšå®éªŒå®¤ã€‚</p>
<p>Fetch the initial lab software with git (a version control system). To learn more about git, look at the Pro Git book or the git user's manual.</p>
<p>ä½¿ç”¨gitï¼ˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼‰è·å–åˆå§‹å®éªŒå®¤è½¯ä»¶ã€‚è¦äº†è§£æ›´å¤šå…³äºgitçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä¸“ä¸šGitæ‰‹å†Œæˆ–gitç”¨æˆ·æ‰‹å†Œã€‚</p>
<pre><code>$ git clone git://g.csail.mit.edu/6.824-golabs-2022 6.824
$ cd 6.824
$ ls
Makefile src
$
</code></pre>
<p>We supply you with a simple sequential mapreduce implementation in src/main/mrsequential.go. It runs the maps and reduces one at a time, in a single process. We also provide you with a couple of MapReduce applications: word-count in mrapps/wc.go, and a text indexer in mrapps/indexer.go. You can run word count sequentially as follows:</p>
<p>æˆ‘ä»¬åœ¨src/main/mrsequential.go.ä¸­ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªç®€å•çš„é¡ºåºmapReduceå®ç°ï¼Œå®ƒåœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œæ˜ å°„å¹¶ä¸€æ¬¡å‡å°‘ä¸€ä¸ªã€‚æˆ‘ä»¬è¿˜ä¸ºæ‚¨æä¾›äº†å‡ ä¸ªMapReduceåº”ç”¨ç¨‹åºï¼šmrapps/wc.goä¸­çš„å­—æ•°è®¡æ•°å’Œmrapps/indexer.go.ä¸­çš„æ–‡æœ¬ç´¢å¼•å™¨ã€‚æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹é¡ºåºè¿è¡Œå­—æ•°è®¡æ•°ï¼š</p>
<pre><code>$ cd ~/6.824
$ cd src/main
$ go build -race -buildmode=plugin ../mrapps/wc.go
$ rm mr-out*
$ go run -race mrsequential.go wc.so pg*.txt
$ more mr-out-0
A 509
ABOUT 2
ACT 8
...
...
</code></pre>
<p>(Note: the -race enables the Go race detector. We suggest you develop and test your 6.824 lab code with the race detector. When we grade your labs, we will not use the race detector. Nevertheless, if your code has races, there's a good chance it will fail when we test it even without the race detector.)
ï¼ˆæ³¨æ„ï¼š-racesæ”¯æŒGoç«èµ›æ£€æµ‹å™¨ã€‚æˆ‘ä»¬å»ºè®®ä½ ç”¨ç«èµ›æ£€æµ‹å™¨å¼€å‘å’Œæµ‹è¯•ä½ çš„6.824å®éªŒå®¤ä»£ç ã€‚å½“æˆ‘ä»¬å¯¹ä½ çš„å®éªŒå®¤è¯„åˆ†æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨ç«èµ›æ£€æµ‹å™¨ã€‚ç„¶è€Œï¼Œå¦‚æœä½ çš„ä»£ç æœ‰ç«èµ›ï¼Œå³ä½¿æ²¡æœ‰ç«èµ›æ£€æµ‹å™¨ï¼Œå½“æˆ‘ä»¬æµ‹è¯•å®ƒæ—¶ï¼Œå®ƒä¹Ÿå¾ˆæœ‰å¯èƒ½å¤±è´¥ã€‚ï¼‰</p>
<p>mrsequential.go leaves its output in the file mr-out-0. The input is from the text files named pg-xxx.txt.
mrsequential.goå°†å…¶è¾“å‡ºç•™åœ¨æ–‡ä»¶mr-out-0ä¸­ã€‚è¾“å…¥æ¥è‡ªåä¸ºpg-xxx.txt.çš„æ–‡æœ¬æ–‡ä»¶</p>
<p>Feel free to borrow code from mrsequential.go. You should also have a look at mrapps/wc.go to see what MapReduce application code looks like.
è¯·éšæ„ä»mrsequential.go.å€Ÿç”¨ä»£ç ã€‚æ‚¨è¿˜åº”è¯¥çœ‹çœ‹mrapps/wc.goï¼Œçœ‹çœ‹MapReduceåº”ç”¨ç¨‹åºä»£ç æ˜¯ä»€ä¹ˆæ ·å­ã€‚</p>
<h2 id="your-job-moderatehard"><a class="header" href="#your-job-moderatehard">Your Job (moderate/hard)</a></h2>
<p>Your job is to implement a distributed MapReduce, consisting of two programs, the coordinator and the worker. There will be just one coordinator process, and one or more worker processes executing in parallel. In a real system the workers would run on a bunch of different machines, but for this lab you'll run them all on a single machine. The workers will talk to the coordinator via RPC. Each worker process will ask the coordinator for a task, read the task's input from one or more files, execute the task, and write the task's output to one or more files. The coordinator should notice if a worker hasn't completed its task in a reasonable amount of time (for this lab, use ten seconds), and give the same task to a different worker.
æ‚¨çš„å·¥ä½œæ˜¯å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼MapReduceï¼Œç”±ä¸¤ä¸ªç¨‹åºç»„æˆï¼Œåè°ƒå™¨å’Œå·¥ä½œè¿›ç¨‹ã€‚åªæœ‰ä¸€ä¸ªåè°ƒå™¨è¿›ç¨‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªå¹¶è¡Œæ‰§è¡Œçš„å·¥ä½œè¿›ç¨‹ã€‚åœ¨ä¸€ä¸ªçœŸå®çš„ç³»ç»Ÿä¸­ï¼Œå·¥ä½œè¿›ç¨‹å°†åœ¨ä¸€å †ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªå®éªŒå®¤ï¼Œæ‚¨å°†åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œå®ƒä»¬ã€‚å·¥ä½œè¿›ç¨‹å°†é€šè¿‡RPCä¸åè°ƒå™¨å¯¹è¯ã€‚æ¯ä¸ªå·¥ä½œè¿›ç¨‹å°†å‘åè°ƒå™¨è¯¢é—®ä»»åŠ¡ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­è¯»å–ä»»åŠ¡çš„è¾“å…¥ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡çš„è¾“å‡ºå†™å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€‚åè°ƒäººåº”è¯¥æ³¨æ„åˆ°ä¸€ä¸ªå·¥äººæ˜¯å¦åœ¨åˆç†çš„æ—¶é—´å†…æ²¡æœ‰å®Œæˆä»»åŠ¡ï¼ˆå¯¹äºè¿™ä¸ªå®éªŒå®¤ï¼Œç”¨åç§’é’Ÿï¼‰ï¼Œå¹¶æŠŠåŒæ ·çš„ä»»åŠ¡äº¤ç»™å¦ä¸€ä¸ªå·¥äººã€‚</p>
<p>We have given you a little code to start you off. The &quot;main&quot; routines for the coordinator and worker are in main/mrcoordinator.go and main/mrworker.go; don't change these files. You should put your implementation in mr/coordinator.go, mr/worker.go, and mr/rpc.go.</p>
<p>æˆ‘ä»¬å·²ç»ç»™äº†ä½ ä¸€ä¸ªå°ä»£ç æ¥å¼€å§‹ä½ ã€‚åè°ƒå‘˜å’Œå·¥ä½œäººå‘˜çš„â€œä¸»è¦â€ä¾‹ç¨‹åœ¨main/mrcoordinator.goå’Œmain/mrworker.goï¼›ä¸è¦æ”¹å˜è¿™äº›æ–‡ä»¶ã€‚ä½ åº”è¯¥æŠŠä½ çš„å®ç°æ”¾åœ¨å…ˆç”Ÿ/coordinator.goã€å…ˆç”Ÿ/worker.goå’Œå…ˆç”Ÿ/rpc.go.</p>
<p>Here's how to run your code on the word-count MapReduce application. First, make sure the word-count plugin is freshly built:
ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨å­—æ•°MapReduceåº”ç”¨ç¨‹åºä¸Šè¿è¡Œä»£ç ã€‚é¦–å…ˆï¼Œç¡®ä¿å­—æ•°æ’ä»¶æ˜¯æ–°æ„å»ºçš„ï¼š</p>
<pre><code>$ go build -race -buildmode=plugin ../mrapps/wc.go
</code></pre>
<p>In the main directory, run the coordinator.
åœ¨ä¸»ç›®å½•ä¸­ï¼Œè¿è¡Œåè°ƒå™¨ã€‚</p>
<pre><code>$ rm mr-out*
$rm mr-out*
$ go run -race mrcoordinator.go pg-*.txt
</code></pre>
<p>The pg-*.txt arguments to mrcoordinator.go are the input files; each file corresponds to one &quot;split&quot;, and is the input to one Map task. The -race flags runs go with its race detector.</p>
<p>mrcoordinator.goçš„pg-*. txtå‚æ•°æ˜¯è¾“å…¥æ–‡ä»¶ï¼›æ¯ä¸ªæ–‡ä»¶å¯¹åº”äºä¸€ä¸ªâ€œæ‹†åˆ†â€ï¼Œæ˜¯ä¸€ä¸ªåœ°å›¾ä»»åŠ¡çš„è¾“å…¥ã€‚-ç§æ—æ ‡å¿—è¿è¡Œä¸å®ƒçš„ç§æ—æ£€æµ‹å™¨ä¸€èµ·è¿è¡Œã€‚</p>
<p>In one or more other windows, run some workers:
åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–çª—å£ä¸­ï¼Œè¿è¡Œä¸€äº›è¾…åŠ©è§’è‰²ï¼š</p>
<pre><code>$ go run -race mrworker.go wc.so
</code></pre>
<p>When the workers and coordinator have finished, look at the output in mr-out-*. When you've completed the lab, the sorted union of the output files should match the sequential output, like this:
å½“å·¥ä½œäººå‘˜å’Œåè°ƒè€…å®Œæˆåï¼ŒæŸ¥çœ‹mr-out-*ä¸­çš„è¾“å‡ºã€‚å½“æ‚¨å®Œæˆå®éªŒå®¤æ—¶ï¼Œè¾“å‡ºæ–‡ä»¶çš„æ’åºè”åˆåº”è¯¥ä¸é¡ºåºè¾“å‡ºåŒ¹é…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>$ cat mr-out-* | sort | more
A 509
ABOUT 2
ACT 8
...
...
</code></pre>
<p>We supply you with a test script in main/test-mr.sh. The tests check that the wc and indexer MapReduce applications produce the correct output when given the pg-xxx.txt files as input. The tests also check that your implementation runs the Map and Reduce tasks in parallel, and that your implementation recovers from workers that crash while running tasks.</p>
<p>æˆ‘ä»¬åœ¨main/test-mr.sh.ä¸­ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæµ‹è¯•è„šæœ¬ã€‚æµ‹è¯•æ£€æŸ¥wcå’Œç´¢å¼•å™¨MapReduceåº”ç”¨ç¨‹åºåœ¨è¾“å…¥pg-xxx.txtæ–‡ä»¶æ—¶æ˜¯å¦äº§ç”Ÿæ­£ç¡®çš„è¾“å‡ºã€‚æµ‹è¯•è¿˜æ£€æŸ¥æ‚¨çš„å®ç°æ˜¯å¦å¹¶è¡Œè¿è¡Œåœ°å›¾å’Œå‡å°‘ä»»åŠ¡ï¼Œä»¥åŠæ‚¨çš„å®ç°æ˜¯å¦ä»è¿è¡Œä»»åŠ¡æ—¶å´©æºƒçš„è¾…åŠ©è§’è‰²ä¸­æ¢å¤ã€‚</p>
<p>If you run the test script now, it will hang because the coordinator never finishes:</p>
<p>å¦‚æœæ‚¨ç°åœ¨è¿è¡Œæµ‹è¯•è„šæœ¬ï¼Œå®ƒå°†æŒ‚èµ·ï¼Œå› ä¸ºåè°ƒå™¨æ°¸è¿œä¸ä¼šå®Œæˆï¼š</p>
<pre><code>$ cd ~/6.824/src/main
$ bash test-mr.sh
*** Starting wc test.
</code></pre>
<p>You can change ret := false to true in the Done function in mr/coordinator.go so that the coordinator exits immediately. Then:</p>
<p>æ‚¨å¯ä»¥åœ¨mr/coordinator.goä¸­çš„Doneå‡½æ•°ä¸­å°†retï¼š=falseæ›´æ”¹ä¸ºtrueï¼Œä»¥ä¾¿åè°ƒå™¨ç«‹å³é€€å‡ºã€‚ç„¶åï¼š</p>
<pre><code>$ bash test-mr.sh
*** Starting wc test.
sort: No such file or directory
cmp: EOF on mr-wc-all
--- wc output is not the same as mr-correct-wc.txt
--- wc test: FAIL
$
</code></pre>
<p>The test script expects to see output in files named mr-out-X, one for each reduce task. The empty implementations of mr/coordinator.go and mr/worker.go don't produce those files (or do much of anything else), so the test fails.
æµ‹è¯•è„šæœ¬æœŸæœ›åœ¨åä¸ºmr-out-Xçš„æ–‡ä»¶ä¸­çœ‹åˆ°è¾“å‡ºï¼Œæ¯ä¸ªå‡å°‘ä»»åŠ¡ä¸€ä¸ªè¾“å‡ºã€‚mr/coordinator.goå’Œmr/worker.goçš„ç©ºå®ç°ä¸ç”Ÿæˆè¿™äº›æ–‡ä»¶ï¼ˆæˆ–åšå…¶ä»–ä»»ä½•äº‹æƒ…ï¼‰ï¼Œå› æ­¤æµ‹è¯•å¤±è´¥ã€‚</p>
<p>When you've finished, the test script output should look like this:
å®Œæˆåï¼Œæµ‹è¯•è„šæœ¬è¾“å‡ºåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>$ bash test-mr.sh
*** Starting wc test.
--- wc test: PASS
*** Starting indexer test.
--- indexer test: PASS
*** Starting map parallelism test.
--- map parallelism test: PASS
*** Starting reduce parallelism test.
--- reduce parallelism test: PASS
*** Starting crash test.
--- crash test: PASS
*** PASSED ALL TESTS
$
</code></pre>
<p>You'll also see some errors from the Go RPC package that look like
æ‚¨è¿˜å°†çœ‹åˆ°Go RPCåŒ…ä¸­çš„ä¸€äº›é”™è¯¯ï¼Œçœ‹èµ·æ¥åƒ</p>
<pre><code>2019/12/16 13:27:09 rpc.Register: method &quot;Done&quot; has 1 input parameters; needs exactly three
</code></pre>
<p>Ignore these messages; registering the coordinator as an RPC server checks if all its methods are suitable for RPCs (have 3 inputs); we know that Done is not called via RPC.
å¿½ç•¥è¿™äº›æ¶ˆæ¯ï¼›å°†åè°ƒå™¨æ³¨å†Œä¸ºRPCæœåŠ¡å™¨æ£€æŸ¥å…¶æ‰€æœ‰æ–¹æ³•æ˜¯å¦é€‚åˆRPCï¼ˆæœ‰3ä¸ªè¾“å…¥ï¼‰ï¼›æˆ‘ä»¬çŸ¥é“Doneä¸æ˜¯é€šè¿‡RPCè°ƒç”¨çš„ã€‚</p>
<h2 id="a-few-rules"><a class="header" href="#a-few-rules">A few rules:</a></h2>
<ul>
<li>The map phase should divide the intermediate keys into buckets for nReduce reduce tasks, where nReduce is the number of reduce tasks -- argument that main/mrcoordinator.go passes to MakeCoordinator(). So, each mapper needs to create nReduce intermediate files for consumption by the reduce tasks.</li>
</ul>
<p>æ˜ å°„é˜¶æ®µåº”è¯¥å°†nReduceå‡å°‘ä»»åŠ¡çš„ä¸­é—´é”®åˆ†æˆæ¡¶ï¼Œå…¶ä¸­nReduceæ˜¯å‡å°‘ä»»åŠ¡çš„æ•°é‡--ä¸»/mrcoordinator.goä¼ é€’ç»™Makeåè°ƒå‘˜ï¼ˆï¼‰çš„å‚æ•°ã€‚å› æ­¤ï¼Œæ¯ä¸ªæ˜ å°„å™¨éœ€è¦åˆ›å»ºnReduceä¸­é—´æ–‡ä»¶ï¼Œä¾›å‡å°‘ä»»åŠ¡ä½¿ç”¨ã€‚</p>
<ul>
<li>The worker implementation should put the output of the X'th reduce task in the file mr-out-X.</li>
</ul>
<p>å·¥ä½œäººå‘˜å®ç°åº”è¯¥æŠŠç¬¬Xä¸ªå‡å°‘ä»»åŠ¡çš„è¾“å‡ºæ”¾åœ¨mr-out-Xæ–‡ä»¶ä¸­ã€‚</p>
<ul>
<li>A mr-out-X file should contain one line per Reduce function output. The line should be generated with the Go &quot;%v %v&quot; format, called with the key and value. Have a look in main/mrsequential.go for the line commented &quot;this is the correct format&quot;. The test script will fail if your implementation deviates too much from this format.</li>
</ul>
<p>mr-out-Xæ–‡ä»¶åº”è¯¥åŒ…å«æ¯ä¸ªReduceå‡½æ•°è¾“å‡ºçš„ä¸€è¡Œã€‚è¯¥è¡Œåº”è¯¥ç”¨Goâ€œ%v%vâ€æ ¼å¼ç”Ÿæˆï¼Œç”¨é”®å’Œå€¼è°ƒç”¨ã€‚åœ¨main/mrsequential.goä¸­æŸ¥çœ‹æ³¨é‡Šä¸ºâ€œè¿™æ˜¯æ­£ç¡®çš„æ ¼å¼â€çš„è¡Œã€‚å¦‚æœæ‚¨çš„å®ç°åç¦»è¿™ç§æ ¼å¼å¤ªå¤šï¼Œæµ‹è¯•è„šæœ¬å°†å¤±è´¥ã€‚</p>
<ul>
<li>You can modify mr/worker.go, mr/coordinator.go, and mr/rpc.go. You can temporarily modify other files for testing, but make sure your code works with the original versions; we'll test with the original versions.</li>
</ul>
<p>æ‚¨å¯ä»¥ä¿®æ”¹mr/worker.goã€mr/coordinator.goå’Œmr/rpc.go.æ‚¨å¯ä»¥ä¸´æ—¶ä¿®æ”¹å…¶ä»–æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œä½†è¯·ç¡®ä¿æ‚¨çš„ä»£ç ä¸åŸå§‹ç‰ˆæœ¬ä¸€èµ·å·¥ä½œï¼›æˆ‘ä»¬å°†ä½¿ç”¨åŸå§‹ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ã€‚</p>
<ul>
<li>The worker should put intermediate Map output in files in the current directory, where your worker can later read them as input to Reduce tasks.</li>
</ul>
<p>è¾…åŠ©è§’è‰²åº”è¯¥å°†ä¸­é—´æ˜ å°„è¾“å‡ºæ”¾åœ¨å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶ä¸­ï¼Œæ‚¨çš„è¾…åŠ©è§’è‰²å¯ä»¥ç¨åå°†å…¶ä½œä¸ºå‡å°‘ä»»åŠ¡çš„è¾“å…¥è¯»å–ã€‚</p>
<ul>
<li>main/mrcoordinator.go expects mr/coordinator.go to implement a Done() method that returns true when the MapReduce job is completely finished; at that point, mrcoordinator.go will exit.</li>
</ul>
<p>main/mrcoordinator.goæœŸæœ›mr/coordinator.goå®ç°ä¸€ä¸ªDoneï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨MapReduceä½œä¸šå®Œå…¨å®Œæˆæ—¶è¿”å›trueï¼›æ­¤æ—¶ï¼Œmrcoordinator.goå°†é€€å‡ºã€‚</p>
<ul>
<li>When the job is completely finished, the worker processes should exit. A simple way to implement this is to use the return value from call(): if the worker fails to contact the coordinator, it can assume that the coordinator has exited because the job is done, and so the worker can terminate too. Depending on your design, you might also find it helpful to have a &quot;please exit&quot; pseudo-task that the coordinator can give to workers.</li>
</ul>
<p>å½“å·¥ä½œå®Œå…¨å®Œæˆæ—¶ï¼Œè¾…åŠ©è¿›ç¨‹åº”è¯¥é€€å‡ºã€‚å®ç°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨callï¼ˆï¼‰çš„è¿”å›å€¼ï¼šå¦‚æœè¾…åŠ©è¿›ç¨‹æœªèƒ½è”ç³»åè°ƒå™¨ï¼Œå®ƒå¯ä»¥å‡è®¾åè°ƒå™¨å·²ç»é€€å‡ºï¼Œå› ä¸ºå·¥ä½œå·²ç»å®Œæˆï¼Œå› æ­¤è¾…åŠ©è¿›ç¨‹ä¹Ÿå¯ä»¥ç»ˆæ­¢ã€‚æ ¹æ®æ‚¨çš„è®¾è®¡ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°åè°ƒå™¨å¯ä»¥ç»™è¾…åŠ©è¿›ç¨‹ä¸€ä¸ªâ€œè¯·é€€å‡ºâ€ä¼ªä»»åŠ¡æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>
<h2 id="hints"><a class="header" href="#hints">Hints</a></h2>
<ul>
<li>The Guidance page has some tips on developing and debugging.</li>
</ul>
<p>è¯¥æŒ‡å—é¡µé¢æä¾›äº†ä¸€äº›å¼€å‘å’Œè°ƒè¯•æç¤ºã€‚</p>
<ul>
<li>One way to get started is to modify mr/worker.go's Worker() to send an RPC to the coordinator asking for a task. Then modify the coordinator to respond with the file name of an as-yet-unstarted map task. Then modify the worker to read that file and call the application Map function, as in mrsequential.go.</li>
</ul>
<p>å¼€å§‹çš„ä¸€ç§æ–¹æ³•æ˜¯ä¿®æ”¹mr/worker.go's Workerï¼ˆï¼‰ä»¥å‘è¯·æ±‚ä»»åŠ¡çš„åè°ƒå™¨å‘é€RPCã€‚ç„¶åä¿®æ”¹åè°ƒå™¨ä»¥ç”¨å°šæœªå¯åŠ¨çš„æ˜ å°„ä»»åŠ¡çš„æ–‡ä»¶åè¿›è¡Œå“åº”ã€‚ç„¶åä¿®æ”¹å·¥ä½œå™¨ä»¥è¯»å–è¯¥æ–‡ä»¶å¹¶è°ƒç”¨åº”ç”¨ç¨‹åºMapå‡½æ•°ï¼Œå¦‚mrsequential.go.</p>
<ul>
<li>The application Map and Reduce functions are loaded at run-time using the Go plugin package, from files whose names end in .so.</li>
</ul>
<p>åº”ç”¨ç¨‹åºMapå’ŒReduceå‡½æ•°åœ¨è¿è¡Œæ—¶ä½¿ç”¨Goæ’ä»¶åŒ…ä»åç§°ä»¥. soç»“å°¾çš„æ–‡ä»¶ä¸­åŠ è½½ã€‚</p>
<ul>
<li>If you change anything in the mr/ directory, you will probably have to re-build any MapReduce plugins you use, with something like go build -race -buildmode=plugin ../mrapps/wc.go</li>
</ul>
<p>å¦‚æœæ‚¨æ›´æ”¹äº†mr/ç›®å½•ä¸­çš„ä»»ä½•å†…å®¹ï¼Œæ‚¨å¯èƒ½å¿…é¡»é‡æ–°æ„å»ºæ‚¨ä½¿ç”¨çš„ä»»ä½•MapReduceæ’ä»¶ï¼Œä¾‹å¦‚go build-race-BuildMode=plugin.../mrapps/wc.go</p>
<ul>
<li>This lab relies on the workers sharing a file system. That's straightforward when all workers run on the same machine, but would require a global filesystem like GFS if the workers ran on different machines.</li>
</ul>
<p>è¿™ä¸ªå®éªŒå®¤ä¾èµ–äºå·¥ä½œäººå‘˜å…±äº«ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚å½“æ‰€æœ‰å·¥ä½œäººå‘˜åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œæ—¶ï¼Œè¿™å¾ˆç®€å•ï¼Œä½†æ˜¯å¦‚æœå·¥ä½œäººå‘˜åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œå°±éœ€è¦åƒGFSè¿™æ ·çš„å…¨å±€æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<ul>
<li>A reasonable naming convention for intermediate files is mr-X-Y, where X is the Map task number, and Y is the reduce task number.</li>
</ul>
<p>ä¸­é—´æ–‡ä»¶çš„åˆç†å‘½åçº¦å®šæ˜¯mr-X-Yï¼Œå…¶ä¸­Xæ˜¯Mapä»»åŠ¡å·ï¼ŒYæ˜¯å‡å°‘ä»»åŠ¡å·ã€‚</p>
<ul>
<li>The worker's map task code will need a way to store intermediate key/value pairs in files in a way that can be correctly read back during reduce tasks. One possibility is to use Go's encoding/json package. To write key/value pairs in JSON format to an open file:</li>
</ul>
<p>å·¥ä½œäººå‘˜çš„æ˜ å°„ä»»åŠ¡ä»£ç å°†éœ€è¦ä¸€ç§åœ¨æ–‡ä»¶ä¸­å­˜å‚¨ä¸­é—´é”®/å€¼å¯¹çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥åœ¨å‡å°‘ä»»åŠ¡æœŸé—´æ­£ç¡®åœ°è¯»å›ã€‚ä¸€ç§å¯èƒ½æ€§æ˜¯ä½¿ç”¨Goçš„ç¼–ç /jsonåŒ…ã€‚ä»¥JSONæ ¼å¼å°†é”®/å€¼å¯¹å†™å…¥æ‰“å¼€çš„æ–‡ä»¶ï¼š</p>
<p>enc := json.NewEncoder(file)
for _, kv := ... {
err := enc.Encode(&amp;kv)</p>
<p>å¹¶è¯»å–è¿™æ ·çš„æ–‡ä»¶ï¼šdecï¼š=json. NewDecoderï¼ˆfileï¼‰</p>
<p>dec := json.NewDecoder(file)
for {
var kv KeyValue
if err := dec.Decode(&amp;kv); err != nil {
break
}
kva = append(kva, kv)
}</p>
<ul>
<li>The map part of your worker can use the ihash(key) function (in worker.go) to pick the reduce task for a given key.</li>
</ul>
<p>æ‚¨çš„è¾…åŠ©è§’è‰²çš„mapéƒ¨åˆ†å¯ä»¥ä½¿ç”¨ihashï¼ˆkeyï¼‰å‡½æ•°ï¼ˆworker.goï¼‰ä¸ºç»™å®šçš„keyé€‰æ‹©å‡å°‘ä»»åŠ¡ã€‚</p>
<ul>
<li>You can steal some code from mrsequential.go for reading Map input files, for sorting intermedate key/value pairs between the Map and Reduce, and for storing Reduce output in files.</li>
</ul>
<p>æ‚¨å¯ä»¥ä»mrsequential.goä¸­çªƒå–ä¸€äº›ä»£ç ï¼Œç”¨äºè¯»å–Mapè¾“å…¥æ–‡ä»¶ã€å¯¹Mapå’ŒReduceä¹‹é—´çš„é—´éš”é”®/å€¼å¯¹è¿›è¡Œæ’åºä»¥åŠå°†Reduceè¾“å‡ºå­˜å‚¨åœ¨æ–‡ä»¶ä¸­ã€‚</p>
<ul>
<li>The coordinator, as an RPC server, will be concurrent; don't forget to lock shared data.</li>
</ul>
<p>åè°ƒå™¨ä½œä¸ºRPCæœåŠ¡å™¨å°†æ˜¯å¹¶å‘çš„ï¼›ä¸è¦å¿˜è®°é”å®šå…±äº«æ•°æ®ã€‚</p>
<ul>
<li>Use Go's race detector, with go build -race and go run -race. test-mr.sh by default runs the tests with the race detector.</li>
</ul>
<p>ä½¿ç”¨Goçš„ç«èµ›æ£€æµ‹å™¨ï¼ŒåŒ…æ‹¬goæ„å»ºç«èµ›å’Œgoè¿è¡Œç«èµ›ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œtest-mr.shä½¿ç”¨ç«èµ›æ£€æµ‹å™¨è¿è¡Œæµ‹è¯•ã€‚</p>
<ul>
<li>Workers will sometimes need to wait, e.g. reduces can't start until the last map has finished. One possibility is for workers to periodically ask the coordinator for work, sleeping with time.Sleep() between each request. Another possibility is for the relevant RPC handler in the coordinator to have a loop that waits, either with time.Sleep() or sync.Cond. Go runs the handler for each RPC in its own thread, so the fact that one handler is waiting won't prevent the coordinator from processing other RPCs.</li>
</ul>
<p>å·¥ä½œäººå‘˜æœ‰æ—¶éœ€è¦ç­‰å¾…ï¼Œä¾‹å¦‚ï¼Œåœ¨æœ€åä¸€å¼ åœ°å›¾å®Œæˆä¹‹å‰ï¼Œå‡å°‘æ— æ³•å¯åŠ¨ã€‚ä¸€ç§å¯èƒ½æ€§æ˜¯å·¥ä½œäººå‘˜å®šæœŸå‘åè°ƒå™¨è¯¢é—®å·¥ä½œï¼Œä¸æ—¶é—´ä¸€èµ·ç¡è§‰ã€‚æ¯ä¸ªè¯·æ±‚ä¹‹é—´çš„ç¡çœ ï¼ˆï¼‰ã€‚å¦ä¸€ç§å¯èƒ½æ€§æ˜¯åè°ƒå™¨ä¸­ç›¸å…³çš„RPCå¤„ç†ç¨‹åºæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»è€Œç­‰å¾…ã€‚ç¡çœ ï¼ˆï¼‰æˆ–åŒæ­¥ã€‚Condã€‚Goåœ¨è‡ªå·±çš„çº¿ç¨‹ä¸­è¿è¡Œæ¯ä¸ªRPCçš„å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥ä¸€ä¸ªå¤„ç†ç¨‹åºæ­£åœ¨ç­‰å¾…çš„äº‹å®ä¸ä¼šé˜»æ­¢åè°ƒå™¨å¤„ç†å…¶ä»–RPCã€‚</p>
<ul>
<li>The coordinator can't reliably distinguish between crashed workers, workers that are alive but have stalled for some reason, and workers that are executing but too slowly to be useful. The best you can do is have the coordinator wait for some amount of time, and then give up and re-issue the task to a different worker. For this lab, have the coordinator wait for ten seconds; after that the coordinator should assume the worker has died (of course, it might not have).</li>
</ul>
<p>åè°ƒè€…æ— æ³•å¯é åœ°åŒºåˆ†å´©æºƒçš„å·¥äººã€æ´»ç€ä½†ç”±äºæŸç§åŸå› åœæ»ä¸å‰çš„å·¥äººå’Œæ­£åœ¨æ‰§è¡Œä½†æ‰§è¡Œé€Ÿåº¦å¤ªæ…¢è€Œä¸èµ·ä½œç”¨çš„å·¥äººã€‚ä½ èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…æ˜¯è®©åè°ƒè€…ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç„¶åæ”¾å¼ƒå¹¶å°†ä»»åŠ¡é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªå·¥äººã€‚å¯¹äºè¿™ä¸ªå®éªŒå®¤ï¼Œè®©åè°ƒè€…ç­‰å¾…10ç§’é’Ÿï¼›åœ¨é‚£ä¹‹åï¼Œåè°ƒè€…åº”è¯¥å‡è®¾å·¥äººå·²ç»æ­»äº†ï¼ˆå½“ç„¶ï¼Œå®ƒå¯èƒ½æ²¡æœ‰æ­»ï¼‰ã€‚</p>
<ul>
<li>If you choose to implement Backup Tasks (Section 3.6), note that we test that your code doesn't schedule extraneous tasks when workers execute tasks without crashing. Backup tasks should only be scheduled after some relatively long period of time (e.g., 10s).</li>
</ul>
<p>å¦‚æœæ‚¨é€‰æ‹©å®ç°å¤‡ä»½ä»»åŠ¡ï¼ˆç¬¬3.6èŠ‚ï¼‰ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘ä»¬æµ‹è¯•äº†å½“å·¥ä½œè€…æ‰§è¡Œä»»åŠ¡è€Œä¸å´©æºƒæ—¶ï¼Œæ‚¨çš„ä»£ç ä¸ä¼šè°ƒåº¦æ— å…³çš„ä»»åŠ¡ã€‚å¤‡ä»½ä»»åŠ¡åº”è¯¥åªåœ¨ç›¸å¯¹è¾ƒé•¿çš„æ—¶é—´ï¼ˆä¾‹å¦‚10ç§’ï¼‰åè¿›è¡Œè°ƒåº¦ã€‚</p>
<ul>
<li>To test crash recovery, you can use the mrapps/crash.go application plugin. It randomly exits in the Map and Reduce functions.</li>
</ul>
<p>è¦æµ‹è¯•å´©æºƒæ¢å¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨mrapps/crash.goåº”ç”¨ç¨‹åºæ’ä»¶ã€‚å®ƒåœ¨åœ°å›¾å’Œå‡å°‘åŠŸèƒ½ä¸­éšæœºé€€å‡ºã€‚</p>
<ul>
<li>To ensure that nobody observes partially written files in the presence of crashes, the MapReduce paper mentions the trick of using a temporary file and atomically renaming it once it is completely written. You can use ioutil.TempFile to create a temporary file and os.Rename to atomically rename it.</li>
</ul>
<p>ä¸ºäº†ç¡®ä¿æ²¡æœ‰äººåœ¨å´©æºƒçš„æƒ…å†µä¸‹è§‚å¯Ÿåˆ°éƒ¨åˆ†å†™å…¥çš„æ–‡ä»¶ï¼ŒMapReduceè®ºæ–‡æåˆ°äº†ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¹¶åœ¨å®Œå…¨å†™å…¥åè‡ªåŠ¨é‡å‘½åçš„æŠ€å·§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ioutil. TempFileæ¥åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨os. Renameæ¥è‡ªåŠ¨é‡å‘½åå®ƒã€‚</p>
<ul>
<li>test-mr.sh runs all its processes in the sub-directory mr-tmp, so if something goes wrong and you want to look at intermediate or output files, look there. You can temporarily modify test-mr.sh to exit after the failing test, so the script does not continue testing (and overwrite the output files).</li>
</ul>
<p>test-mr.shåœ¨å­ç›®å½•mr-tmpä¸­è¿è¡Œå®ƒçš„æ‰€æœ‰è¿›ç¨‹ï¼Œæ‰€ä»¥å¦‚æœå‡ºäº†é—®é¢˜ï¼Œæ‚¨æƒ³æŸ¥çœ‹ä¸­é—´æˆ–è¾“å‡ºæ–‡ä»¶ï¼Œè¯·æŸ¥çœ‹é‚£é‡Œã€‚æ‚¨å¯ä»¥æš‚æ—¶ä¿®æ”¹test-mr.shä»¥åœ¨æµ‹è¯•å¤±è´¥åé€€å‡ºï¼Œè¿™æ ·è„šæœ¬å°±ä¸ä¼šç»§ç»­æµ‹è¯•ï¼ˆå¹¶è¦†ç›–è¾“å‡ºæ–‡ä»¶ï¼‰ã€‚</p>
<ul>
<li>test-mr-many.sh provides a bare-bones script for running test-mr.sh with a timeout (which is how we'll test your code). It takes as an argument the number of times to run the tests. You should not run several test-mr.sh instances in parallel because the coordinator will reuse the same socket, causing conflicts.</li>
</ul>
<p>test-mr-many.shæä¾›äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥è¿è¡Œè¶…æ—¶test-mr.shï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬æµ‹è¯•ä»£ç çš„æ–¹å¼ï¼‰ã€‚å®ƒä»¥è¿è¡Œæµ‹è¯•çš„æ¬¡æ•°ä¸ºå‚æ•°ã€‚æ‚¨ä¸åº”è¯¥å¹¶è¡Œè¿è¡Œå¤šä¸ªtest-mr.shå®ä¾‹ï¼Œå› ä¸ºåè°ƒå™¨ä¼šé‡ç”¨åŒä¸€ä¸ªå¥—æ¥å­—ï¼Œå¯¼è‡´å†²çªã€‚</p>
<ul>
<li>Go RPC sends only struct fields whose names start with capital letters. Sub-structures must also have capitalized field names.</li>
</ul>
<p>Go RPCåªå‘é€åç§°ä»¥å¤§å†™å­—æ¯å¼€å¤´çš„ç»“æ„å­—æ®µã€‚å­ç»“æ„ä¹Ÿå¿…é¡»æœ‰å¤§å†™çš„å­—æ®µåã€‚</p>
<ul>
<li>When passing a pointer to a reply struct to the RPC system, the object that *reply points to should be zero-allocated. The code for RPC calls should always look like</li>
</ul>
<p>å½“å°†æŒ‡å‘å›å¤ç»“æ„çš„æŒ‡é’ˆä¼ é€’ç»™RPCç³»ç»Ÿæ—¶ï¼Œ*å›å¤æŒ‡å‘çš„å¯¹è±¡åº”è¯¥æ˜¯é›¶åˆ†é…çš„ã€‚RPCè°ƒç”¨çš„ä»£ç åº”è¯¥æ€»æ˜¯è¿™æ ·</p>
<p>reply := SomeType{}
call(..., &amp;reply)</p>
<p>without setting any fields of reply before the call. If you don't follow this requirement, there will be a problem when you pre-initialize a reply field to the non-default value for that datatype, and the server on which the RPC executes sets that reply field to the default value; you will observe that the write doesnÃ¢â‚¬â„¢t appear to take effect, and that on the caller side, the non-default value remains.</p>
<p>å¦‚æœæ‚¨ä¸éµå¾ªæ­¤è¦æ±‚ï¼Œå½“æ‚¨å°†å›å¤å­—æ®µé¢„åˆå§‹åŒ–ä¸ºè¯¥æ•°æ®ç±»å‹çš„éé»˜è®¤å€¼ï¼Œå¹¶ä¸”RPCæ‰§è¡Œçš„æœåŠ¡å™¨å°†è¯¥å›å¤å­—æ®µè®¾ç½®ä¸ºé»˜è®¤å€¼æ—¶ï¼Œå°†å‡ºç°é—®é¢˜ï¼›æ‚¨å°†è§‚å¯Ÿåˆ°å†™ä¼¼ä¹â„¢ç”Ÿæ•ˆï¼Œå¹¶ä¸”åœ¨è°ƒç”¨æ–¹ï¼Œéé»˜è®¤å€¼ä»ç„¶å­˜åœ¨ã€‚</p>
<h2 id="no-credit-challenge-exercises"><a class="header" href="#no-credit-challenge-exercises">No-credit challenge exercises</a></h2>
<p>Implement your own MapReduce application (see examples in mrapps/*), e.g., Distributed Grep (Section 2.3 of the MapReduce paper).
å®ç°æ‚¨è‡ªå·±çš„MapReduceåº”ç”¨ç¨‹åºï¼ˆè¯·å‚é˜…mrapps/*ä¸­çš„ç¤ºä¾‹ï¼‰ï¼Œä¾‹å¦‚ï¼Œåˆ†å¸ƒå¼Grepï¼ˆMapReduceè®ºæ–‡çš„ç¬¬2.3èŠ‚ï¼‰ã€‚</p>
<p>Get your MapReduce coordinator and workers to run on separate machines, as they would in practice. You will need to set up your RPCs to communicate over TCP/IP instead of Unix sockets (see the commented out line in Coordinator.server()), and read/write files using a shared file system. For example, you can ssh into multiple Athena cluster machines at MIT, which use AFS to share files; or you could rent a couple AWS instances and use S3 for storage.
è®©æ‚¨çš„MapReduceåè°ƒå™¨å’Œè¾…åŠ©è§’è‰²åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œå°±åƒä»–ä»¬åœ¨å®è·µä¸­ä¸€æ ·ã€‚æ‚¨éœ€è¦å°†RPCè®¾ç½®ä¸ºé€šè¿‡TCP/IPè€Œä¸æ˜¯Unixå¥—æ¥å­—è¿›è¡Œé€šä¿¡ï¼ˆå‚è§Coordinator.serverï¼ˆï¼‰ä¸­æ³¨é‡Šçš„è¾“å‡ºè¡Œï¼‰ï¼Œå¹¶ä½¿ç”¨å…±äº«æ–‡ä»¶ç³»ç»Ÿè¯»å–/å†™å…¥æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥sshåˆ°éº»çœç†å·¥å­¦é™¢çš„å¤šä¸ªé›…å…¸å¨œé›†ç¾¤æœºå™¨ä¸­ï¼Œè¿™äº›æœºå™¨ä½¿ç”¨AFSå…±äº«æ–‡ä»¶ï¼›æˆ–è€…æ‚¨å¯ä»¥ç§Ÿç”¨å‡ ä¸ªAWSå®ä¾‹ï¼Œå¹¶ä½¿ç”¨S3è¿›è¡Œå­˜å‚¨ã€‚</p>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../6.824/0-lab0.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../6.824/1-lab1.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../6.824/0-lab0.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../6.824/1-lab1.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "6.824/1-lab1-cn.md"
    </script>


    <!-- Custom JS scripts -->


</body>
</html>