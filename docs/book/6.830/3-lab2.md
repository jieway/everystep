# lab2

é˜…è¯» lab2.md

å®Œå–„ buffer pool ï¼Œå¢åŠ é¡µé¢ç½®æ¢ç®—æ³•ã€‚

è¿™ä¸ªå®éªŒä¸­ä¸éœ€è¦è€ƒè™‘å®ç°äº‹åŠ¡æˆ–é”å®šã€‚

å®ç° Filter å’Œ Join ï¼Œå·²ç»æä¾›äº† Project å’Œ OrderBy çš„å®ç°ã€‚

å®ç° StringAggregator å’Œ IntegerAggregator ã€‚ç¼–å†™è®¡ç®—ä¸€ä¸ªç‰¹å®šå­—æ®µåœ¨è¾“å…¥ tuple åºåˆ—çš„å¤šä¸ªç»„ä¸­çš„èšåˆã€‚

å…¶ä¸­ IntegerAggregator ä½¿ç”¨æ•´æ•°é™¤æ³•æ¥è®¡ç®—å¹³å‡æ•°ï¼Œå› ä¸º SimpleDB åªæ”¯æŒæ•´æ•°ã€‚StringAggegator åªéœ€è¦æ”¯æŒ COUNT èšåˆï¼Œå› ä¸ºå…¶ä»–æ“ä½œå¯¹å­—ç¬¦ä¸²æ²¡æœ‰æ„ä¹‰ã€‚

å®ç°`Aggregate`æ“ä½œç¬¦ã€‚å’Œå…¶ä»–è¿ç®—ç¬¦ä¸€æ ·ï¼Œèšåˆè¿ç®—ç¬¦å®ç°äº† `OpIterator` æ¥å£ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥æ”¾åœ¨ SimpleDB æŸ¥è¯¢è®¡åˆ’ä¸­ã€‚æ³¨æ„`Aggregate`è¿ç®—ç¬¦çš„è¾“å‡ºæ˜¯æ¯æ¬¡è°ƒç”¨`next()`æ—¶æ•´ä¸ªç»„çš„èšåˆå€¼ï¼Œå¹¶ä¸”èšåˆæ„é€ å™¨éœ€è¦èšåˆå’Œåˆ†ç»„å­—æ®µã€‚

å®ç°`æ’å…¥`å’Œ`åˆ é™¤`æ“ä½œç¬¦ã€‚åƒæ‰€æœ‰çš„æ“ä½œç¬¦ä¸€æ ·ï¼Œ`Insert`å’Œ`Delete`å®ç°äº†`OpIterator`ï¼Œæ¥å—ä¸€ä¸ªè¦æ’å…¥æˆ–åˆ é™¤çš„ tuple æµï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå¸¦æœ‰æ•´æ•°å­—æ®µçš„å•ä¸€ tuple ï¼Œè¡¨ç¤ºæ’å…¥æˆ–åˆ é™¤çš„ tuple æ•°é‡ã€‚è¿™äº›æ“ä½œè€…å°†éœ€è¦è°ƒç”¨`BufferPool`ä¸­çš„é€‚å½“æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®é™…ä¸Šæ˜¯ä¿®æ”¹ç£ç›˜ä¸Šçš„é¡µé¢ã€‚æ£€æŸ¥æ’å…¥å’Œåˆ é™¤ tuple çš„æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## Exercise 1

å®ç° `execution/Predicate.java`,`execution/JoinPredicate.java`,`execution/Filter.java` å’Œ `execution/Join.java` å¹¶é€šè¿‡ PredicateTestã€JoinPredicateTestã€FilterTest å’Œ JoinTest ä¸­çš„å•å…ƒæµ‹è¯•ã€‚æ­¤å¤–ï¼Œè¿˜éœ€é€šè¿‡ç³»ç»Ÿæµ‹è¯• FilterTest å’Œ JoinTestã€‚

`Predicate.java` æ¯”è¾ƒè¡¨å†…çš„å­—æ®µå’Œæä¾›çš„æ•°æ®ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å¾…æ¯”è¾ƒçš„å­—æ®µåºå·ã€æ¯”è¾ƒç¬¦å’Œå¾…æ¯”è¾ƒçš„æ•°ã€‚å…¶ä¸­ `filter()` æ–¹æ³•è¾“å…¥ä¸€ä¸ª Tuple ï¼Œç„¶åæ¯”è¾ƒ Tuple çš„ Field æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

`JoinPredicate.java` å’Œ `Predicate.java` ç±»ä¼¼ï¼Œåªæ˜¯å®ç°ä¸¤ä¸ª Tuple çš„æ¯”è¾ƒã€‚

`Filter.java` åœ¨æ„é€ å‡½æ•°ä¸­å®ä¾‹åŒ– Predicate å’Œ OpIteratorã€‚å…¶ä¸­ `fetchNext()` æ–¹æ³•é€ä¸ªè¯»å– OpIterator ä¸­çš„ Tuple ï¼Œç„¶åè®©ä»–ä»¬ä¸ Predicate ä¸­ Field è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ºçœŸåˆ™è¿”å›è¯¥ Tupleã€‚

`Join.java` å°±æ˜¯å¯¹ `JoinPredicate.java` çš„ä½¿ç”¨ï¼Œé€šè¿‡æ„é€ å‡½æ•°å®ä¾‹åŒ– `JoinPredicate` å’Œä¸¤ä¸ªOpIterator ã€‚å®ç°ä¸€ç³»ç±»getæ–¹æ³•å’Œopenã€closeç­‰è¿­ä»£å™¨çš„å‡½æ•°ã€‚æœ€åå®ŒæˆfetchNextå‡½æ•°æ‰¾åˆ°ä¸¤ä¸ªè¿­ä»£å™¨ä¸­å¯ä»¥jionçš„å­—æ®µè¿›è¡Œjoinã€‚

fetchNext ä¸­ç”±ä¸¤ä¸ª while å¾ªç¯è¿›è¡Œéå†ï¼Œç›´åˆ°æœ€å¤–å±‚è¿­ä»£å™¨éå†å®Œæˆï¼Œæ¯æ¬¡éå† child1 å–å‡ºä¸€ä¸ª Tuple ï¼Œä¸ child2 ä¸­çš„æ‰€æœ‰ Tuple åš filter æ¯”è¾ƒï¼Œç›´åˆ°æœ‰ç¬¦åˆè¦æ±‚çš„ï¼Œåˆ›å»ºæ–°çš„ TupleDesc ï¼Œå¹¶ä¸”å°† child1 å’Œ child2 çš„å­—æ®µï¼ˆfieldï¼‰ï¼ŒåŠ å…¥newTupleä¸­ï¼Œç„¶åè¿”å›newTupleï¼ŒåŒæ—¶å°† child2 é‡ç½®åˆ°æœ€å¼€å§‹ã€‚


## Exercise 2

> è¿™ä¸ªç»ƒä¹ å†™èµ·æ¥æŒºå›°éš¾çš„ã€‚ğŸ™„

å®ç°ä¸‹é¢å‡ ä¸ªæ–¹æ³•å¹¶é€šè¿‡ IntegerAggregatorTest ã€StringAggregatorTest å’Œ AggregateTest å•å…ƒæµ‹è¯•ã€‚æ­¤å¤–è¿˜éœ€è¦é€šè¿‡ AggregateTest çš„ç³»ç»Ÿæµ‹è¯•ã€‚

* src/java/simpledb/execution/IntegerAggregator.java
* src/java/simpledb/execution/StringAggregator.java
* src/java/simpledb/execution/Aggregate.java

åªéœ€è¦å®ç°å•ä¸ªå­—æ®µçš„èšåˆï¼ˆaggregationï¼‰å’Œå•ä¸ªå­—æ®µçš„åˆ†ç»„ï¼ˆgroup byï¼‰å³å¯ã€‚èšåˆå…¶å®å°±å¯¹ä¸€ç»„æ•°æ®è¿›è¡Œæ“ä½œï¼ˆåŠ å‡ä¹˜é™¤ï¼Œæœ€å€¼ç­‰ï¼‰ã€‚å…·ä½“å¯å‚è€ƒï¼š[SQL GROUP BY è¯­å¥](https://www.runoob.com/sql/sql-groupby.html)ã€‚

`IntegerAggregator(0, Type.INT_TYPE, 1, Aggregator.Op.SUM)` æ˜¯ç”Ÿæˆä¸€ä¸ªæ•´æ•°èšåˆçš„å¯¹è±¡ã€‚

å…¶ä¸­ 0 è¡¨ç¤ºåˆ†ç»„(Group By)å­—æ®µä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ç¬¬é›¶åˆ—æ¥èšåˆã€‚å¯ä»¥ä¸º NO_GROUPINGï¼Œè¡¨ç¤ºä¸è¿›è¡Œèšåˆã€‚

Type.INT_TYPE è¡¨ç¤ºè¿™ä¸€åˆ—çš„æ•°æ®ç±»å‹ï¼Œç›®å‰åªæœ‰æ•´æ•°å’Œå­—ç¬¦ä¸²ã€‚1 è¡¨ç¤ºå¾…èšåˆçš„å­—æ®µï¼ŒAggregator.Op.SUM è¡¨ç¤ºæ‰§è¡ŒåŠ æ³•æ“ä½œã€‚

éœ€è¦çœ‹æ‡‚ IntegerAggregatorTest æµ‹è¯•ç±»ã€‚å…¶ä¸­ scan1 æ˜¯ä¸€å¼ åŸºç¡€è¡¨ï¼Œsum/min/max/avg æ˜¯å››å¼ ç»è¿‡èšåˆæ“ä½œåçš„è¡¨ï¼Œç”¨äºéªŒè¯ scan1 ç»è¿‡èšåˆåçš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

`mergeTupleIntoGroup()` æ ¹æ® gbField å­—æ®µå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œ group by ã€‚å¦‚æœéœ€è¦ï¼Œé‚£ä¹ˆæ ¹æ® gbField ä» tup ä¸­æå–å¾…èšåˆçš„å­—æ®µï¼Œå†åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ¬¡å¡«å…¥ï¼Œç„¶åæ ¹æ®å¯¹åº” Op æ‰§è¡Œå¯¹åº”é€»è¾‘ã€‚å¦‚æœä¸éœ€è¦ group by ç›´æ¥ç´¯åŠ å³å¯ï¼Œä¸éœ€è¦æ˜ å°„ï¼Œ

StringAggregator å’Œ IntegerAggregator é€»è¾‘ç±»ä¼¼ï¼Œå¹¶ä¸”ä»…æ”¯æŒ COUNT ã€‚

Aggregate æ˜¯å°†å‰ä¸¤ä¸ªæ•´åˆä¸€ä¸‹ã€‚

## Exercise 3.

å¢åŠ  tuple æˆ–åˆ é™¤ tuple

1. ç¼–å†™ `HeapPage.java` å¹¶é€šè¿‡ `HeapPageWriteTest` ã€‚

é¦–å…ˆæ ¹æ®è¦åˆ é™¤ tuple çš„ RecordId åˆ¤æ–­æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå¦‚æœå·²ç»è¢«ä½¿ç”¨å°±æ¯”è¾ƒå½“å‰çš„ tuple å’Œå¾…åˆ é™¤çš„ tuple å¯¹è±¡ï¼Œä¸€è‡´å°±åˆ é™¤å¹¶æ ‡è®°ã€‚å¦‚æœæ²¡æœ‰è¢«ä½¿ç”¨é‚£ä¹ˆ tuple slot å°±æ˜¯ç©ºã€‚

* markDirty() ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥è®°å½•è„é¡µçš„ tidï¼Œå¦‚æœæ˜¯è„é¡µå°±åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœä¸æ˜¯å°±ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚
* isDirty() è¿”å›é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªè„é¡µï¼Œå¦‚æœæ²¡æœ‰è„é¡µå°±è¿”å› nullã€‚
* insertTuple() é¦–å…ˆåˆ¤æ–­å½“å‰é¡µé¢ td å’Œå¾…æ’å…¥ tuple çš„ TupleDesc æ˜¯å¦åŒ¹é…ã€‚ç„¶åéå†ç©ºä½™çš„ slotï¼Œå¯»æ‰¾æ’å…¥ä½ç½®æ‰¾åˆ°åæ’å…¥å¹¶è®¾ç½® RecordId ã€‚æœ€åæ ‡è®°è¯¥ä½ç½®å·²ç»è¢«æ’å…¥ã€‚
* markSlotUsed() ä¿®æ”¹ head è¡¨ç¤º tuple è¢«ä½¿ç”¨ã€‚
* deleteTuple() ä¾æ—§æ˜¯åˆ¤æ–­å½“å‰é¡µé¢ td å’Œå¾…åˆ é™¤ tuple çš„ TupleDesc æ˜¯å¦åŒ¹é…ã€‚ç„¶åæ ¹æ®å¾…åˆ é™¤çš„ tuple æ‰¾åˆ° RecordId åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œæœ€åæ ¹æ®ç´¢å¼•åˆ¤æ–­ slot æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨å°±åˆ é™¤ã€‚

2. ç¼–å†™ HeapFile.java å¹¶é€šè¿‡ `HeapFileWriteTest` 

* `insertTuple()` å¦‚æœå½“å‰æ²¡æœ‰é¡µé¢å°±è°ƒç”¨ writePage åœ¨ç£ç›˜ä¸­åˆ›å»ºç©ºé¡µã€‚ç„¶åå» BufferPool å–é¡µï¼Œæ¥ä¸‹æ¥åˆ¤æ–­å–åˆ°çš„é¡µä¸­æ˜¯å¦å«æœ‰ç©º slot ï¼Œç„¶åæ’å…¥ tuple ã€‚
* `deleteTuple()` ä» BufferPool ä¸­å–å‡º page ç„¶ååˆ é™¤ tuple ã€‚

3. ç¼–å†™ BufferPool.java ä¸­çš„ insertTuple() å’Œ deleteTuple() å¹¶é€šè¿‡ `BufferPoolWriteTest`ã€‚

## Exercise 4.

å®ç° `execution/Insert.java` å’Œ `execution/Delete.java` å¹¶é€šè¿‡ InsertTest å’Œ InsertTestï¼ŒDeleteTest system tests

## Exercise 5.

å®ç° BufferPool.java ä¸­çš„ flushPage() æ–¹æ³•ï¼Œ

é€šè¿‡ EvictionTest system test

discardPage() æ–¹æ³•æ˜¯ç›´æ¥ä»ç¼“å†²æ± ä¸­åˆ é™¤ä¸å†™å›ç£ç›˜ã€‚

ç”¨ LRU æ¥å®ç°ï¼é€šè¿‡è¿™é“é¢˜å¯ä»¥å­¦ä¼š LRU ï¼Œ[Leetcode 146. LRU ç¼“å­˜](https://leetcode-cn.com/problems/lru-cache/)ï¼Œè¿™ä¸ª[è§†é¢‘](https://www.bilibili.com/video/BV1hp4y1x7MH)è®²çš„å¾ˆå¥½ï¼ 

# Lab 3: Query Optimization

* [æ•°æ®åº“å†…æ ¸æ‚è°ˆï¼ˆä¸ƒï¼‰ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨ï¼ˆä¸Šï¼‰](https://www.infoq.cn/article/GhhQlV10HWLFQjTTxRtA)

è¿™ä¸ª lab å¤§è‡´è¦å®ç°çš„ä¸œè¥¿ï¼š

1. å®ç° TableStats ç±»ä¸­çš„æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿä½¿ç”¨ç›´æ–¹å›¾ï¼ˆIntHistogramç±»æä¾›çš„éª¨æ¶ï¼‰æˆ–ä½ è®¾è®¡çš„å…¶ä»–å½¢å¼çš„ç»Ÿè®¡æ•°æ®æ¥ä¼°è®¡è¿‡æ»¤å™¨çš„é€‰æ‹©æ€§å’Œæ‰«æçš„æˆæœ¬ã€‚
2. å®ç°JoinOptimizerç±»ä¸­çš„æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿä¼°è®¡ join çš„æˆæœ¬å’Œé€‰æ‹©æ€§ã€‚
3. ç¼–å†™JoinOptimizerä¸­çš„orderJoinsæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»ä¸ºä¸€ç³»åˆ—çš„è¿æ¥äº§ç”Ÿä¸€ä¸ªæœ€ä½³çš„é¡ºåºï¼ˆå¯èƒ½ä½¿ç”¨Selingerç®—æ³•ï¼‰ï¼Œç»™å®šå‰ä¸¤ä¸ªæ­¥éª¤ä¸­è®¡ç®—çš„ç»Ÿè®¡æ•°æ®ã€‚

åŸºäºå¼€é”€ä¼˜åŒ–å™¨çš„ä¸»è¦æ€æƒ³ï¼š

* æ ¹æ® table çš„ç»Ÿè®¡æ•°æ®æ¥ä¼°è®¡ä¸åŒæŸ¥è¯¢è®¡åˆ’çš„å¼€é”€ã€‚é€šå¸¸ä¸€ä¸ªè®¡åˆ’çš„æˆæœ¬ä¸ intermediate joins å’Œ tuple æ•°é‡ï¼Œä»¥åŠ selectivity of filter å’Œ join predicates çš„é€‰æ‹©æ€§æœ‰å…³ã€‚
* æ ¹æ®ç»Ÿè®¡æ•°æ®ä»¥æœ€ä½³æ–¹å¼æ’åˆ—è¿æ¥å’Œé€‰æ‹©ï¼Œå¹¶ä»å‡ ä¸ªå¤‡é€‰æ–¹æ¡ˆä¸­é€‰æ‹©è¿æ¥ç®—æ³•çš„æœ€ä½³å®ç°ã€‚

ä¼˜åŒ–å™¨å°†ä¼šè¢« `simpledb/Parser.java` è°ƒç”¨ï¼Œå†™å®éªŒä¹‹å‰å›é¡¾ [lab 2 parser exercise](https://github.com/MIT-DB-Class/simple-db-hw-2021/blob/master/lab2.md#27-query-parser)

## Exercise 1: IntHistogram.java

å®ç° IntHistogram å¹¶é€šè¿‡ IntHistogramTestã€‚

é’ˆå¯¹ä¸€ä¸ªå­—æ®µæ„å»ºä¸€å¼ ç›´æ–¹å›¾ï¼Œæ¨ªåæ ‡ä»£è¡¨å±æ€§å¯¹åº”èŒƒå›´ï¼Œçºµåæ ‡ä»£è¡¨å¯¹åº”èŒƒå›´å†… tuple çš„æ•°é‡ã€‚

å æ¯”è®¡ç®— `(h / w) / ntups`  ntups æ˜¯çºµåæ ‡çš„ç´¯åŠ å’Œï¼Œä¹Ÿå°±æ˜¯ tuple çš„æ€»æ•°ã€‚

éƒ¨åˆ†åŒºé—´çš„å æ¯” ï¼š`b_part =ï¼ˆb_right - constï¼‰/ w_b` `b_f = h_b / ntups` `b_f x b_part`

* `addValue(int v)`

æ ¹æ®è¾“å…¥æ•°æ®æ„å»ºç›´æ–¹å›¾çš„åˆ†éƒ¨ï¼Œè®¡ç®—å‡ºå¯¹åº”æ¡¶åºå·ç´¯åŠ å³å¯ã€‚

* `estimateSelectivity(Predicate.Op op, int v)` ä¼°è®¡

è¿™ä¸ªç±»ç”¨æ¥è®¡ç®—å æ¯”ã€‚å…·ä½“çš„è®¡ç®—è§„åˆ™æ˜¯æ ¹æ®è¿ç®—ç¬¦ op åˆ¤æ–­(å¤§äºï¼Œå°äºï¼Œç­‰äº...)ï¼Œv å°±æ˜¯ const ï¼Œéå†ã€‚ä¾‹å¦‚ op æ˜¯å¤§äºï¼Œ v æ˜¯ 3 ï¼Œé‚£ä¹ˆå°±æ˜¯è®¡ç®—æ¨ªåæ ‡å¤§äº 3 æ‰€æœ‰ tuple ä¸ªæ•°é™¤ä»¥æ€» tuple ä¸ªæ•°(ntuple)ã€‚ä¹Ÿå°±æ˜¯å¤§äº 3 tuple å æ€» tuple çš„ç™¾åˆ†æ¯”ã€‚

## Exercise 2: TableStats.java

å®ç° TableStats å¹¶é€šè¿‡ TableStatsTestã€‚

* å®ç°TableStatsæ„é€ å‡½æ•°

ä¸º table çš„æ¯ä¸€ä¸ª field æ„å»ºä¸€å¼ ç›´æ–¹å›¾ã€‚

æ ¹æ® tableid æ‹¿åˆ° tableï¼Œç„¶åéå† table çš„æ¯ä¸ªå­—æ®µ(field)æ„å»ºç›´æ–¹å›¾ã€‚æ³¨æ„ field åˆ†ä¸ºæ•´æ•°å’Œå­—ç¬¦ä¸²ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«ç”¨ map æ¥å­˜ã€‚

é¦–å…ˆè·å–æ¯ä¸€åˆ—å¯¹åº”çš„å†…å®¹ï¼Œæ”¾å…¥ list ä¸­ã€‚ç„¶åè·å–æ‰€æœ‰åˆ—çš„å†…å®¹ï¼Œä¸€åˆ—å°±æ˜¯ä¸€ä¸ª field ï¼Œä¸€åˆ—ç”Ÿæˆä¸€ä¸ªç›´æ–¹å›¾ã€‚

* estimateScanCost() 

IO æˆæœ¬æ˜¯é¡µæ•°ä¹˜ä¸Šå•é¡µ IO çš„å¼€é”€ã€‚

* estimateTableCardinality()

tuple æ€»æ•°ä¹˜ä¸Šç³»æ•° (selectivityFactor)ã€‚

* estimateSelectivity()

æ ¹æ®è¾“å…¥çš„å‚æ•°æ¥ä¼°è®¡ Selectivity ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å¾…ä¼°è®¡çš„å­—æ®µï¼Œæ¯”è¾ƒç¬¦å·ï¼Œconstã€‚åŒºåˆ†field çš„int å’Œ string åˆ†åˆ«è°ƒç”¨ estimateSelectivity() å³å¯ã€‚

## Exercise 3: Join Cost Estimation

ç¼–å†™ JoinOptimizer å¹¶é€šè¿‡ JoinOptimizerTest ä¸­çš„ estimateJoinCostTest å’Œ estimateJoinCardinality å³å¯ã€‚

* å®ç° `estimateJoinCost()` æ–¹æ³•ï¼Œä¼°è®¡ join çš„æˆæœ¬ã€‚

è®¡ç®—å…¬å¼ï¼š

  joincost(t1 join t2) = scancost(t1) + ntups(t1) x scancost(t2) //IO cost
                      + ntups(t1) x ntups(t2)  //CPU cost

> Nested-loop (NL) joinæ˜¯æ‰€æœ‰joinç®—æ³•ä¸­æœ€naiveçš„ä¸€ç§ã€‚å‡è®¾æœ‰ä¸¤å¼ è¡¨Rå’ŒSï¼ŒNL joinä¼šç”¨äºŒé‡å¾ªç¯çš„æ–¹æ³•æ‰«ææ¯ä¸ª(r, s)å¯¹ï¼Œå¦‚æœè¡Œrå’Œè¡Œsæ»¡è¶³joinçš„æ¡ä»¶ï¼Œå°±è¾“å‡ºä¹‹ã€‚æ˜¾ç„¶ï¼Œå…¶I/Oå¤æ‚åº¦ä¸ºO(|R||S|)ã€‚éšç€å‚ä¸joinçš„è¡¨ä¸ªæ•°å¢åŠ ï¼Œå¾ªç¯åµŒå¥—çš„å±‚æ•°å°±è¶Šå¤šï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿè¶Šé«˜ã€‚å› æ­¤è™½ç„¶å®ƒçš„å®ç°å¾ˆç®€å•ï¼Œä½†æ•ˆç‡ä¹Ÿè¾ƒä½ã€‚

æ€»ç»“ï¼šæˆæœ¬ (cost) åˆ†ä¸º I/O æˆæœ¬å’Œ CPU æˆæœ¬ã€‚I/O æˆæœ¬æ˜¯æ‰«æè¡¨æ—¶å’Œç£ç›˜äº¤äº’æ‰€äº§ç”Ÿçš„ï¼Œè€Œ CPU æˆæœ¬æ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦ç¬¦åˆæ¡ä»¶æ‰€äº§ç”Ÿçš„ã€‚å…¶ä¸­ cost1 æ˜¯æ‰«æ t1 çš„ I/O æˆæœ¬ï¼Œcost2 åŒç†ã€‚å› ä¸ºæ˜¯ NL join æ‰€ä»¥æ€»çš„ I/O å¼€é”€å°±æ˜¯ `cost1 + card1 * cost2` ã€‚è€Œ CPU å¼€é”€åˆ™æ˜¯ `card1 * card2` ã€‚æ€»æˆæœ¬ç›¸åŠ å³å¯ã€‚

* estimateJoinCardinality ä¼°è®¡ join åäº§ç”Ÿçš„ tuple æ•°ã€‚

lab3.md ä¸­ 2.2.4 Join Cardinality éƒ¨åˆ†æœ‰è¯¦ç»†è§£é‡Šã€‚

Cardinality è¡¨ç¤ºä¸€åˆ—æ•°æ®ä¸­æ•°æ®çš„é‡å¤ç¨‹åº¦ï¼Œå¦‚æœç­‰äº 1 é‚£ä¹ˆæ•°æ®æ²¡æœ‰é‡å¤çš„ï¼Œå¦‚æœç­‰äº 0 é‚£ä¹ˆå…¨éƒ¨éƒ½é‡å¤ï¼Œå…¶ä»–æƒ…å†µåŠ è½½ [0 , 1] ä¹‹é—´ã€‚å…·ä½“å¯å‚è€ƒï¼š[What is cardinality in Databases?](https://stackoverflow.com/questions/10621077/what-is-cardinality-in-databases) ã€‚

å¯¹äºç­‰ä»·è¿æ¥() å…¶ä¸­ä¸€ä¸ªå±æ€§æ˜¯ä¸»é”®æ—¶ï¼Œç”±è¿æ¥äº§ç”Ÿçš„ tuples çš„æ•°é‡ä¸èƒ½å¤§äºéä¸»é”®å±æ€§çš„cardinalityã€‚åªè¦ä¿è¯è¿™ä¸€ç‚¹æˆç«‹å³å¯ï¼Œæ‰€ä»¥å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸»é”®çš„è¯å°±é€‰æ‹©ä¸€ä¸ªå°çš„ï¼Œä¸¤ä¸ªéƒ½æ˜¯ä¸»é”®çš„è¯é€‰æ‹©å°çš„ï¼Œä¸¤ä¸ªéƒ½ä¸æ˜¯ä¸»é”®çš„è¯é€‰æ‹©å¤§çš„ã€‚è¿™å—çš„å®ç°å¾ˆçµæ´»ã€‚

å¯¹äºéç­‰ä»·è¿æ¥æ–‡æ¡£ç»™äº†å…¬å¼ `card1 * card2 * 0.3` ã€‚

## Exercise 4: Join Ordering

å®ç° JoinOptimizer.java ä¸­çš„ orderJoins æ–¹æ³•å¹¶é€šè¿‡ JoinOptimizerTest å’Œç³»ç»Ÿæµ‹è¯• QueryTest ã€‚

ex3 å®ç°äº†å¼€é”€ä¼°è®¡å’ŒåŸºæ•°ä¸ªæ•°çš„ä¼°è®¡ã€‚è¿™ä¸ªç»ƒä¹ åˆ™æ˜¯åœ¨å¤šè¡¨è¿æ¥çš„æƒ…å†µä¸‹æ ¹æ®å¼€é”€åˆ†æé€‰æ‹©æœ€ä¼˜çš„è¿æ¥é¡ºåºã€‚ç›´æ¥æšä¸¾çš„è¯å¤æ‚åº¦æ˜¯ O(n!) ã€‚æ­¤å¤„é€‰æ‹©äº†ä¸€ç§ DP çš„æ–¹æ³•å°†å¤æ‚åº¦é™ä½åˆ°äº† O(2^n)ã€‚

é¦–å…ˆè¦ç†è§£ä»€ä¹ˆæ˜¯ left-deep-tree å¯å‚è€ƒè¿™ç¯‡[æ–‡ç« ](https://www.infoq.cn/article/JCJyMrGDQHl8osMFQ7ZR)ï¼Œå†™çš„å¾ˆå¥½ï¼

ç„¶åé˜…è¯» [Exercise 4: Join Ordering](https://blog.csdn.net/weixin_45834777/article/details/120788433?spm=1001.2014.3001.5501) éƒ¨åˆ†ã€‚

JoinOptimizer ä¸­çš„ join å±æ€§æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…¶ä¸­å­˜çš„éƒ½æ˜¯ LogicalJoinNode å¯¹è±¡ã€‚

PlanCache ç±»ï¼Œç”¨æ¥ç¼“å­˜ Selinger å®ç°ä¸­æ‰€è€ƒè™‘çš„è¿æ¥å­é›†çš„æœ€ä½³é¡ºåºï¼Œæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰¾åˆ°æœ€ä½³é¡ºåºã€‚

`enumerateSubsets(joins, i);` å…¶ä¸­ i è¡¨ç¤ºå­é›†ä¸­çš„å­é›†çš„å…ƒç´ ä¸ªæ•°ã€‚ä¾‹å¦‚ a,b,c ä¸‰å¼ è¡¨ï¼Œå½“ i=1 æ—¶ï¼Œè¿”å›æ•°æ®å¤§è‡´å½¢æ€ set(set(ab) , set(ac), set(bc)) ï¼Œ æ³¨æ„ ab æ˜¯ä¸€ä¸ª LogicalJoinNode æ‰€ä»¥å°ºå¯¸æ˜¯ 1 ã€‚å¦‚æœ i=2 ï¼Œé‚£ä¹ˆè¿”å›çš„æ•°æ®ç±»ä¼¼ set(set(ab, c) , set(ac, b), set(bc, a)) ã€‚å¯ä»¥ä¼˜åŒ–ä¸ºå›æº¯ï¼Œé¿å…åˆ›å»ºå¤§é‡å¯¹è±¡ã€‚

> è¿™å—å†…å®¹å»ºè®®é˜…è¯»å¸†èˆ¹ä¹¦ã€ŠDatabase System Conceptsã€‹ç¬¬ä¸ƒç‰ˆçš„ 16.4.1 Cost-Based Join-Order Selection éƒ¨åˆ†

# Lab 4: SimpleDB Transactions

Transactions è¢«ç¿»è¯‘ä¸ºäº‹ç‰©ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåŸå­çº§çš„æ“ä½œï¼Œé‡ç‚¹æ˜¯æ“ä½œä¸èƒ½è¢«ä¸­æ–­ã€‚ç”¨é”æ¥å®ç°åŸå­çº§åˆ«çš„æ“ä½œï¼Œä½†æ˜¯å•çº¯ç”¨é”çš„è¯å­˜åœ¨ä¸²è¡ŒåŒ–çš„é—®é¢˜ï¼Œäºæ˜¯å¼•å…¥äº† 2PL ä»è€Œä¿è¯äº†ä¸²è¡ŒåŒ–ã€‚

åœ¨ 2PL ä¸‹ï¼Œäº‹ç‰©åˆ†ä¸ºå¢é•¿é˜¶æ®µ (growing phase) å’Œæ”¶ç¼©é˜¶æ®µ (shrinking phase) ï¼ŒåŒºåˆ«åœ¨äºå‰è€…åªèƒ½ä¸æ–­åŠ é”ï¼Œè€Œåè€…åªèƒ½ä¸æ–­å‡é”ï¼Œä¸€æ—¦å¼€å§‹å‡é”å°±æ„å‘³ç€ä»å¢é•¿é˜¶æ®µè½¬ä¸ºæ”¶ç¼©é˜¶æ®µã€‚

> 2PL å»ºè®®çœ‹è¿™ä¸ªè§†é¢‘ [16-ä¸¤é˜¶æ®µé”](https://www.bilibili.com/video/BV1AZ4y1Q7vx/?spm_id_from=333.788) æˆ–è€…é˜…è¯» ã€ŠDatabase System Conceptsã€‹ 18.1.3 The Two-Phase Locking Protocol è¿™ç¯‡æ–‡ç« ä¹Ÿä¸é”™ï¼šhttps://zhuanlan.zhihu.com/p/59535337

## Exercise 1 and 2.

è¿™ä¸¤ä¸ªç»ƒä¹ æ˜¯ç¼–å†™ BufferPool  æœ€ç»ˆé€šè¿‡ LockingTest ã€‚

ä¸º BufferPool æ·»åŠ è·å–é”å’Œé‡Šæ”¾é”çš„åŠŸèƒ½ï¼Œä¿®æ”¹ getPage() å®ç° unsafeReleasePage(), holdsLock() å®ç°ä¸‹ä¸€ä¸ªç»ƒä¹ æ‰èƒ½é€šè¿‡ LockingTest ã€‚

å…·ä½“æ€è·¯ï¼Œå®ç°ä¸€ä¸ª Lock ç±»å’Œ LockManager ç±»ã€‚LockManager ç±»å®ç°ä¸‰ä¸ªåŠŸèƒ½ç”³è¯·é”ã€é‡Šæ”¾é”ã€æŸ¥çœ‹æŒ‡å®šæ•°æ®é¡µçš„æŒ‡å®šäº‹åŠ¡æ˜¯å¦æœ‰é”ã€‚

## Exercise 3.

ä¹‹å‰æ²¡æœ‰åŒºåˆ†æ˜¯å¦æ˜¯è„é¡µå°±ç›´æ¥å†™å›äº†ï¼Œä¸èƒ½å°†è„é¡µç›´æ¥æ·˜æ±°ã€‚

ä¿®æ”¹ evictPage() æ–¹æ³•ï¼Œå€’ç€éå†ï¼Œåˆ é™¤ä¸€ä¸ªéè„é¡µå³å¯ã€‚

## Exercise 4.

å®ç° `transactionComplete()` 

é€šè¿‡ TransactionTest å•å…ƒæµ‹è¯•å’Œ AbortEvictionTest ç³»ç»Ÿæµ‹è¯•

å¦‚æœ commit é‚£ä¹ˆå°±æŠŠ tid å¯¹åº”çš„æ‰€æœ‰é¡µé¢æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯å†™å…¥ç£ç›˜å¦åˆ™æŠŠè¯¥äº‹ç‰©ç›¸å…³çš„é¡µé¢åŠ è½½è¿›ç¼“å­˜ä¸­ã€‚

## Exercise 5.

æ£€æµ‹æ­»é”ï¼Œç„¶åé€šè¿‡ DeadlockTest å’Œ TransactionTest ç³»ç»Ÿæµ‹è¯•ã€‚

è®¾ç½®ä¸€ä¸ªåŒºé—´ï¼Œå¦‚æœè¶…æ—¶å°±è¯´æ˜å‘ç”Ÿæ­»é”äº†ã€‚

# lab 5

äº†è§£ B+ æ ‘ã€‚

BTreeFile ç”±å››ç§ä¸åŒçš„é¡µé¢ç»„æˆï¼Œ

* BTreeInternalPage.java å†…éƒ¨é¡µ
* BTreeLeafPage.java å¶å­é¡µ
* BTreePage.java åŒ…å«äº†å¶å­é¡µå’Œå†…éƒ¨é¡µçš„å…±åŒä»£ç 
* BTreeHeaderPage.java è·Ÿè¸ªæ–‡ä»¶ä¸­å“ªäº›é¡µæ­£åœ¨ä½¿ç”¨

## Exercise 1: BTreeFile.findLeafPage()

åœ¨ BTreeFile.java ä¸­å®ç° findLeafPage() æ–¹æ³•ï¼ŒåŠŸèƒ½æ˜¯ç»™å®šä¸€ä¸ªç‰¹å®šçš„é”®å€¼çš„æƒ…å†µä¸‹æ‰¾åˆ°åˆé€‚çš„å¶å­é¡µã€‚

å…·ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼šæ ¹èŠ‚ç‚¹æ˜¯ 6 æ˜¯ä¸€ä¸ªå†…éƒ¨é¡µï¼Œä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘äº†å¶å­é¡µã€‚å¦‚æœè¾“å…¥ 1 é‚£ä¹ˆ findLeafPage() åº”å½“è¿”å›ç¬¬ä¸€ä¸ªå¶å­é¡µã€‚å¦‚æœè¾“å…¥ 8 é‚£ä¹ˆåº”å½“è¿”å›ç¬¬äºŒä¸ªå¶å­é¡µã€‚å¦‚æœè¾“å…¥ 6 æ­¤æ—¶å·¦å³å¶å­é¡µéƒ½å«æœ‰ 6 ï¼Œå‡½æ•°åº”å½“è¿”å›ç¬¬ä¸€ä¸ªå¶å­é¡µï¼Œä¹Ÿå°±æ˜¯å·¦è¾¹çš„å¶å­é¡µã€‚

![](image/index/1644485406419.png)

findLeafPage() é€’å½’æœç´¢èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å†…éƒ¨çš„æ•°æ®å¯ä»¥é€šè¿‡ BTreeInternalPage.iterator() è®¿é—®ã€‚

å½“ key value ä¸ºç©ºçš„æ—¶å€™ï¼Œåº”å½“é€’å½’åšå·¦è¾¹çš„å­é¡µè¿›è€Œæ‰¾åˆ°æœ€å·¦è¾¹çš„å¶å­é¡µã€‚BTreePageId.javaä¸­çš„pgcateg() å‡½æ•°æ£€æŸ¥é¡µé¢çš„ç±»å‹ã€‚å¯ä»¥å‡è®¾åªæœ‰å¶å­é¡µå’Œå†…éƒ¨é¡µä¼šè¢«ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ã€‚

BTreeFile.getPage() å’Œ BufferPool.getPage() åŸç†ä¸€æ ·ä½†éœ€è¦ä¸€ä¸ªé¢å¤–çš„å‚æ•°æ¥è·Ÿè¸ªè„é¡µã€‚

findLeafPage() è®¿é—®çš„æ¯ä¸€ä¸ªå†…éƒ¨ï¼ˆéå¶å­ï¼‰é¡µé¢éƒ½åº”è¯¥ä»¥ READ_ONLY æƒé™è·å–ï¼Œé™¤äº†è¿”å›çš„å¶å­é¡µé¢ï¼Œå®ƒåº”è¯¥ä»¥ä½œä¸ºå‡½æ•°å‚æ•°æä¾›çš„æƒé™è·å–ã€‚è¿™äº›æƒé™åœ¨æœ¬å®éªŒä¸­ä¸é‡è¦ä½†æ˜¯åç»­å®éªŒä¸­å¾ˆé‡è¦ã€‚

> è¿™ä¸ªç»ƒä¹ å¾ˆç®€å•ï¼Œä¸Šé¢çš„å†…å®¹æœ¬æ¥æ˜¯æ–‡æ¡£çš„æ€»ç»“ï¼Œåæ¥å‘ç°å‡ ä¹å°±æ˜¯ä»£ç çš„æ–‡å­—ç‰ˆã€‚ã€‚ã€‚

é€šè¿‡ BTreeFileReadTest.java ä¸­çš„æ‰€æœ‰å•å…ƒæµ‹è¯•å’Œ BTreeScanTest.java ä¸­çš„ç³»ç»Ÿæµ‹è¯•ã€‚

## Exercise 2: Splitting Pages

åœ¨ BTreeFile.java ä¸­å®ç° splitLeafPage() å’Œ splitInternalPage() å¹¶é€šè¿‡ BTreeFileInsertTest.java ä¸­çš„å•å…ƒæµ‹è¯•å’Œ systemtest/BTreeFileInsertTest.java ä¸­çš„ç³»ç»Ÿæµ‹è¯•ã€‚

é€šè¿‡ findLeafPage() å¯ä»¥æ‰¾åˆ°åº”è¯¥æ’å…¥ tuple çš„æ­£ç¡®å¶å­é¡µï¼Œä½†æ˜¯é¡µæ»¡çš„æƒ…å†µä¸‹æ’å…¥ tuple å¯èƒ½ä¼šå¯¼è‡´é¡µåˆ†è£‚ï¼Œè¿›è€Œå¯¼è‡´çˆ¶èŠ‚ç‚¹åˆ†è£‚ä¹Ÿå°±æ˜¯é€’å½’åˆ†è£‚ã€‚

å¦‚æœè¢«åˆ†å‰²çš„é¡µé¢æ˜¯æ ¹é¡µé¢ï¼Œä½ å°†éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å†…éƒ¨èŠ‚ç‚¹æ¥æˆä¸ºæ–°çš„æ ¹é¡µé¢ï¼Œå¹¶æ›´æ–° BTreeRootPtrPage
å¦åˆ™ï¼Œéœ€è¦ä»¥ READ_WRITE æƒé™è·å–çˆ¶é¡µï¼Œè¿›è¡Œé€’å½’åˆ†å‰²ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª entryã€‚getParentWithEmptySlots()å¯¹äºå¤„ç†è¿™äº›ä¸åŒçš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚

åœ¨ splitLeafPage() ä¸­å°†é”®â€œå¤åˆ¶â€åˆ°çˆ¶é¡µä¸Šï¼Œé¡µèŠ‚ç‚¹ä¸­ä¿ç•™ä¸€ä»½ã€‚è€Œåœ¨ splitInternalPage() ä¸­ï¼Œä½ åº”è¯¥å°†é”®â€œæ¨â€åˆ°çˆ¶é¡µä¸Šï¼Œå†…éƒ¨èŠ‚ç‚¹ä¸ä¿ç•™ã€‚

å½“å†…éƒ¨èŠ‚ç‚¹è¢«åˆ†å‰²æ—¶ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰è¢«ç§»åŠ¨çš„å­èŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆã€‚updateParentPointers() å¾ˆæœ‰ç”¨ã€‚

æ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„é¡µé¢æ—¶ï¼Œæ— è®ºæ˜¯å› ä¸ºæ‹†åˆ†ä¸€ä¸ªé¡µé¢è¿˜æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹é¡µé¢ï¼Œéƒ½è¦è°ƒç”¨ getEmptyPage() æ¥è·å–æ–°çš„é¡µé¢ã€‚è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡å‡½æ•°ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬é‡æ–°ä½¿ç”¨å› åˆå¹¶è€Œè¢«åˆ é™¤çš„é¡µé¢ï¼ˆåœ¨ä¸‹ä¸€èŠ‚æ¶‰åŠï¼‰ã€‚

BTreeLeafPage.iterator() å’Œ BTreeInternalPage.iterator() å®ç°äº†å¶å­é¡µå’Œå†…éƒ¨é¡µè¿›è¡Œäº¤äº’ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æä¾›äº†åå‘è¿­ä»£å™¨ BTreeLeafPage.reverseIterator() å’Œ BTreeInternalPage.reverseIterator() ã€‚

BTreeEntry.java ä¸­æœ‰ä¸€ä¸ª key å’Œä¸¤ä¸ª child pointers ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ª recordId ç”¨äºè¯†åˆ«åº•å±‚é¡µé¢ä¸Šé”®å’Œå­æŒ‡é’ˆçš„ä½ç½®ã€‚

## Exercise 3: Redistributing pages

å®ç° BTreeFile.stealFromLeafPage(), BTreeFile.stealFromLeftInternalPage(), BTreeFile.stealFromRightInternalPage() å¹¶é€šè¿‡ BTreeFileDeleteTest.java ä¸­çš„ä¸€äº›å•å…ƒæµ‹è¯•ï¼ˆå¦‚testStealFromLeftLeafPageå’ŒtestStealFromRightLeafPageï¼‰

åˆ é™¤å­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹æ•°æ®æ¯”è¾ƒå¤šå¯ä»¥ä»å…„å¼ŸèŠ‚ç‚¹å€Ÿï¼Œåä¹‹æ•°æ®è¾ƒå°‘å¯ä»¥å’Œå…„å¼ŸèŠ‚ç‚¹åˆå¹¶ã€‚

stealFromLeafPage() ä¸¤ä¸ªé¡µé¢ tuple åŠ ä¸€èµ·ç„¶åé™¤äºŒï¼Œå¹³å‡åˆ†æˆä¸¤ä¸ª leaf page ã€‚

## Exercise 4: Merging pages

å®ç° BTreeFile.mergeLeafPages() å’Œ BTreeFile.mergeInternalPages() ã€‚

ç°åœ¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡ BTreeFileDeleteTest.java ä¸­çš„æ‰€æœ‰å•å…ƒæµ‹è¯•å’Œ systemtest/BTreeFileDeleteTest.java ä¸­çš„ç³»ç»Ÿæµ‹è¯•ã€‚

# Lab 6: Rollback and Recovery

æ ¹æ®æ—¥å¿—å†…å®¹å®ç° rollback å’Œ recovery ã€‚

å½“è¯»å– page æ—¶ï¼Œä»£ç ä¼šè®°ä½ page ä¸­çš„åŸå§‹å†…å®¹ä½œä¸º before-image ã€‚ å½“äº‹åŠ¡æ›´æ–° page æ—¶ï¼Œä¿®æ”¹åçš„ page ä½œä¸º after-image ã€‚ä½¿ç”¨ before-image åœ¨ aborts è¿›è¡Œ rollback å¹¶åœ¨ recovery æœŸé—´æ’¤é”€å¤±è´¥çš„äº‹åŠ¡ã€‚

## Exercise 1: LogFile.rollback()

å®ç°LogFile.javaä¸­çš„rollback()å‡½æ•°

é€šè¿‡LogTestç³»ç»Ÿæµ‹è¯•çš„TestAbortå’ŒTestAbortCommitInterleavedå­æµ‹è¯•ã€‚

rollback() å›æ»šæŒ‡å®šäº‹åŠ¡ï¼Œå·²ç»æäº¤äº†çš„äº‹åŠ¡ä¸Šä¸èƒ½æ‰§è¡Œè¯¥æ–¹æ³•ã€‚å°†ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®å†™å›ç£ç›˜ã€‚

å½“ä¸€ä¸ªäº‹åŠ¡ä¸­æ­¢æ—¶ï¼Œåœ¨è¯¥äº‹åŠ¡é‡Šæ”¾å…¶é”ä¹‹å‰ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚å®ƒçš„å·¥ä½œæ˜¯è§£é™¤äº‹åŠ¡å¯èƒ½å¯¹æ•°æ®åº“åšå‡ºçš„ä»»ä½•æ”¹å˜ã€‚


## Exercise 2: LogFile.recover()

å®ç° Implement LogFile.recover().

é‡å¯æ•°æ®åº“æ—¶ä¼šç‡å…ˆè°ƒç”¨ LogFile.recover() 

å¯¹äºæœªæäº¤çš„äº‹åŠ¡ï¼šä½¿ç”¨before-imageå¯¹å…¶è¿›è¡Œæ¢å¤ï¼Œå¯¹äºå·²æäº¤çš„äº‹åŠ¡ï¼šä½¿ç”¨after-imageå¯¹å…¶è¿›è¡Œæ¢å¤ã€‚