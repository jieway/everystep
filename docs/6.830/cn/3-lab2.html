<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Lab 2 (Chinese) - everystep</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../../favicon.svg">
    <link rel="shortcut icon" href="../../favicon.png">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/general.css">
    <link rel="stylesheet" href="../../css/chrome.css">
    <link rel="stylesheet" href="../../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../highlight.css">
    <link rel="stylesheet" href="../../tomorrow-night.css">
    <link rel="stylesheet" href="../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../../theme/style.css">


</head>
<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">ç®€ä»‹</a></li><li class="chapter-item affix "><li class="part-title">ğŸ­ æ“ä½œç³»ç»Ÿ</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.S081/0-summary.html"><strong aria-hidden="true">1.</strong> 6.S081</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.S081/1-lab1.html"><strong aria-hidden="true">1.1.</strong> Lab 1</a></li><li class="chapter-item "><a href="../../6.S081/2-lab2.html"><strong aria-hidden="true">1.2.</strong> Lab 2</a></li><li class="chapter-item "><a href="../../6.S081/3-lab3.html"><strong aria-hidden="true">1.3.</strong> Lab 3</a></li><li class="chapter-item "><a href="../../6.S081/4-lab4.html"><strong aria-hidden="true">1.4.</strong> Lab 4</a></li><li class="chapter-item "><a href="../../6.S081/5-lab5.html"><strong aria-hidden="true">1.5.</strong> Lab 5</a></li><li class="chapter-item "><a href="../../6.S081/6-lab6.html"><strong aria-hidden="true">1.6.</strong> Lab 6</a></li><li class="chapter-item "><a href="../../6.S081/7-lab7.html"><strong aria-hidden="true">1.7.</strong> Lab 7</a></li><li class="chapter-item "><a href="../../6.S081/8-lab8.html"><strong aria-hidden="true">1.8.</strong> Lab 8</a></li><li class="chapter-item "><a href="../../6.S081/9-lab9.html"><strong aria-hidden="true">1.9.</strong> Lab 9</a></li><li class="chapter-item "><a href="../../6.S081/10-lab10.html"><strong aria-hidden="true">1.10.</strong> Lab 10</a></li><li class="chapter-item "><a href="../../6.S081/11-lab11.html"><strong aria-hidden="true">1.11.</strong> Lab 11</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸš€ æ•°æ®åº“</li><li class="spacer"></li><li class="chapter-item "><a href="../../bitcask/index.html"><strong aria-hidden="true">2.</strong> ä»é›¶å®ç° BitCask å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.1.</strong> BitCask ç®€ä»‹</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.2.</strong> åˆ›å»º C++ é¡¹ç›®</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.3.</strong> æ•°æ®åœ¨å†…å­˜ä¸­</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.4.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Š</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.5.</strong> BenchMark</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.6.</strong> å®ç°åˆå¹¶</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.7.</strong> å®ç°åƒåœ¾å›æ”¶</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.8.</strong> hintfile å®ç°</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.9.</strong> å“ˆå¸Œè¡¨ä¼˜åŒ–ä¸ºå¤šçº¿ç¨‹</a></li><li class="chapter-item "><a href="../../bitcask/ch1.html"><strong aria-hidden="true">2.10.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Šå¦‚ä½•å­˜æ”¾ï¼Ÿ</a></li><li class="chapter-item "><a href="../../bitcask/ch2.html"><strong aria-hidden="true">2.11.</strong> å­˜å‚¨å¼•æ“çš„æ¥å£è®¾è®¡</a></li><li class="chapter-item "><a href="../../bitcask/ch3.html"><strong aria-hidden="true">2.12.</strong> å®ç° Setã€Get</a></li><li class="chapter-item "><a href="../../bitcask/ch4.html"><strong aria-hidden="true">2.13.</strong> åˆ é™¤é€»è¾‘å’Œ Compact </a></li></ol></li><li class="chapter-item "><a href="../../abyssdb/p0.html"><strong aria-hidden="true">3.</strong> ä»é›¶å®ç°å…³ç³»å‹æ•°æ®åº“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../abyssdb/p1.html"><strong aria-hidden="true">3.1.</strong> ä» Table å¼€å§‹</a></li><li class="chapter-item "><a href="../../abyssdb/p2.html"><strong aria-hidden="true">3.2.</strong> Part 2. å®ç° Tuple</a></li><li class="chapter-item "><a href="../../abyssdb/p3.html"><strong aria-hidden="true">3.3.</strong> Part 3. å®ç° Page</a></li><li class="chapter-item "><a href="../../abyssdb/p4.html"><strong aria-hidden="true">3.4.</strong> Part 4. å®ç° HeapFile</a></li><li class="chapter-item "><a href="../../abyssdb/p5.html"><strong aria-hidden="true">3.5.</strong> Part 5. å®ç° BufferPool</a></li><li class="chapter-item "><a href="../../abyssdb/p6.html"><strong aria-hidden="true">3.6.</strong> Part 6. æ”¯æŒ int å’Œ string ç­‰æ•°æ®ç±»å‹ã€‚</a></li><li class="chapter-item "><a href="../../abyssdb/p7.html"><strong aria-hidden="true">3.7.</strong> Part 7. å®ç° Catalog</a></li></ol></li><li class="chapter-item expanded "><a href="../../6.830/1-lab0.html"><strong aria-hidden="true">4.</strong> 6.830</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.830/ans/2-lab1-ans.html"><strong aria-hidden="true">4.1.</strong> Lab 1 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/3-lab2-ans.html"><strong aria-hidden="true">4.2.</strong> Lab 2 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/4-lab3-ans.html"><strong aria-hidden="true">4.3.</strong> Lab 3 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/5-lab4-ans.html"><strong aria-hidden="true">4.4.</strong> Lab 4 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/6-lab5-ans.html"><strong aria-hidden="true">4.5.</strong> Lab 5 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/7-lab6-ans.html"><strong aria-hidden="true">4.6.</strong> Lab 6 Answers</a></li><li class="chapter-item "><a href="../../6.830/cn/2-lab1.html"><strong aria-hidden="true">4.7.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item expanded "><a href="../../6.830/cn/3-lab2.html" class="active"><strong aria-hidden="true">4.8.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/4-lab3.html"><strong aria-hidden="true">4.9.</strong> Lab 3 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/5-lab4.html"><strong aria-hidden="true">4.10.</strong> Lab 4 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/6-lab5.html"><strong aria-hidden="true">4.11.</strong> Lab 5 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/7-lab6.html"><strong aria-hidden="true">4.12.</strong> Lab 6 (Chinese)</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ§Š åˆ†å¸ƒå¼</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.824/0-lab0.html"><strong aria-hidden="true">5.</strong> 6.824</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.824/1-lab1-cn.html"><strong aria-hidden="true">5.1.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item "><a href="../../6.824/1-lab1.html"><strong aria-hidden="true">5.2.</strong> Lab 1</a></li><li class="chapter-item "><a href="../../6.824/2-lab2-cn.html"><strong aria-hidden="true">5.3.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../../6.824/2-lab2.html"><strong aria-hidden="true">5.4.</strong> Lab 2</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ”¥ å…¶ä»–</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.828/0-sum.html"><strong aria-hidden="true">6.</strong> 6.828</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.828/1-env.html"><strong aria-hidden="true">6.1.</strong> Environment Setup</a></li><li class="chapter-item "><a href="../../6.828/1-part1.html"><strong aria-hidden="true">6.2.</strong> Part 1</a></li></ol></li><li class="chapter-item "><a href="../../review/1_go.html"><strong aria-hidden="true">7.</strong> å…«è‚¡</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../review/2_cpp.html"><strong aria-hidden="true">7.1.</strong> C++</a></li><li class="chapter-item "><a href="../../review/3_cn.html"><strong aria-hidden="true">7.2.</strong> Computer Networks</a></li></ol></li><li class="chapter-item "><a href="../../lsm/index.html"><strong aria-hidden="true">8.</strong> ä»é›¶å®ç° LSM-Tree å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../lsm/ch1.html"><strong aria-hidden="true">8.1.</strong> Part 1</a></li><li class="chapter-item "><a href="../../lsm/ch2.html"><strong aria-hidden="true">8.2.</strong> Part 2</a></li><li class="chapter-item "><a href="../../lsm/ch3.html"><strong aria-hidden="true">8.3.</strong> Part 3</a></li><li class="chapter-item "><a href="../../lsm/ch4.html"><strong aria-hidden="true">8.4.</strong> Part 4</a></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">everystep</h1>

                <div class="right-buttons">
                    <a href="../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep/edit/master/src/6.830/cn/3-lab2.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');

                // Get viewed page store
                var viewed_key = 'mdbook-viewed';
                var viewed_map = {};
                try {
                    var viewed_storage = localStorage.getItem(viewed_key);
                    if (viewed_storage) {
                        viewed_map = JSON.parse(viewed_storage)
                    }
                } catch (e) { }

                Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);

                    // Apply viewed style
                    if (viewed_map[link.pathname]) {
                        link.classList.add('md-viewed')
                    }
                }); 

                // Mark viewed after 30s
                setTimeout(function() {
                    viewed_map[location.pathname] = 1;
                    localStorage.setItem(viewed_key, JSON.stringify(viewed_map));
                }, 30000)
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc"><nav class="pagetoc"></nav></div>
                <main>
                    <h1 id="lab-2-ç¿»è¯‘"><a class="header" href="#lab-2-ç¿»è¯‘">Lab 2 ç¿»è¯‘</a></h1>
<p><strong>Assigned: Tue, Mar 9, 2021</strong><br>
<strong>Due: Fri, Mar 19, 2021 11:59 PM EDT</strong></p>
<!--
Version History:


3/1/12 : Initial version
-->
<p>In this lab assignment, you will write a set of operators for SimpleDB to implement table modifications (e.g., insert and delete records), selections, joins, and aggregates. These will build on top of the foundation that you wrote in Lab 1 to provide you with a database system that can perform simple queries over multiple tables.</p>
<p>åœ¨è¿™ä¸ªå®éªŒä»»åŠ¡ä¸­ï¼Œä½ å°†ä¸º SimpleDB ç¼–å†™ä¸€ç»„æ“ä½œç¬¦ï¼Œä»¥å®ç°è¡¨çš„ä¿®æ”¹ï¼ˆå¦‚æ’å…¥å’Œåˆ é™¤è®°å½•ï¼‰ã€é€‰æ‹©ã€è¿æ¥å’Œèšåˆã€‚è¿™äº›å°†å»ºç«‹åœ¨ä½ åœ¨å®éªŒ1ä¸­ç¼–å†™çš„åŸºç¡€ä¹‹ä¸Šï¼Œä¸ºä½ æä¾›ä¸€ä¸ªå¯ä»¥å¯¹å¤šä¸ªè¡¨è¿›è¡Œç®€å•æŸ¥è¯¢çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p>
<p>Additionally, we ignored the issue of buffer pool management in Lab 1: we have not dealt with the problem that arises when we reference more pages than we can fit in memory over the lifetime of the database. In Lab 2, you will design an eviction policy to flush stale pages from the buffer pool.</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨å®éªŒ1ä¸­å¿½ç•¥äº†ç¼“å†²æ± ç®¡ç†çš„é—®é¢˜ï¼šæˆ‘ä»¬æ²¡æœ‰å¤„ç†å½“æˆ‘ä»¬å¼•ç”¨çš„é¡µé¢è¶…è¿‡äº†æ•°æ®åº“ç”Ÿå‘½å‘¨æœŸå†…æ‰€èƒ½å®¹çº³çš„å†…å­˜æ—¶å‡ºç°çš„é—®é¢˜ã€‚åœ¨å®éªŒ2ä¸­ï¼Œä½ å°†è®¾è®¡ä¸€ä¸ªé©±é€ç­–ç•¥ï¼Œä»ç¼“å†²æ± ä¸­å†²èµ°é™ˆæ—§çš„é¡µé¢ã€‚</p>
<p>You do not need to implement transactions or locking in this lab.</p>
<p>ä½ ä¸éœ€è¦åœ¨è¿™ä¸ªå®éªŒä¸­å®ç°äº‹åŠ¡æˆ–é”å®šã€‚</p>
<p>The remainder of this document gives some suggestions about how to start coding, describes a set of exercises to help you work through the lab, and discusses how to hand in your code. This lab requires you to write a fair amount of code, so we encourage you to <strong>start early</strong>!</p>
<p>æœ¬æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†ç»™å‡ºäº†ä¸€äº›å…³äºå¦‚ä½•å¼€å§‹ç¼–ç çš„å»ºè®®ï¼Œæè¿°äº†ä¸€ç»„ç»ƒä¹ ï¼Œä»¥å¸®åŠ©ä½ å®Œæˆå®éªŒçš„å·¥ä½œï¼Œå¹¶è®¨è®ºäº†å¦‚ä½•äº¤å‡ºä½ çš„ä»£ç ã€‚è¿™ä¸ªå®éªŒéœ€è¦ä½ å†™ç›¸å½“æ•°é‡çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬é¼“åŠ±ä½ <strong>æ—©å¼€å§‹</strong>!</p>
<p><a name="starting"></a></p>
<h2 id="1-getting-started"><a class="header" href="#1-getting-started">1. Getting started</a></h2>
<p>You should begin with the code you submitted for Lab 1 (if you did not submit code for Lab 1, or your solution didn't work properly, contact us to discuss options).  Additionally, we are providing extra source and test files for this lab that are not in the original code distribution you received.</p>
<p>ä½ åº”è¯¥ä»ä½ ä¸ºå®éªŒ 1 æäº¤çš„ä»£ç å¼€å§‹ï¼ˆå¦‚æœä½ æ²¡æœ‰ä¸ºå®éªŒ1æäº¤ä»£ç ï¼Œæˆ–è€…ä½ çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰æ­£å¸¸å·¥ä½œï¼Œè¯·ä¸æˆ‘ä»¬è”ç³»ï¼Œè®¨è®ºå„ç§é€‰æ‹©ï¼‰ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¸ºè¿™ä¸ªå®éªŒæä¾›äº†é¢å¤–çš„æºæ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸åœ¨ä½ æ”¶åˆ°çš„åŸå§‹ä»£ç åˆ†å‘ä¸­ã€‚</p>
<h3 id="11-getting-lab-2"><a class="header" href="#11-getting-lab-2">1.1. Getting Lab 2</a></h3>
<p>You will need to add these new files to your release. The easiest way to do this is to navigate to your project directory (probably called simple-db-hw) and pull from the master GitHub repository:</p>
<p>ä½ å°†éœ€è¦æŠŠè¿™äº›æ–°æ–‡ä»¶æ·»åŠ åˆ°ä½ çš„ç‰ˆæœ¬ä¸­ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å¯¼èˆªåˆ°ä½ çš„é¡¹ç›®ç›®å½•ï¼ˆå¯èƒ½å«simple-db-hwï¼‰ï¼Œç„¶åä»GitHubçš„ä¸»ä»“åº“æ‹‰å‡ºã€‚</p>
<pre><code>$ cd simple-db-hw
$ git pull upstream master
</code></pre>
<p><strong>IDE users</strong> will have update their project dependency to include the new library jars. For an easy solution, run</p>
<p><strong>IDEç”¨æˆ·</strong>å°†ä¸å¾—ä¸æ›´æ–°ä»–ä»¬çš„é¡¹ç›®ä¾èµ–å…³ç³»ï¼Œä»¥åŒ…æ‹¬æ–°çš„åº“çš„jarsã€‚å¯¹äºä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œè¿è¡Œ</p>
<pre><code>ant eclipse
</code></pre>
<p>again, and reopen the project with either Eclipse or IntelliJ. </p>
<p>å†ä¸€æ¬¡ï¼Œç”¨Eclipseæˆ–IntelliJé‡æ–°æ‰“å¼€é¡¹ç›®ã€‚</p>
<p>If you have made other changes to your project setup and do not want to lose them, you can also add the dependencies manually. For eclipse, under the package explorer, right click the project name (probably <code>simple-db-hw</code>),  and select <strong>Properties</strong>.  Choose <strong>Java Build Path</strong> on the left-hand-side, and click on the <strong>Libraries</strong> tab on the right-hand-side.  Push the <strong>Add JARs...</strong> button, select <strong>zql.jar</strong> and <strong>jline-0.9.94.jar</strong>, and push <strong>OK</strong>, followed by <strong>OK</strong>.  Your code should now compile. For IntelliJ, go to <strong>Project Structure</strong> under <strong>File</strong>, and under <strong>Modules</strong>, select the <code>simpledb</code> project, and navigate to the <strong>Dependencies</strong> tab. On the bottom of the pane, click on the <code>+</code> icon to add the jars as compile-time dependencies. </p>
<p>å¦‚æœä½ å·²ç»å¯¹ä½ çš„é¡¹ç›®è®¾ç½®åšäº†å…¶ä»–çš„ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸æƒ³å¤±å»å®ƒä»¬ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ ä¾èµ–å…³ç³»ã€‚å¯¹äºeclipseï¼Œåœ¨åŒ…èµ„æºç®¡ç†å™¨ä¸‹ï¼Œå³å‡»é¡¹ç›®åç§°ï¼ˆå¯èƒ½æ˜¯<code>simple-db-hw</code>ï¼‰ï¼Œå¹¶é€‰æ‹©<strong>å±æ€§</strong>ã€‚ åœ¨å·¦ä¾§é€‰æ‹©<strong>Java Build Path</strong>ï¼Œå¹¶ç‚¹å‡»å³ä¾§çš„<strong>Libraries</strong>æ ‡ç­¾ã€‚ æŒ‰ä¸‹<strong>æ·»åŠ JARs...<strong>æŒ‰é’®ï¼Œé€‰æ‹©</strong>zql.jar</strong>å’Œ<strong>jline-0.9.94.jar</strong>ï¼Œç„¶åæŒ‰ä¸‹<strong>OK</strong>ï¼Œæ¥ç€æŒ‰ä¸‹<strong>OK</strong>ã€‚ ä½ çš„ä»£ç ç°åœ¨åº”è¯¥å¯ä»¥ç¼–è¯‘äº†ã€‚å¯¹äºIntelliJï¼Œè¿›å…¥<strong>æ–‡ä»¶ä¸‹çš„</strong>é¡¹ç›®ç»“æ„ï¼Œåœ¨<strong>æ¨¡å—ä¸‹ï¼Œé€‰æ‹©<code>simpledb</code>é¡¹ç›®ï¼Œå¹¶å¯¼èˆªåˆ°</strong>ä¾èµ–å…³ç³»**æ ‡ç­¾ã€‚åœ¨çª—æ ¼çš„åº•éƒ¨ï¼Œç‚¹å‡» &quot;+&quot;å›¾æ ‡ï¼Œå°†ç½å­æ·»åŠ ä¸ºç¼–è¯‘æ—¶çš„ä¾èµ–é¡¹ã€‚</p>
<h3 id="12-implementation-hints"><a class="header" href="#12-implementation-hints">1.2. Implementation hints</a></h3>
<p>As before, we <strong>strongly encourage</strong> you to read through this entire document to get a feel for the high-level design of SimpleDB before you write code.</p>
<p>å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬<strong>å¼ºçƒˆå»ºè®®</strong>ä½ åœ¨å†™ä»£ç ä¹‹å‰é€šè¯»æ•´ä¸ªæ–‡æ¡£ä»¥äº†è§£SimpleDBçš„é¡¶å±‚è®¾è®¡ã€‚</p>
<p>We suggest exercises along this document to guide your implementation, but you may find that a different order makes more sense for you. As before, we will grade your assignment by looking at your code and verifying that you have passed the test for the ant targets <code>test</code> and <code>systemtest</code>. Note the code only needs to pass the tests we indicate in this lab, not all of unit and system tests. See Section 3.4 for a complete discussion of grading and list of the tests you will need to pass.</p>
<p>æˆ‘ä»¬å»ºè®®æ²¿ç€è¿™ä»½æ–‡ä»¶è¿›è¡Œç»ƒä¹ ï¼Œä»¥æŒ‡å¯¼ä½ çš„å®æ–½ï¼Œä½†ä½ å¯èƒ½ä¼šå‘ç°ä¸åŒçš„é¡ºåºå¯¹ä½ æ›´æœ‰æ„ä¹‰ã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å°†é€šè¿‡æŸ¥çœ‹ä½ çš„ä»£ç å¹¶éªŒè¯ä½ æ˜¯å¦é€šè¿‡äº† ant ç›®æ ‡<code>test</code>å’Œ<code>systemtest</code>çš„æµ‹è¯•æ¥ç»™ä½ çš„ä½œä¸šè¯„åˆ†ã€‚è¯·æ³¨æ„ï¼Œä»£ç åªéœ€è¦é€šè¿‡æˆ‘ä»¬åœ¨è¿™ä¸ªå®éªŒä¸­æŒ‡å‡ºçš„æµ‹è¯•ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„å•å…ƒå’Œç³»ç»Ÿæµ‹è¯•ã€‚å…³äºåˆ†çº§çš„å®Œæ•´è®¨è®ºå’Œä½ éœ€è¦é€šè¿‡çš„æµ‹è¯•åˆ—è¡¨ï¼Œè§ç¬¬3.4èŠ‚ã€‚</p>
<p>Here's a rough outline of one way you might proceed with your SimpleDB implementation; more details on the steps in this outline, including exercises, are given in Section 2 below.</p>
<p>ä¸‹é¢æ˜¯ä½ å¯èƒ½è¿›è¡ŒSimpleDBå®ç°çš„ä¸€ä¸ªç²—ç•¥çš„å¤§çº²ï¼›å…³äºè¿™ä¸ªå¤§çº²ä¸­çš„æ­¥éª¤çš„æ›´å¤šç»†èŠ‚ï¼ŒåŒ…æ‹¬ç»ƒä¹ ï¼Œåœ¨ä¸‹é¢ç¬¬2èŠ‚ä¸­ç»™å‡ºã€‚</p>
<ul>
<li>Implement the operators <code>Filter</code> and <code>Join</code> and verify that their corresponding tests work. The Javadoc comments for these operators contain details about how they should work. We have given you implementations of <code>Project</code> and <code>OrderBy</code> which may help you understand how other operators work.</li>
</ul>
<p>å®ç°è¿ç®—ç¬¦<code>Filter</code>å’Œ<code>Join</code>ï¼Œå¹¶éªŒè¯å…¶ç›¸åº”çš„æµ‹è¯•æ˜¯å¦æœ‰æ•ˆã€‚è¿™äº›æ“ä½œç¬¦çš„ Javadoc æ³¨é‡ŠåŒ…å«äº†å…³äºå®ƒä»¬å¦‚ä½•å·¥ä½œçš„ç»†èŠ‚ã€‚æˆ‘ä»¬å·²ç»ç»™ä½ æä¾›äº† <code>Project</code> å’Œ <code>OrderBy</code> çš„å®ç°ï¼Œè¿™å¯èƒ½æœ‰åŠ©äºä½ ç†è§£å…¶ä»–æ“ä½œç¬¦çš„å·¥ä½œã€‚</p>
<ul>
<li>Implement <code>IntegerAggregator</code> and <code>StringAggregator</code>. Here, you will write the logic that actually computes an aggregate over a particular field across multiple groups in a sequence of input tuples. Use integer division for computing the average, since SimpleDB only supports integers. StringAggegator only needs to support the COUNT aggregate, since the other operations do not make sense for strings.</li>
</ul>
<p>å®ç° <code>IntegerAggregator</code> å’Œ <code>StringAggregator</code> ã€‚åœ¨è¿™é‡Œï¼Œä½ å°†ç¼–å†™ä¸€ä¸ªé€»è¾‘ï¼Œå®é™…è®¡ç®—ä¸€ä¸ªç‰¹å®šå­—æ®µåœ¨è¾“å…¥ tuple åºåˆ—çš„å¤šä¸ªç»„ä¸­çš„èšåˆã€‚ä½¿ç”¨æ•´æ•°é™¤æ³•æ¥è®¡ç®—å¹³å‡æ•°ï¼Œå› ä¸º SimpleDB åªæ”¯æŒæ•´æ•°ã€‚StringAggegator åªéœ€è¦æ”¯æŒ COUNT èšåˆï¼Œå› ä¸ºå…¶ä»–æ“ä½œå¯¹å­—ç¬¦ä¸²æ²¡æœ‰æ„ä¹‰ã€‚</p>
<ul>
<li>Implement the <code>Aggregate</code> operator. As with other operators, aggregates implement the <code>OpIterator</code> interface so that they can be placed in SimpleDB query plans. Note that the output of an <code>Aggregate</code> operator is an aggregate value of an entire group for each call to <code>next()</code>, and that the aggregate constructor takes the aggregation and grouping fields.</li>
</ul>
<p>å®ç°<code>Aggregate</code>æ“ä½œç¬¦ã€‚å’Œå…¶ä»–è¿ç®—ç¬¦ä¸€æ ·ï¼Œèšåˆè¿ç®—ç¬¦å®ç°äº† <code>OpIterator</code> æ¥å£ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥æ”¾åœ¨ SimpleDB æŸ¥è¯¢è®¡åˆ’ä¸­ã€‚æ³¨æ„<code>Aggregate</code>è¿ç®—ç¬¦çš„è¾“å‡ºæ˜¯æ¯æ¬¡è°ƒç”¨<code>next()</code>æ—¶æ•´ä¸ªç»„çš„èšåˆå€¼ï¼Œå¹¶ä¸”èšåˆæ„é€ å™¨éœ€è¦èšåˆå’Œåˆ†ç»„å­—æ®µã€‚</p>
<ul>
<li>Implement the methods related to tuple insertion, deletion, and page eviction in <code>BufferPool</code>. You do not need to worry about transactions at this point.</li>
</ul>
<p>åœ¨ <code>BufferPool</code> ä¸­å®ç°ä¸å…ƒç»„æ’å…¥ã€åˆ é™¤å’Œé¡µé¢é©±é€æœ‰å…³çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒ transactions çš„é—®é¢˜ã€‚</p>
<ul>
<li>Implement the <code>Insert</code> and <code>Delete</code> operators. Like all operators,  <code>Insert</code> and <code>Delete</code> implement <code>OpIterator</code>, accepting a stream of tuples to insert or delete and outputting a single tuple with an integer field that indicates the number of tuples inserted or deleted. These operators will need to call the appropriate methods in <code>BufferPool</code> that actually modify the pages on disk. Check that the tests for inserting and deleting tuples work properly.</li>
</ul>
<p>å®ç°<code>æ’å…¥</code>å’Œ<code>åˆ é™¤</code>æ“ä½œç¬¦ã€‚åƒæ‰€æœ‰çš„æ“ä½œç¬¦ä¸€æ ·ï¼Œ<code>Insert</code>å’Œ<code>Delete</code>å®ç°äº†<code>OpIterator</code>ï¼Œæ¥å—ä¸€ä¸ªè¦æ’å…¥æˆ–åˆ é™¤çš„ tuple æµï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå¸¦æœ‰æ•´æ•°å­—æ®µçš„å•ä¸€ tuple ï¼Œè¡¨ç¤ºæ’å…¥æˆ–åˆ é™¤çš„ tuple æ•°é‡ã€‚è¿™äº›æ“ä½œè€…å°†éœ€è¦è°ƒç”¨<code>BufferPool</code>ä¸­çš„é€‚å½“æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®é™…ä¸Šæ˜¯ä¿®æ”¹ç£ç›˜ä¸Šçš„é¡µé¢ã€‚æ£€æŸ¥æ’å…¥å’Œåˆ é™¤ tuple çš„æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
<p>Note that SimpleDB does not implement any kind of consistency or integrity checking, so it is possible to insert duplicate records into a file and there is no way to enforce primary or foreign key constraints.</p>
<p>è¯·æ³¨æ„ï¼ŒSimpleDBæ²¡æœ‰å®ç°ä»»ä½•ç±»å‹çš„ä¸€è‡´æ€§æˆ–å®Œæ•´æ€§æ£€æŸ¥ï¼Œæ‰€ä»¥æœ‰å¯èƒ½åœ¨æ–‡ä»¶ä¸­æ’å…¥é‡å¤çš„è®°å½•ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•å¼ºåˆ¶æ‰§è¡Œä¸»é”®æˆ–å¤–é”®çº¦æŸã€‚</p>
<p>At this point you should be able to pass the tests in the ant <code>systemtest</code> target, which is the goal of this lab.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ åº”è¯¥èƒ½å¤Ÿé€šè¿‡ant <code>systemtest</code>ç›®æ ‡ä¸­çš„æµ‹è¯•ï¼Œè¿™å°±æ˜¯æœ¬å®éªŒçš„ç›®æ ‡ã€‚</p>
<p>You'll also be able to use the provided SQL parser to run SQL queries against your database!  See <a href="#parser">Section 2.7</a> for a brief tutorial.</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨æ‰€æä¾›çš„SQLè§£æå™¨æ¥å¯¹ä½ çš„æ•°æ®åº“è¿è¡ŒSQLæŸ¥è¯¢!  è¯·å‚é˜…<a href="#parser">ç¬¬2.7èŠ‚</a>ï¼Œäº†è§£ä¸€ä¸ªç®€çŸ­çš„æ•™ç¨‹ã€‚</p>
<p>Finally, you might notice that the iterators in this lab extend the <code>Operator</code> class instead of implementing the OpIterator interface. Because the implementation of <code>next</code> <code>hasNext</code> is often repetitive, annoying, and error-prone, <code>Operator</code> implements this logic generically, and only requires that you implement a simpler <code>readNext</code>. Feel free to use this style of implementation, or just implement the <code>OpIterator</code> interface if you prefer. To implement the OpIterator interface, remove <code>extends Operator</code> from iterator classes, and in its place put <code>implements OpIterator</code>.</p>
<p>æœ€åï¼Œä½ å¯èƒ½æ³¨æ„åˆ°æœ¬å®éªŒçš„è¿­ä»£å™¨æ‰©å±•äº†<code>Operator</code>ç±»ï¼Œè€Œä¸æ˜¯å®ç°OpIteratoræ¥å£ã€‚å› ä¸º<code>next``hasNext</code>çš„å®ç°å¾€å¾€æ˜¯é‡å¤çš„ã€çƒ¦äººçš„å’Œå®¹æ˜“å‡ºé”™çš„ï¼Œ<code>Operator</code>é€šç”¨åœ°å®ç°äº†è¿™ä¸ªé€»è¾‘ï¼Œåªè¦æ±‚ä½ å®ç°ä¸€ä¸ªæ›´ç®€å•çš„<code>readNext</code>ã€‚è¯·éšæ„ä½¿ç”¨è¿™ç§å®ç°æ–¹å¼ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®ç°<code>OpIterator</code>æ¥å£ã€‚è¦å®ç°OpIteratoræ¥å£ï¼Œè¯·ä»è¿­ä»£å™¨ç±»ä¸­åˆ é™¤<code>extends Operator</code>ï¼Œå¹¶åœ¨å…¶ä½ç½®ä¸ŠåŠ ä¸Š<code>implements OpIterator</code>ã€‚</p>
<h2 id="2-simpledb-architecture-and-implementation-guide"><a class="header" href="#2-simpledb-architecture-and-implementation-guide">2. SimpleDB Architecture and Implementation Guide</a></h2>
<h3 id="21-filter-and-join"><a class="header" href="#21-filter-and-join">2.1. Filter and Join</a></h3>
<p>Recall that SimpleDB OpIterator classes implement the operations of the relational algebra. You will now implement two operators that will enable you to perform queries that are slightly more interesting than a table scan.</p>
<p>è®°å¾—SimpleDB OpIteratorç±»å®ç°äº†å…³ç³»ä»£æ•°çš„æ“ä½œã€‚ç°åœ¨ä½ å°†å®ç°ä¸¤ä¸ªè¿ç®—ç¬¦ï¼Œä½¿ä½ èƒ½å¤Ÿæ‰§è¡Œæ¯”è¡¨æ‰«ææ›´æœ‰è¶£çš„æŸ¥è¯¢ã€‚</p>
<ul>
<li><em>Filter</em>: This operator only returns tuples that satisfy a <code>Predicate</code> that is specified as part of its constructor. Hence, it filters out any tuples that do not match the predicate.</li>
</ul>
<p><em>è¿‡æ»¤å™¨</em>ã€‚è¿™ä¸ªæ“ä½œç¬¦åªè¿”å›æ»¡è¶³ &quot;è°“è¯ &quot;çš„ tuple ï¼Œ&quot;è°“è¯ &quot;æ˜¯ä½œä¸ºå…¶æ„é€ å‡½æ•°çš„ä¸€éƒ¨åˆ†æŒ‡å®šçš„ã€‚å› æ­¤ï¼Œå®ƒè¿‡æ»¤æ‰ä»»ä½•ä¸ç¬¦åˆè°“è¯çš„ tuple ã€‚</p>
<ul>
<li><em>Join</em>: This operator joins tuples from its two children according to a <code>JoinPredicate</code> that is passed in as part of its constructor. We only require a simple nested loops join, but you may explore more interesting join implementations. Describe your implementation in your lab writeup.</li>
</ul>
<p><em>Join</em>: è¿™ä¸ªæ“ä½œç¬¦æ ¹æ®ä½œä¸ºå…¶æ„é€ å‡½æ•°ä¸€éƒ¨åˆ†ä¼ å…¥çš„ &quot;JoinPredicate &quot;æ¥è¿æ¥å…¶ä¸¤ä¸ªå­ä»£çš„ tuple ã€‚æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç®€å•çš„åµŒå¥—å¾ªç¯è¿æ¥ï¼Œä½†ä½ å¯ä»¥æ¢ç´¢æ›´æœ‰è¶£çš„è¿æ¥å®ç°ã€‚åœ¨ä½ çš„å®éªŒæŠ¥å‘Šä¸­æè¿°ä½ çš„å®ç°ã€‚</p>
<p><strong>Exercise 1.</strong></p>
<p>Implement the skeleton methods in:</p>
<hr />
<ul>
<li>src/java/simpledb/execution/Predicate.java</li>
<li>src/java/simpledb/execution/JoinPredicate.java</li>
<li>src/java/simpledb/execution/Filter.java</li>
<li>src/java/simpledb/execution/Join.java</li>
</ul>
<hr />
<p>At this point, your code should pass the unit tests in PredicateTest, JoinPredicateTest, FilterTest, and JoinTest. Furthermore, you should be able to pass the system tests FilterTest and JoinTest.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡ PredicateTestã€JoinPredicateTestã€FilterTest å’Œ JoinTest ä¸­çš„å•å…ƒæµ‹è¯•ã€‚æ­¤å¤–ï¼Œä½ åº”è¯¥èƒ½å¤Ÿé€šè¿‡ç³»ç»Ÿæµ‹è¯• FilterTest å’Œ JoinTestã€‚</p>
<h3 id="22-aggregates"><a class="header" href="#22-aggregates">2.2. Aggregates</a></h3>
<p>An additional SimpleDB operator implements basic SQL aggregates with a <code>GROUP BY</code> clause. You should implement the five SQL aggregates (<code>COUNT</code>, <code>SUM</code>, <code>AVG</code>, <code>MIN</code>, <code>MAX</code>) and support grouping. You only need to support aggregates over a single field, and grouping by a single field.</p>
<p>ä¸€ä¸ªé¢å¤–çš„SimpleDBæ“ä½œç¬¦ç”¨<code>GROUP BY</code>å­å¥å®ç°äº†åŸºæœ¬çš„SQLèšåˆã€‚ä½ åº”è¯¥å®ç°äº”ä¸ªSQLèšåˆï¼ˆ<code>COUNT</code>, <code>SUM</code>, <code>AVG</code>, <code>MIN</code>, <code>MAX</code>ï¼‰å¹¶æ”¯æŒåˆ†ç»„ã€‚ä½ åªéœ€è¦æ”¯æŒå•ä¸ªå­—æ®µçš„èšåˆï¼Œä»¥åŠå•ä¸ªå­—æ®µçš„åˆ†ç»„ã€‚</p>
<p>In order to calculate aggregates, we use an <code>Aggregator</code> interface which merges a new tuple into the existing calculation of an aggregate. The <code>Aggregator</code> is told during construction what operation it should use for aggregation. Subsequently, the client code should call <code>Aggregator.mergeTupleIntoGroup()</code> for every tuple in the child iterator. After all tuples have been merged, the client can retrieve a OpIterator of aggregation results. Each tuple in the result is a pair of the form <code>(groupValue, aggregateValue)</code>, unless the value of the group by field was <code>Aggregator.NO_GROUPING</code>, in which case the result is a single tuple of the form <code>(aggregateValue)</code>.</p>
<p>ä¸ºäº†è®¡ç®—èšåˆï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª<code>Aggregator</code>æ¥å£ï¼Œå°†ä¸€ä¸ªæ–°å…ƒç»„åˆå¹¶åˆ°ç°æœ‰çš„èšåˆè®¡ç®—ä¸­ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œ<code>Aggregator</code>è¢«å‘ŠçŸ¥å®ƒåº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ“ä½œæ¥è¿›è¡Œèšåˆã€‚éšåï¼Œå®¢æˆ·ç«¯ä»£ç åº”è¯¥ä¸ºå­è¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç»„è°ƒç”¨<code>Aggregator.mergeTupleIntoGroup()</code>ã€‚åœ¨æ‰€æœ‰ tuple è¢«åˆå¹¶åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ£€ç´¢åˆ°ä¸€ä¸ªèšåˆç»“æœçš„OpIteratorã€‚ç»“æœä¸­çš„æ¯ä¸ªå…ƒç»„éƒ½æ˜¯ä¸€å¯¹å½¢å¼ä¸º<code>(groupValue, aggregateValue)</code>çš„å…ƒç»„ï¼Œé™¤égroup byå­—æ®µçš„å€¼æ˜¯<code>Aggregator.NO_GROUPING</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»“æœæ˜¯ä¸€ä¸ªå½¢å¼ä¸º<code>(aggregateValue)</code>çš„å•ä¸€å…ƒç»„ã€‚</p>
<p>Note that this implementation requires space linear in the number of distinct groups. For the purposes of this lab, you do not need to worry about the situation where the number of groups exceeds available memory.</p>
<p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªå®ç°éœ€è¦çš„ç©ºé—´ä¸ä¸åŒç»„çš„æ•°é‡æˆçº¿æ€§å…³ç³»ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒç»„çš„æ•°é‡è¶…è¿‡å¯ç”¨å†…å­˜çš„æƒ…å†µã€‚</p>
<p><strong>Exercise 2.</strong></p>
<p>Implement the skeleton methods in:</p>
<hr />
<ul>
<li>src/java/simpledb/execution/IntegerAggregator.java</li>
<li>src/java/simpledb/execution/StringAggregator.java</li>
<li>src/java/simpledb/execution/Aggregate.java</li>
</ul>
<hr />
<p>At this point, your code should pass the unit tests IntegerAggregatorTest, StringAggregatorTest, and AggregateTest. Furthermore, you should be able to pass the AggregateTest system test.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡IntegerAggregatorTestã€StringAggregatorTestå’ŒAggregateTestå•å…ƒæµ‹è¯•ã€‚æ­¤å¤–ï¼Œä½ åº”è¯¥èƒ½å¤Ÿé€šè¿‡AggregateTestçš„ç³»ç»Ÿæµ‹è¯•ã€‚</p>
<h3 id="23-heapfile-mutability"><a class="header" href="#23-heapfile-mutability">2.3. HeapFile Mutability</a></h3>
<p>Now, we will begin to implement methods to support modifying tables. We begin at the level of individual pages and files. There are two main sets of operations:  adding tuples and removing tuples.</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¼€å§‹å®ç°æ”¯æŒä¿®æ”¹è¡¨æ ¼çš„æ–¹æ³•ã€‚æˆ‘ä»¬ä»å•ä¸ªé¡µé¢å’Œæ–‡ä»¶çš„å±‚é¢å¼€å§‹ã€‚æœ‰ä¸¤ç»„ä¸»è¦çš„æ“ä½œï¼šæ·»åŠ  tuple å’Œåˆ é™¤ tuple ã€‚</p>
<p><strong>Removing tuples:</strong> To remove a tuple, you will need to implement <code>deleteTuple</code>. Tuples contain <code>RecordIDs</code> which allow you to find the page they reside on, so this should be as simple as locating the page a tuple belongs to and modifying the headers of the page appropriately.</p>
<p>**åˆ é™¤ tuple ï¼š**è¦åˆ é™¤ä¸€ä¸ª tuple ï¼Œä½ éœ€è¦å®ç°<code>deleteTuple</code>ã€‚å…ƒç»„åŒ…å«`è®°å½•ID'ï¼Œå…è®¸ä½ æ‰¾åˆ°å®ƒä»¬æ‰€åœ¨çš„é¡µé¢ï¼Œæ‰€ä»¥è¿™åº”è¯¥å¾ˆç®€å•ï¼Œåªè¦æ‰¾åˆ°å…ƒç»„æ‰€å±çš„é¡µé¢å¹¶é€‚å½“åœ°ä¿®æ”¹é¡µé¢çš„æ ‡é¢˜ã€‚</p>
<p><strong>Adding tuples:</strong> The <code>insertTuple</code> method in <code>HeapFile.java</code> is responsible for adding a tuple to a heap file. To add a new tuple to a HeapFile, you will have to find a page with an empty slot. If no such pages exist in the HeapFile, you need to create a new page and append it to the physical file on disk. You will need to ensure that the RecordID in the tuple is updated correctly.</p>
<p><strong>æ·»åŠ å…ƒç»„ï¼š</strong> <code>HeapFile.java</code>ä¸­çš„<code>insertTuple</code>æ–¹æ³•è´Ÿè´£å‘ä¸€ä¸ªå †æ–‡ä»¶æ·»åŠ å…ƒç»„ã€‚è¦å‘HeapFileæ·»åŠ ä¸€ä¸ªæ–°å…ƒç»„ï¼Œä½ å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªæœ‰ç©ºæ§½çš„é¡µé¢ã€‚å¦‚æœHeapFileä¸­æ²¡æœ‰è¿™æ ·çš„é¡µé¢å­˜åœ¨ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é¡µé¢å¹¶å°†å…¶è¿½åŠ åˆ°ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶ä¸­ã€‚ä½ å°†éœ€è¦ç¡®ä¿å…ƒç»„ä¸­çš„RecordIDè¢«æ­£ç¡®åœ°æ›´æ–°ã€‚</p>
<p><strong>Exercise 3.</strong></p>
<p>Implement the remaining skeleton methods in:</p>
<hr />
<ul>
<li>src/java/simpledb/storage/HeapPage.java</li>
<li>src/java/simpledb/storage/HeapFile.java<br>
(Note that you do not necessarily need to implement writePage at this point).</li>
</ul>
<hr />
<p>To implement HeapPage, you will need to modify the header bitmap for methods such as <code>insertTuple()</code> and <code>deleteTuple()</code>. You may find that the <code>getNumEmptySlots()</code> and <code>isSlotUsed()</code> methods we asked you to implement in Lab 1 serve as useful abstractions. Note that there is a <code>markSlotUsed</code> method provided as an abstraction to modify the filled or cleared status of a tuple in the page header.</p>
<p>ä¸ºäº†å®ç°HeapPageï¼Œä½ éœ€è¦ä¸º<code>insertTuple()</code>å’Œ<code>deleteTuple()</code>ç­‰æ–¹æ³•ä¿®æ”¹æ ‡é¢˜ä½å›¾ã€‚ä½ å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨å®éªŒ1ä¸­è¦æ±‚ä½ å®ç°çš„<code>getNumEmptySlots()</code>å’Œ<code>isSlotUsed()</code>æ–¹æ³•å¯ä»¥ä½œä¸ºæœ‰ç”¨çš„æŠ½è±¡æ–¹æ³•ã€‚è¯·æ³¨æ„ï¼Œæœ‰ä¸€ä¸ª<code>markSlotUsed</code>æ–¹æ³•ä½œä¸ºæŠ½è±¡ï¼Œç”¨æ¥ä¿®æ”¹é¡µçœ‰ä¸­å…ƒç»„çš„å¡«å……æˆ–æ¸…é™¤çŠ¶æ€ã€‚</p>
<p>Note that it is important that the <code>HeapFile.insertTuple()</code> and <code>HeapFile.deleteTuple()</code> methods access pages using the <code>BufferPool.getPage()</code> method; otherwise, your implementation of transactions in the next lab will not work properly.</p>
<p>æ³¨æ„ï¼Œé‡è¦çš„æ˜¯ï¼Œ<code>HeapFile.insertTuple()</code>å’Œ<code>HeapFile.deleteTuple()</code>æ–¹æ³•è¦ä½¿ç”¨<code>BufferPool.getPage()</code>æ–¹æ³•è®¿é—®é¡µé¢ï¼›å¦åˆ™ï¼Œä½ åœ¨ä¸‹ä¸€ä¸ªå®éªŒçš„äº‹åŠ¡å®ç°å°†ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>Implement the following skeleton methods in <tt>src/simpledb/BufferPool.java</tt>:</p>
<p>åœ¨<tt>src/simpledb/BufferPool.java</tt>ä¸­å®ç°ä»¥ä¸‹éª¨æ¶æ–¹æ³•ã€‚</p>
<hr />
<ul>
<li>insertTuple()</li>
<li>deleteTuple()</li>
</ul>
<hr />
<p>These methods should call the appropriate methods in the HeapFile that belong to the table being modified (this extra level of indirection is needed to support other types of files â€” like indices â€” in the future).</p>
<p>è¿™äº›æ–¹æ³•åº”è¯¥è°ƒç”¨HeapFileä¸­å±äºè¢«ä¿®æ”¹çš„è¡¨çš„é€‚å½“æ–¹æ³•ï¼ˆè¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚æ¬¡æ˜¯éœ€è¦çš„ï¼Œä»¥ä¾¿åœ¨æœªæ¥æ”¯æŒå…¶ä»–ç±»å‹çš„æ–‡ä»¶â€” åƒç´¢å¼•â€” ï¼‰ã€‚</p>
<p>At this point, your code should pass the unit tests in HeapPageWriteTest and HeapFileWriteTest, as well as BufferPoolWriteTest.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡HeapPageWriteTestå’ŒHeapFileWriteTestä»¥åŠBufferPoolWriteTestçš„å•å…ƒæµ‹è¯•ã€‚</p>
<h3 id="24-insertion-and-deletion"><a class="header" href="#24-insertion-and-deletion">2.4. Insertion and deletion</a></h3>
<p>Now that you have written all of the HeapFile machinery to add and remove tuples, you will implement the <code>Insert</code> and <code>Delete</code> operators.</p>
<p>ç°åœ¨ä½ å·²ç»å†™å¥½äº†æ‰€æœ‰ç”¨äºæ·»åŠ å’Œåˆ é™¤ tuple çš„HeapFileæœºå™¨ï¼Œä½ å°†å®ç°<code>Insert'å’Œ</code>Delete'æ“ä½œã€‚</p>
<p>For plans that implement <code>insert</code> and <code>delete</code> queries, the top-most operator is a special <code>Insert</code> or <code>Delete</code> operator that modifies the pages on disk. These operators return the number of affected tuples. This is implemented by returning a single tuple with one integer field, containing the count.</p>
<p>å¯¹äºå®ç° &quot;æ’å…¥ &quot;å’Œ &quot;åˆ é™¤ &quot;æŸ¥è¯¢çš„è®¡åˆ’ï¼Œæœ€ä¸Šé¢çš„è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ &quot;æ’å…¥ &quot;æˆ– &quot;åˆ é™¤ &quot;è¿ç®—ç¬¦ï¼Œå®ƒä¿®æ”¹äº†ç£ç›˜ä¸Šçš„é¡µé¢ã€‚è¿™äº›æ“ä½œç¬¦è¿”å›å—å½±å“ tuple çš„æ•°é‡ã€‚è¿™æ˜¯é€šè¿‡è¿”å›ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªæ•´æ•°å­—æ®µçš„å•ä¸€å…ƒç»„æ¥å®ç°çš„ï¼Œå…¶ä¸­åŒ…å«è®¡æ•°ã€‚</p>
<ul>
<li><em>Insert</em>: This operator adds the tuples it reads from its child operator to the <code>tableid</code> specified in its constructor. It should use the <code>BufferPool.insertTuple()</code> method to do this.</li>
</ul>
<p><em>æ’å…¥</em>ã€‚è¿™ä¸ªæ“ä½œç¬¦å°†å®ƒä»å…¶å­æ“ä½œç¬¦ä¸­è¯»å–çš„ tuple æ·»åŠ åˆ°å…¶æ„é€ å‡½æ•°ä¸­æŒ‡å®šçš„<code>tableid'ã€‚å®ƒåº”è¯¥ä½¿ç”¨</code>BufferPool.insertTuple()`æ–¹æ³•æ¥åšè¿™ä»¶äº‹ã€‚</p>
<ul>
<li><em>Delete</em>: This operator deletes the tuples it reads from its child operator from the <code>tableid</code> specified in its constructor. It should use the <code>BufferPool.deleteTuple()</code> method to do this.</li>
</ul>
<p><em>Delete</em>: è¿™ä¸ªæ“ä½œç¬¦ä»å…¶æ„é€ å‡½æ•°ä¸­æŒ‡å®šçš„<code>tableid'ä¸­åˆ é™¤å®ƒä»å…¶å­æ“ä½œç¬¦ä¸­è¯»å–çš„ tuple ã€‚å®ƒåº”è¯¥ä½¿ç”¨</code>BufferPool.deleteTuple()`æ–¹æ³•æ¥åšè¿™ä»¶äº‹ã€‚</p>
<p><strong>Exercise 4.</strong></p>
<p>Implement the skeleton methods in:</p>
<hr />
<ul>
<li>src/java/simpledb/execution/Insert.java</li>
<li>src/java/simpledb/execution/Delete.java</li>
</ul>
<hr />
<p>At this point, your code should pass the unit tests in InsertTest. We have not provided unit tests for <code>Delete</code>. Furthermore, you should be able to pass the InsertTest and DeleteTest system tests.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡InsertTestçš„å•å…ƒæµ‹è¯•ã€‚æˆ‘ä»¬æ²¡æœ‰ä¸º<code>Delete</code>æä¾›å•å…ƒæµ‹è¯•ã€‚æ­¤å¤–ï¼Œä½ åº”è¯¥èƒ½å¤Ÿé€šè¿‡ InsertTest å’Œ DeleteTest çš„ç³»ç»Ÿæµ‹è¯•ã€‚</p>
<h3 id="25-page-eviction"><a class="header" href="#25-page-eviction">2.5. Page eviction</a></h3>
<p>In Lab 1, we did not correctly observe the limit on the maximum number of pages in the buffer pool defined by the constructor argument <code>numPages</code>. Now, you will choose a page eviction policy and instrument any previous code that reads or creates pages to implement your policy.</p>
<p>åœ¨å®éªŒ1ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ­£ç¡®è§‚å¯Ÿåˆ°ç”±æ„é€ å‚æ•°<code>numPages</code>å®šä¹‰çš„ç¼“å†²æ± ä¸­æœ€å¤§é¡µæ•°çš„é™åˆ¶ã€‚ç°åœ¨ï¼Œä½ å°†é€‰æ‹©ä¸€ä¸ªé¡µé¢é©±é€ç­–ç•¥ï¼Œå¹¶å¯¹ä»¥å‰ä»»ä½•è¯»å–æˆ–åˆ›å»ºé¡µé¢çš„ä»£ç è¿›è¡Œç¼–ç¨‹ï¼Œä»¥å®ç°ä½ çš„ç­–ç•¥ã€‚</p>
<p>When more than <tt>numPages</tt> pages are in the buffer pool, one page should be evicted from the pool before the next is loaded. The choice of eviction policy is up to you; it is not necessary to do something sophisticated. Describe your policy in the lab writeup.</p>
<p>å½“ç¼“å†²æ± ä¸­çš„é¡µé¢è¶…è¿‡<tt>numPages</tt>æ—¶ï¼Œåœ¨åŠ è½½ä¸‹ä¸€ä¸ªé¡µé¢ä¹‹å‰ï¼Œåº”è¯¥å°†ä¸€ä¸ªé¡µé¢ä»ç¼“å†²æ± ä¸­é©±é€å‡ºå»ã€‚é©±é€ç­–ç•¥çš„é€‰æ‹©ç”±ä½ å†³å®šï¼›æ²¡æœ‰å¿…è¦åšä¸€äº›å¤æ‚çš„äº‹æƒ…ã€‚åœ¨å®éªŒæŠ¥å‘Šä¸­æè¿°ä¸€ä¸‹ä½ çš„ç­–ç•¥ã€‚</p>
<p>Notice that <code>BufferPool</code> asks you to implement a <code>flushAllPages()</code> method. This is not something you would ever need in a real implementation of a buffer pool. However, we need this method for testing purposes. You should never call this method from any real code.</p>
<p>æ³¨æ„<code>BufferPool</code>è¦æ±‚ä½ å®ç°<code>flushAllPages()</code>æ–¹æ³•ã€‚è¿™ä¸æ˜¯ä½ åœ¨çœŸæ­£å®ç°ç¼“å†²æ± æ—¶éœ€è¦çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¸ªæ–¹æ³•ç”¨äºæµ‹è¯•ã€‚ä½ ä¸åº”è¯¥åœ¨ä»»ä½•çœŸæ­£çš„ä»£ç ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>Because of the way we have implemented ScanTest.cacheTest, you will need to ensure that your flushPage and flushAllPages methods do no evict pages from the buffer pool to properly pass this test.</p>
<p>ç”±äºæˆ‘ä»¬å®ç°ScanTest.cacheTestçš„æ–¹å¼ï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„flushPageå’ŒflushAllPagesæ–¹æ³•ä¸ä»ç¼“å†²æ± ä¸­é©±é€é¡µé¢ï¼Œä»¥æ­£ç¡®é€šè¿‡è¿™ä¸ªæµ‹è¯•ã€‚</p>
<p>flushAllPages should call flushPage on all pages in the BufferPool, and flushPage should write any dirty page to disk and mark it as not dirty, while leaving it in the BufferPool.</p>
<p>flushAllPagesåº”è¯¥åœ¨BufferPoolä¸­çš„æ‰€æœ‰é¡µé¢ä¸Šè°ƒç”¨flushPageï¼ŒflushPageåº”è¯¥å°†ä»»ä½•è„é¡µå†™å…¥ç£ç›˜å¹¶æ ‡è®°ä¸ºä¸è„ï¼ŒåŒæ—¶å°†å…¶ç•™åœ¨BufferPoolä¸­ã€‚</p>
<p>The only method which should remove page from the buffer pool is evictPage, which should call flushPage on any dirty page it evicts.</p>
<p>å”¯ä¸€åº”è¯¥ä»ç¼“å†²æ± ä¸­åˆ é™¤é¡µé¢çš„æ–¹æ³•æ˜¯evictPageï¼Œå®ƒåº”è¯¥å¯¹å®ƒæ‰€é©±é€çš„ä»»ä½•è„é¡µé¢è°ƒç”¨flushPageã€‚</p>
<p><strong>Exercise 5.</strong></p>
<p>Fill in the <code>flushPage()</code> method and additional helper methods to implement page eviction in:</p>
<p>å¡«å†™<code>flushPage()</code>æ–¹æ³•å’Œé¢å¤–çš„è¾…åŠ©æ–¹æ³•æ¥å®ç°é¡µé¢é©±é€ã€‚</p>
<hr />
<ul>
<li>src/java/simpledb/storage/BufferPool.java</li>
</ul>
<hr />
<p>If you did not implement <code>writePage()</code> in <tt>HeapFile.java</tt> above, you will also need to do that here. Finally, you should also implement <code>discardPage()</code> to remove a page from the buffer pool <em>without</em> flushing it to disk. We will not test <code>discardPage()</code> in this lab, but it will be necessary for future labs.</p>
<p>å¦‚æœä½ æ²¡æœ‰åœ¨ä¸Šé¢çš„<tt>HeapFile.java</tt>ä¸­å®ç°<code>writePage()</code>ï¼Œä½ ä¹Ÿéœ€è¦åœ¨è¿™é‡Œå®ç°å®ƒã€‚æœ€åï¼Œä½ è¿˜åº”è¯¥å®ç°<code>discardPage()</code>ï¼Œä»¥ä¾¿ä»ç¼“å†²æ± ä¸­åˆ é™¤ä¸€ä¸ªé¡µé¢ï¼Œè€Œä¸*å†²åˆ°ç£ç›˜ä¸Šã€‚æˆ‘ä»¬ä¸ä¼šåœ¨æœ¬å®éªŒä¸­æµ‹è¯•<code>discardPage()</code>ï¼Œä½†å®ƒåœ¨æœªæ¥çš„å®éªŒä¸­æ˜¯å¿…è¦çš„ã€‚</p>
<p>At this point, your code should pass the EvictionTest system test.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡EvictionTestç³»ç»Ÿæµ‹è¯•ã€‚</p>
<p>Since we will not be checking for any particular eviction policy, this test works by creating a BufferPool with 16 pages (NOTE: while DEFAULT_PAGES is 50, we are initializing the BufferPool with less!), scanning a file with many more than 16 pages, and seeing if the memory usage of the JVM increases by more than 5 MB. If you do not implement an eviction policy correctly, you will not evict enough pages, and will go over the size limitation, thus failing the test.</p>
<p>ç”±äºæˆ‘ä»¬ä¸ä¼šæ£€æŸ¥ä»»ä½•ç‰¹å®šçš„é©±é€ç­–ç•¥ï¼Œè¿™ä¸ªæµ‹è¯•é€šè¿‡åˆ›å»ºä¸€ä¸ªæœ‰16é¡µçš„BufferPoolï¼ˆæ³¨æ„ï¼šè™½ç„¶DEFAULT_PAGESæ˜¯50ï¼Œä½†æˆ‘ä»¬åˆå§‹åŒ–çš„BufferPoolæ›´å°‘ï¼ï¼‰ï¼Œæ‰«æä¸€ä¸ªè¶…è¿‡16é¡µçš„æ–‡ä»¶ï¼Œçœ‹çœ‹JVMçš„å†…å­˜ä½¿ç”¨ç‡æ˜¯å¦å¢åŠ äº†5MBä»¥ä¸Šã€‚å¦‚æœä½ æ²¡æœ‰æ­£ç¡®åœ°å®æ–½é©±é€ç­–ç•¥ï¼Œä½ å°†æ— æ³•é©±é€è¶³å¤Ÿå¤šçš„é¡µé¢ï¼Œå¹¶å°†è¶…è¿‡å¤§å°é™åˆ¶ï¼Œä»è€Œå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚</p>
<p>You have now completed this lab. Good work!</p>
<p>ä½ ç°åœ¨å·²ç»å®Œæˆäº†è¿™ä¸ªå®éªŒã€‚å¹²å¾—å¥½!</p>
<p><a name="query_walkthrough"></a></p>
<h3 id="26-query-walkthrough"><a class="header" href="#26-query-walkthrough">2.6. Query walkthrough</a></h3>
<p>The following code implements a simple join query between two tables, each consisting of three columns of integers.  (The file <code>some_data_file1.dat</code> and <code>some_data_file2.dat</code> are binary representation of the pages from this file). This code is equivalent to the SQL statement:</p>
<p>ä¸‹é¢çš„ä»£ç å®ç°äº†ä¸¤ä¸ªè¡¨ä¹‹é—´çš„ç®€å•è¿æ¥æŸ¥è¯¢ï¼Œæ¯ä¸ªè¡¨ç”±ä¸‰åˆ—æ•´æ•°ç»„æˆã€‚ (æ–‡ä»¶<code>some_data_file1.dat</code>å’Œ<code>some_data_file2.dat</code>æ˜¯è¿™ä¸ªæ–‡ä»¶çš„é¡µé¢çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚è¿™æ®µä»£ç ç­‰åŒäºSQLè¯­å¥ã€‚</p>
<pre><code class="language-sql">SELECT *
FROM some_data_file1,
     some_data_file2
WHERE some_data_file1.field1 = some_data_file2.field1
  AND some_data_file1.id &gt; 1
</code></pre>
<p>For more extensive examples of query operations, you may find it helpful to browse the unit tests for joins, filters, and aggregates.</p>
<p>å¯¹äºæ›´å¤šçš„æŸ¥è¯¢æ“ä½œçš„ä¾‹å­ï¼Œä½ å¯èƒ½ä¼šå‘ç°æµè§ˆè¿æ¥ã€è¿‡æ»¤å™¨å’Œèšåˆçš„å•å…ƒæµ‹è¯•æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>
<pre><code class="language-java">package simpledb;

import java.io.*;

public class jointest {

    public static void main(String[] argv) {
        // construct a 3-column table schema
        Type types[] = new Type[]{Type.INT_TYPE, Type.INT_TYPE, Type.INT_TYPE};
        String names[] = new String[]{&quot;field0&quot;, &quot;field1&quot;, &quot;field2&quot;};

        TupleDesc td = new TupleDesc(types, names);

        // create the tables, associate them with the data files
        // and tell the catalog about the schema  the tables.
        HeapFile table1 = new HeapFile(new File(&quot;some_data_file1.dat&quot;), td);
        Database.getCatalog().addTable(table1, &quot;t1&quot;);

        HeapFile table2 = new HeapFile(new File(&quot;some_data_file2.dat&quot;), td);
        Database.getCatalog().addTable(table2, &quot;t2&quot;);

        // construct the query: we use two SeqScans, which spoonfeed
        // tuples via iterators into join
        TransactionId tid = new TransactionId();

        SeqScan ss1 = new SeqScan(tid, table1.getId(), &quot;t1&quot;);
        SeqScan ss2 = new SeqScan(tid, table2.getId(), &quot;t2&quot;);

        // create a filter for the where condition
        Filter sf1 = new Filter(
                new Predicate(0,
                        Predicate.Op.GREATER_THAN, new IntField(1)), ss1);

        JoinPredicate p = new JoinPredicate(1, Predicate.Op.EQUALS, 1);
        Join j = new Join(p, sf1, ss2);

        // and run it
        try {
            j.open();
            while (j.hasNext()) {
                Tuple tup = j.next();
                System.out.println(tup);
            }
            j.close();
            Database.getBufferPool().transactionComplete(tid);

        } catch (Exception e) {
            e.printStackTrace();
        }

    }

}
</code></pre>
<p>Both tables have three integer fields. To express this, we create a <code>TupleDesc</code> object and pass it an array of <code>Type</code> objects indicating field types and <code>String</code> objects indicating field names. Once we have created this <code>TupleDesc</code>, we initialize two <code>HeapFile</code> objects representing the tables. Once we have created the tables, we add them to the Catalog. (If this were a database server that was already running, we would have this catalog information loaded; we need to load this only for the purposes of this test).</p>
<p>ä¸¤ä¸ªè¡¨éƒ½æœ‰ä¸‰ä¸ªæ•´æ•°å­—æ®µã€‚ä¸ºäº†è¡¨è¾¾è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>TupleDesc</code>å¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™å®ƒä¸€ä¸ªè¡¨ç¤ºå­—æ®µç±»å‹çš„<code>Type</code>å¯¹è±¡å’Œè¡¨ç¤ºå­—æ®µåçš„<code>String</code>å¯¹è±¡çš„æ•°ç»„ã€‚ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº†è¿™ä¸ª<code>TupleDesc</code>ï¼Œæˆ‘ä»¬å°±åˆå§‹åŒ–ä¸¤ä¸ªä»£è¡¨è¡¨çš„<code>HeapFile</code>å¯¹è±¡ã€‚ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº†è¿™äº›è¡¨ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒä»¬æ·»åŠ åˆ°ç›®å½•ä¸­ã€‚(å¦‚æœè¿™æ˜¯ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†åŠ è½½è¿™ä¸ªç›®å½•ä¿¡æ¯ï¼›æˆ‘ä»¬åªéœ€è¦ä¸ºè¿™ä¸ªæµ‹è¯•çš„ç›®çš„åŠ è½½è¿™ä¸ªä¿¡æ¯ï¼‰ã€‚</p>
<p>Once we have finished initializing the database system, we create a query plan. Our plan consists of two <code>SeqScan</code> operators that scan the tuples from each file on disk, connected to a <code>Filter</code> operator on the first HeapFile, connected to a <code>Join</code> operator that joins the tuples in the tables according to the <code>JoinPredicate</code>. In general, these operators are instantiated with references to the appropriate table (in the case of SeqScan) or child operator (in the case of e.g., Join). The test program then repeatedly calls <code>next</code> on the <code>Join</code> operator, which in turn pulls tuples from its children. As tuples are output from the <code>Join</code>, they are printed out on the command line.</p>
<p>ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ•°æ®åº“ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢è®¡åˆ’ã€‚æˆ‘ä»¬çš„è®¡åˆ’ç”±ä¸¤ä¸ª &quot;SeqScan &quot;æ“ä½œç¬¦ç»„æˆï¼Œæ‰«æç£ç›˜ä¸Šæ¯ä¸ªæ–‡ä»¶çš„ tuple ï¼Œä¸ç¬¬ä¸€ä¸ªHeapFileä¸Šçš„ &quot;Filter &quot;æ“ä½œç¬¦ç›¸è¿ï¼Œä¸ä¸€ä¸ª &quot;Join &quot;æ“ä½œç¬¦ç›¸è¿ï¼Œæ ¹æ® &quot;JoinPredicate &quot;è¿æ¥å„è¡¨ä¸­çš„ tuple ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›è¿ç®—ç¬¦è¢«å®ä¾‹åŒ–ä¸ºå¯¹é€‚å½“çš„è¡¨ï¼ˆåœ¨SeqScançš„æƒ…å†µä¸‹ï¼‰æˆ–å­è¿ç®—ç¬¦ï¼ˆåœ¨ä¾‹å¦‚Joinçš„æƒ…å†µä¸‹ï¼‰çš„å¼•ç”¨ã€‚æµ‹è¯•ç¨‹åºä¼šé‡å¤è°ƒç”¨ &quot;Join &quot;è¿ç®—ç¬¦çš„ &quot;next&quot;ï¼Œç„¶åä»å…¶å­è¿ç®—ç¬¦ä¸­æå– tuple ã€‚å½“ tuple ä» &quot;Join &quot;ä¸­è¾“å‡ºæ—¶ï¼Œå®ƒä»¬è¢«æ‰“å°åœ¨å‘½ä»¤è¡Œä¸­ã€‚</p>
<p><a name="parser"></a></p>
<h3 id="27-query-parser"><a class="header" href="#27-query-parser">2.7. Query Parser</a></h3>
<p>We've provided you with a query parser for SimpleDB that you can use to write and run SQL queries against your database once you have completed the exercises in this lab.</p>
<p>æˆ‘ä»¬å·²ç»ä¸ºä½ æä¾›äº†SimpleDBçš„æŸ¥è¯¢åˆ†æå™¨ï¼Œä¸€æ—¦ä½ å®Œæˆäº†æœ¬å®éªŒçš„ç»ƒä¹ ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥ç¼–å†™å’Œè¿è¡Œé’ˆå¯¹ä½ çš„æ•°æ®åº“çš„SQLæŸ¥è¯¢ã€‚</p>
<p>The first step is to create some data tables and a catalog. Suppose you have a file <code>data.txt</code> with the following contents:</p>
<p>ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€äº›æ•°æ®è¡¨å’Œä¸€ä¸ªç›®å½•ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶<code>data.txt</code>ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p>
<pre><code>1,10
2,20
3,30
4,40
5,50
5,50
</code></pre>
<p>You can convert this into a SimpleDB table using the <code>convert</code> command (make sure to type <tt>ant</tt> first!):</p>
<p>ä½ å¯ä»¥ä½¿ç”¨<code>convert</code>å‘½ä»¤å°†å…¶è½¬æ¢ä¸ºSimpleDBè¡¨ï¼ˆè¯·ç¡®ä¿å…ˆè¾“å…¥<tt>ant</tt>ï¼ï¼‰ã€‚</p>
<pre><code>java -jar dist/simpledb.jar convert data.txt 2 &quot;int,int&quot;
</code></pre>
<p>This creates a file <code>data.dat</code>. In addition to the table's raw data, the two additional parameters specify that each record has two fields and that their types are <code>int</code> and <code>int</code>.</p>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>data.dat</code>ã€‚é™¤äº†è¡¨çš„åŸå§‹æ•°æ®å¤–ï¼Œä¸¤ä¸ªé™„åŠ å‚æ•°æŒ‡å®šæ¯æ¡è®°å½•æœ‰ä¸¤ä¸ªå­—æ®µï¼Œå®ƒä»¬çš„ç±»å‹æ˜¯<code>int</code>å’Œ<code>int</code>ã€‚</p>
<p>Next, create a catalog file, <code>catalog.txt</code>, with the following contents:</p>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•æ–‡ä»¶ï¼Œ<code>catalog.txt</code>ï¼Œå…¶å†…å®¹å¦‚ä¸‹ã€‚</p>
<pre><code>data (f1 int, f2 int)
</code></pre>
<p>This tells SimpleDB that there is one table, <code>data</code> (stored in <code>data.dat</code>) with two integer fields named <code>f1</code> and <code>f2</code>.</p>
<p>è¿™å‘Šè¯‰SimpleDBæœ‰ä¸€ä¸ªè¡¨ï¼Œ<code>data</code>ï¼ˆå­˜å‚¨åœ¨<code>data.dat</code>ä¸­ï¼‰ï¼Œæœ‰ä¸¤ä¸ªæ•´æ•°å­—æ®µï¼Œåä¸º<code>f1</code>å’Œ<code>f2</code>ã€‚</p>
<p>Finally, invoke the parser. You must run java from the command line (ant doesn't work properly with interactive targets.) From the <code>simpledb/</code> directory, type:</p>
<p>æœ€åï¼Œè°ƒç”¨è§£æå™¨ã€‚ä½ å¿…é¡»ä»å‘½ä»¤è¡Œè¿è¡Œjava(antåœ¨äº¤äº’å¼ç›®æ ‡ä¸‹ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚)ä»<code>simpledb/</code>ç›®å½•ä¸‹ï¼Œè¾“å…¥ã€‚</p>
<pre><code>java -jar dist/simpledb.jar parser catalog.txt
</code></pre>
<p>You should see output like:</p>
<p>ä½ åº”è¯¥çœ‹åˆ°è¿™æ ·çš„è¾“å‡ºã€‚</p>
<pre><code>Added table : data with schema INT(f1), INT(f2), 
SimpleDB&gt; 
</code></pre>
<p>Finally, you can run a query:</p>
<p>æœ€åï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ªæŸ¥è¯¢ã€‚</p>
<pre><code>SimpleDB&gt; select d.f1, d.f2 from data d;
Started a new transaction tid = 1221852405823
 ADDING TABLE d(data) TO tableMap
     TABLE HAS  tupleDesc INT(d.f1), INT(d.f2), 
1       10
2       20
3       30
4       40
5       50
5       50

 6 rows.
----------------
0.16 seconds

SimpleDB&gt; 
</code></pre>
<p>The parser is relatively full featured (including support for SELECTs, INSERTs, DELETEs, and transactions), but does have some problems and does not necessarily report completely informative error messages. Here are some limitations to bear in mind:</p>
<p>è¯¥åˆ†æå™¨çš„åŠŸèƒ½ç›¸å¯¹é½å…¨ï¼ˆåŒ…æ‹¬å¯¹SELECTsã€INSERTsã€DELETEså’Œäº‹åŠ¡çš„æ”¯æŒï¼‰ï¼Œä½†ç¡®å®å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä¸ä¸€å®šèƒ½æŠ¥å‘Šå‡ºå®Œå…¨æœ‰å‚è€ƒä»·å€¼çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™é‡Œæœ‰ä¸€äº›éœ€è¦è®°ä½çš„é™åˆ¶ã€‚</p>
<ul>
<li>You must preface every field name with its table name, even if the field name is unique (you can use table name aliases, as in the example above, but you cannot use the AS keyword.)</li>
</ul>
<p>ä½ å¿…é¡»åœ¨æ¯ä¸ªå­—æ®µåå‰åŠ ä¸Šå…¶è¡¨åï¼Œå³ä½¿å­—æ®µåæ˜¯å”¯ä¸€çš„ï¼ˆä½ å¯ä»¥ä½¿ç”¨è¡¨ååˆ«åï¼Œå¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œä½†ä½ ä¸èƒ½ä½¿ç”¨ASå…³é”®å­—ï¼‰ã€‚</p>
<ul>
<li>Nested queries are supported in the WHERE clause, but not the FROM clause.</li>
</ul>
<p>åœ¨WHEREå­å¥ä¸­æ”¯æŒåµŒå¥—æŸ¥è¯¢ï¼Œä½†ä¸æ”¯æŒFROMå­å¥ã€‚</p>
<ul>
<li>No arithmetic expressions are supported (for example, you can't take the sum of two fields.)</li>
</ul>
<p>ä¸æ”¯æŒç®—æœ¯è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œä½ ä¸èƒ½å–ä¸¤ä¸ªå­—æ®µçš„æ€»å’Œï¼‰ã€‚</p>
<ul>
<li>At most one GROUP BY and one aggregate column are allowed.</li>
</ul>
<p>æœ€å¤šå…è®¸ä¸€ä¸ªGROUP BYå’Œä¸€ä¸ªèšåˆåˆ—ã€‚</p>
<ul>
<li>Set-oriented operators like IN, UNION, and EXCEPT are not allowed.</li>
</ul>
<p>ä¸å…è®¸ä½¿ç”¨é¢å‘é›†åˆçš„æ“ä½œç¬¦ï¼Œå¦‚INã€UNIONå’ŒEXCEPTã€‚</p>
<ul>
<li>Only AND expressions in the WHERE clause are allowed.</li>
</ul>
<p>åªå…è®¸åœ¨WHEREå­å¥ä¸­ä½¿ç”¨ANDè¡¨è¾¾ã€‚</p>
<ul>
<li>UPDATE expressions are not supported.</li>
</ul>
<p>ä¸æ”¯æŒUPDATEè¡¨è¾¾å¼ã€‚</p>
<ul>
<li>The string operator LIKE is allowed, but must be written out fully (that is, the Postgres tilde [~] shorthand is not allowed.)</li>
</ul>
<p>å…è®¸ä½¿ç”¨å­—ç¬¦ä¸²æ“ä½œç¬¦LIKEï¼Œä½†æ˜¯å¿…é¡»å®Œå…¨å†™å‡ºæ¥ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸ä½¿ç”¨Postgresçš„tilde [~]çŸ­è¯­ï¼‰ã€‚</p>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../../6.830/cn/2-lab1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../6.830/cn/4-lab3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../../6.830/cn/2-lab1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../../6.830/cn/4-lab3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "6.830/cn/3-lab2.md"
    </script>


    <!-- Custom JS scripts -->


</body>
</html>