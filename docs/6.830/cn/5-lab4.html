<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Lab 4 (Chinese) - everystep</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../../favicon.svg">
    <link rel="shortcut icon" href="../../favicon.png">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/general.css">
    <link rel="stylesheet" href="../../css/chrome.css">
    <link rel="stylesheet" href="../../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../highlight.css">
    <link rel="stylesheet" href="../../tomorrow-night.css">
    <link rel="stylesheet" href="../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../../theme/style.css">


</head>
<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">ç®€ä»‹</a></li><li class="chapter-item affix "><li class="part-title">ğŸ­ æ“ä½œç³»ç»Ÿ</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.S081/0-summary.html"><strong aria-hidden="true">1.</strong> 6.S081</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.S081/1-lab1.html"><strong aria-hidden="true">1.1.</strong> Lab 1</a></li><li class="chapter-item "><a href="../../6.S081/2-lab2.html"><strong aria-hidden="true">1.2.</strong> Lab 2</a></li><li class="chapter-item "><a href="../../6.S081/3-lab3.html"><strong aria-hidden="true">1.3.</strong> Lab 3</a></li><li class="chapter-item "><a href="../../6.S081/4-lab4.html"><strong aria-hidden="true">1.4.</strong> Lab 4</a></li><li class="chapter-item "><a href="../../6.S081/5-lab5.html"><strong aria-hidden="true">1.5.</strong> Lab 5</a></li><li class="chapter-item "><a href="../../6.S081/6-lab6.html"><strong aria-hidden="true">1.6.</strong> Lab 6</a></li><li class="chapter-item "><a href="../../6.S081/7-lab7.html"><strong aria-hidden="true">1.7.</strong> Lab 7</a></li><li class="chapter-item "><a href="../../6.S081/8-lab8.html"><strong aria-hidden="true">1.8.</strong> Lab 8</a></li><li class="chapter-item "><a href="../../6.S081/9-lab9.html"><strong aria-hidden="true">1.9.</strong> Lab 9</a></li><li class="chapter-item "><a href="../../6.S081/10-lab10.html"><strong aria-hidden="true">1.10.</strong> Lab 10</a></li><li class="chapter-item "><a href="../../6.S081/11-lab11.html"><strong aria-hidden="true">1.11.</strong> Lab 11</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸš€ æ•°æ®åº“</li><li class="spacer"></li><li class="chapter-item "><a href="../../bitcask/index.html"><strong aria-hidden="true">2.</strong> ä»é›¶å®ç° BitCask å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.1.</strong> BitCask ç®€ä»‹</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.2.</strong> åˆ›å»º C++ é¡¹ç›®</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.3.</strong> æ•°æ®åœ¨å†…å­˜ä¸­</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.4.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Š</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.5.</strong> BenchMark</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.6.</strong> å®ç°åˆå¹¶</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.7.</strong> å®ç°åƒåœ¾å›æ”¶</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.8.</strong> hintfile å®ç°</a></li><li class="chapter-item "><a href="../../bitcask/p1.html"><strong aria-hidden="true">2.9.</strong> å“ˆå¸Œè¡¨ä¼˜åŒ–ä¸ºå¤šçº¿ç¨‹</a></li><li class="chapter-item "><a href="../../bitcask/ch1.html"><strong aria-hidden="true">2.10.</strong> æ•°æ®åœ¨ç£ç›˜ä¸Šå¦‚ä½•å­˜æ”¾ï¼Ÿ</a></li><li class="chapter-item "><a href="../../bitcask/ch2.html"><strong aria-hidden="true">2.11.</strong> å­˜å‚¨å¼•æ“çš„æ¥å£è®¾è®¡</a></li><li class="chapter-item "><a href="../../bitcask/ch3.html"><strong aria-hidden="true">2.12.</strong> å®ç° Setã€Get</a></li><li class="chapter-item "><a href="../../bitcask/ch4.html"><strong aria-hidden="true">2.13.</strong> åˆ é™¤é€»è¾‘å’Œ Compact </a></li></ol></li><li class="chapter-item "><a href="../../abyssdb/p0.html"><strong aria-hidden="true">3.</strong> ä»é›¶å®ç°å…³ç³»å‹æ•°æ®åº“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../abyssdb/p1.html"><strong aria-hidden="true">3.1.</strong> ä» Table å¼€å§‹</a></li><li class="chapter-item "><a href="../../abyssdb/p2.html"><strong aria-hidden="true">3.2.</strong> Part 2. å®ç° Tuple</a></li><li class="chapter-item "><a href="../../abyssdb/p3.html"><strong aria-hidden="true">3.3.</strong> Part 3. å®ç° Page</a></li><li class="chapter-item "><a href="../../abyssdb/p4.html"><strong aria-hidden="true">3.4.</strong> Part 4. å®ç° HeapFile</a></li><li class="chapter-item "><a href="../../abyssdb/p5.html"><strong aria-hidden="true">3.5.</strong> Part 5. å®ç° BufferPool</a></li><li class="chapter-item "><a href="../../abyssdb/p6.html"><strong aria-hidden="true">3.6.</strong> Part 6. æ”¯æŒ int å’Œ string ç­‰æ•°æ®ç±»å‹ã€‚</a></li><li class="chapter-item "><a href="../../abyssdb/p7.html"><strong aria-hidden="true">3.7.</strong> Part 7. å®ç° Catalog</a></li></ol></li><li class="chapter-item expanded "><a href="../../6.830/1-lab0.html"><strong aria-hidden="true">4.</strong> 6.830</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.830/ans/2-lab1-ans.html"><strong aria-hidden="true">4.1.</strong> Lab 1 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/3-lab2-ans.html"><strong aria-hidden="true">4.2.</strong> Lab 2 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/4-lab3-ans.html"><strong aria-hidden="true">4.3.</strong> Lab 3 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/5-lab4-ans.html"><strong aria-hidden="true">4.4.</strong> Lab 4 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/6-lab5-ans.html"><strong aria-hidden="true">4.5.</strong> Lab 5 Answers</a></li><li class="chapter-item "><a href="../../6.830/ans/7-lab6-ans.html"><strong aria-hidden="true">4.6.</strong> Lab 6 Answers</a></li><li class="chapter-item "><a href="../../6.830/cn/2-lab1.html"><strong aria-hidden="true">4.7.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/3-lab2.html"><strong aria-hidden="true">4.8.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/4-lab3.html"><strong aria-hidden="true">4.9.</strong> Lab 3 (Chinese)</a></li><li class="chapter-item expanded "><a href="../../6.830/cn/5-lab4.html" class="active"><strong aria-hidden="true">4.10.</strong> Lab 4 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/6-lab5.html"><strong aria-hidden="true">4.11.</strong> Lab 5 (Chinese)</a></li><li class="chapter-item "><a href="../../6.830/cn/7-lab6.html"><strong aria-hidden="true">4.12.</strong> Lab 6 (Chinese)</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ§Š åˆ†å¸ƒå¼</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.824/0-lab0.html"><strong aria-hidden="true">5.</strong> 6.824</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.824/1-lab1-cn.html"><strong aria-hidden="true">5.1.</strong> Lab 1 (Chinese)</a></li><li class="chapter-item "><a href="../../6.824/1-lab1.html"><strong aria-hidden="true">5.2.</strong> Lab 1</a></li><li class="chapter-item "><a href="../../6.824/2-lab2-cn.html"><strong aria-hidden="true">5.3.</strong> Lab 2 (Chinese)</a></li><li class="chapter-item "><a href="../../6.824/2-lab2.html"><strong aria-hidden="true">5.4.</strong> Lab 2</a></li></ol></li><li class="chapter-item "><li class="part-title">ğŸ”¥ å…¶ä»–</li><li class="spacer"></li><li class="chapter-item "><a href="../../6.828/0-sum.html"><strong aria-hidden="true">6.</strong> 6.828</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../6.828/1-env.html"><strong aria-hidden="true">6.1.</strong> Environment Setup</a></li><li class="chapter-item "><a href="../../6.828/1-part1.html"><strong aria-hidden="true">6.2.</strong> Part 1</a></li></ol></li><li class="chapter-item "><a href="../../review/1_go.html"><strong aria-hidden="true">7.</strong> å…«è‚¡</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../review/2_cpp.html"><strong aria-hidden="true">7.1.</strong> C++</a></li><li class="chapter-item "><a href="../../review/3_cn.html"><strong aria-hidden="true">7.2.</strong> Computer Networks</a></li></ol></li><li class="chapter-item "><a href="../../lsm/index.html"><strong aria-hidden="true">8.</strong> ä»é›¶å®ç° LSM-Tree å­˜å‚¨å¼•æ“</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../lsm/ch1.html"><strong aria-hidden="true">8.1.</strong> Part 1</a></li><li class="chapter-item "><a href="../../lsm/ch2.html"><strong aria-hidden="true">8.2.</strong> Part 2</a></li><li class="chapter-item "><a href="../../lsm/ch3.html"><strong aria-hidden="true">8.3.</strong> Part 3</a></li><li class="chapter-item "><a href="../../lsm/ch4.html"><strong aria-hidden="true">8.4.</strong> Part 4</a></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">everystep</h1>

                <div class="right-buttons">
                    <a href="../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/weijiew/everystep/edit/master/src/6.830/cn/5-lab4.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');

                // Get viewed page store
                var viewed_key = 'mdbook-viewed';
                var viewed_map = {};
                try {
                    var viewed_storage = localStorage.getItem(viewed_key);
                    if (viewed_storage) {
                        viewed_map = JSON.parse(viewed_storage)
                    }
                } catch (e) { }

                Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);

                    // Apply viewed style
                    if (viewed_map[link.pathname]) {
                        link.classList.add('md-viewed')
                    }
                }); 

                // Mark viewed after 30s
                setTimeout(function() {
                    viewed_map[location.pathname] = 1;
                    localStorage.setItem(viewed_key, JSON.stringify(viewed_map));
                }, 30000)
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc"><nav class="pagetoc"></nav></div>
                <main>
                    <h1 id="lab-4-ç¿»è¯‘"><a class="header" href="#lab-4-ç¿»è¯‘">Lab 4 ç¿»è¯‘</a></h1>
<p>Assigned: Monday, Apr 5, 2021
Due: Thursday, Apr 22, 2021 11:59 PM ET</p>
<p>In this lab, you will implement a simple locking-based transaction system in SimpleDB. You will need to add lock and unlock calls at the appropriate places in your code, as well as code to track the locks held by each transaction and grant locks to transactions as they are needed.</p>
<p>åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œä½ å°†åœ¨SimpleDBä¸­å®ç°ä¸€ä¸ªç®€å•çš„åŸºäºé”çš„äº‹åŠ¡ç³»ç»Ÿã€‚ä½ å°†éœ€è¦åœ¨ä»£ç ä¸­çš„é€‚å½“ä½ç½®æ·»åŠ é”å’Œè§£é”è°ƒç”¨ï¼Œä»¥åŠè·Ÿè¸ªæ¯ä¸ªäº‹åŠ¡æ‰€æŒæœ‰çš„é”çš„ä»£ç ï¼Œå¹¶åœ¨éœ€è¦æ—¶æˆäºˆäº‹åŠ¡é”ã€‚</p>
<p>The remainder of this document describes what is involved in adding transaction support and provides a basic outline of how you might add this support to your database.</p>
<p>æœ¬æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†æè¿°äº†æ·»åŠ äº‹åŠ¡æ”¯æŒæ‰€æ¶‰åŠçš„å†…å®¹ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå…³äºå¦‚ä½•å°†è¿™ç§æ”¯æŒæ·»åŠ åˆ°ä½ çš„æ•°æ®åº“çš„åŸºæœ¬æ¦‚è¦ã€‚</p>
<p>As with the previous lab, we recommend that you start as early as possible. Locking and transactions can be quite tricky to debug!</p>
<p>å’Œå‰é¢çš„å®éªŒä¸€æ ·ï¼Œæˆ‘ä»¬å»ºè®®ä½ å°½å¯èƒ½æ—©åœ°å¼€å§‹ã€‚é”å®šå’Œäº‹åŠ¡å¯èƒ½æ˜¯ç›¸å½“æ£˜æ‰‹çš„è°ƒè¯•å·¥ä½œ!</p>
<h2 id="1-getting-started"><a class="header" href="#1-getting-started">1. Getting started</a></h2>
<p>You should begin with the code you submitted for Lab 3 (if you did not submit code for Lab 3, or your solution didn't work properly, contact us to discuss options). Additionally, we are providing extra test cases for this lab that are not in the original code distribution you received. We reiterate that the unit tests we provide are to help guide your implementation along, but they are not intended to be comprehensive or to establish correctness.</p>
<p>ä½ åº”è¯¥ä»ä½ ä¸ºå®éªŒ3æäº¤çš„ä»£ç å¼€å§‹ï¼ˆå¦‚æœä½ æ²¡æœ‰ä¸ºå®éªŒ3æäº¤ä»£ç ï¼Œæˆ–è€…ä½ çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰æ­£å¸¸å·¥ä½œï¼Œè¯·ä¸æˆ‘ä»¬è”ç³»ï¼Œè®¨è®ºå„ç§æ–¹æ¡ˆï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¸ºè¿™ä¸ªå®éªŒæä¾›äº†é¢å¤–çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œè¿™äº›æ¡ˆä¾‹ä¸åœ¨ä½ æ”¶åˆ°çš„åŸå§‹ä»£ç åˆ†å‘ä¸­ã€‚æˆ‘ä»¬é‡ç”³ï¼Œæˆ‘ä»¬æä¾›çš„å•å…ƒæµ‹è¯•æ˜¯ä¸ºäº†å¸®åŠ©æŒ‡å¯¼ä½ çš„å®æ–½ï¼Œä½†å®ƒä»¬å¹¶ä¸æ‰“ç®—æ˜¯å…¨é¢çš„æˆ–å»ºç«‹æ­£ç¡®æ€§ã€‚</p>
<p>You will need to add these new files to your release. The easiest way to do this is to change to your project directory (probably called simple-db-hw) and pull from the master GitHub repository:</p>
<p>ä½ å°†éœ€è¦æŠŠè¿™äº›æ–°æ–‡ä»¶æ·»åŠ åˆ°ä½ çš„ç‰ˆæœ¬ä¸­ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ¢åˆ°ä½ çš„é¡¹ç›®ç›®å½•ï¼ˆå¯èƒ½å«simple-db-hwï¼‰ï¼Œç„¶åä»GitHubçš„ä¸»ä»“åº“æ‹‰å‡ºã€‚</p>
<pre><code>$ cd simple-db-hw
$ git pull upstream master
</code></pre>
<h2 id="2-transactions-locking-and-concurrency-control"><a class="header" href="#2-transactions-locking-and-concurrency-control">2. Transactions, Locking, and Concurrency Control</a></h2>
<p>Before starting, you should make sure you understand what a transaction is and how strict two-phase locking (which you will use to ensure isolation and atomicity of your transactions) works.</p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ åº”è¯¥ç¡®ä¿ä½ äº†è§£ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Œä»¥åŠä¸¥æ ¼çš„ä¸¤é˜¶æ®µé”å®šï¼ˆä½ å°†ä½¿ç”¨å®ƒæ¥ç¡®ä¿äº‹åŠ¡çš„éš”ç¦»æ€§å’ŒåŸå­æ€§ï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>In the remainder of this section, we briefly overview these concepts and discuss how they relate to SimpleDB.</p>
<p>åœ¨æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç®€è¦åœ°æ¦‚è¿°è¿™äº›æ¦‚å¿µï¼Œå¹¶è®¨è®ºå®ƒä»¬ä¸SimpleDBçš„å…³ç³»ã€‚</p>
<h2 id="21-transactions"><a class="header" href="#21-transactions">2.1. Transactions</a></h2>
<p>A transaction is a group of database actions (e.g., inserts, deletes, and reads) that are executed atomically; that is, either all of the actions complete or none of them do, and it is not apparent to an outside observer of the database that these actions were not completed as a part of a single, indivisible action.</p>
<p>äº‹åŠ¡æ˜¯ä¸€ç»„åŸå­æ‰§è¡Œçš„æ•°æ®åº“æ“ä½œï¼ˆä¾‹å¦‚æ’å…¥ã€åˆ é™¤å’Œè¯»å–ï¼‰ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½å®Œæˆäº†ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰å®Œæˆï¼Œè€Œä¸”å¯¹äºæ•°æ®åº“çš„å¤–éƒ¨è§‚å¯Ÿè€…æ¥è¯´ï¼Œè¿™äº›æ“ä½œæ²¡æœ‰ä½œä¸ºä¸€ä¸ªå•ä¸€çš„ã€ä¸å¯åˆ†å‰²çš„æ“ä½œçš„ä¸€éƒ¨åˆ†å®Œæˆï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸æ˜æ˜¾çš„ã€‚</p>
<h2 id="22-the-acid-properties"><a class="header" href="#22-the-acid-properties">2.2. The ACID Properties</a></h2>
<p>To help you understand how transaction management works in SimpleDB, we briefly review how it ensures that the ACID properties are satisfied:</p>
<p>ä¸ºäº†å¸®åŠ©ä½ ç†è§£SimpleDBä¸­çš„äº‹åŠ¡ç®¡ç†æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•ç¡®ä¿ACIDå±æ€§å¾—åˆ°æ»¡è¶³çš„ã€‚</p>
<p>Atomicity: Strict two-phase locking and careful buffer management ensure atomicity.</p>
<p>åŸå­æ€§ï¼šä¸¥æ ¼çš„ä¸¤é˜¶æ®µé”å®šå’Œè°¨æ…çš„ç¼“å†²åŒºç®¡ç†ç¡®ä¿äº†åŸå­æ€§ã€‚</p>
<p>Consistency: The database is transaction consistent by virtue of atomicity. Other consistency issues (e.g., key constraints) are not addressed in SimpleDB.</p>
<p>ä¸€è‡´æ€§ï¼šç”±äºåŸå­æ€§ï¼Œæ•°æ®åº“æ˜¯äº‹åŠ¡ä¸€è‡´çš„ã€‚å…¶ä»–çš„ä¸€è‡´æ€§é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œé”®çº¦æŸï¼‰åœ¨SimpleDBä¸­æ²¡æœ‰è¢«è§£å†³ã€‚</p>
<p>Isolation: Strict two-phase locking provides isolation.</p>
<p>éš”ç¦»ï¼šä¸¥æ ¼çš„ä¸¤ç›¸é”å®šæä¾›éš”ç¦»ã€‚</p>
<p>Durability: A FORCE buffer management policy ensures durability (see Section 2.3 below).</p>
<p>æŒä¹…æ€§ã€‚FORCEçš„ç¼“å†²åŒºç®¡ç†æ”¿ç­–ç¡®ä¿äº†æŒä¹…æ€§ï¼ˆè§ä¸‹æ–‡2.3èŠ‚ï¼‰ã€‚</p>
<h2 id="23-recovery-and-buffer-management"><a class="header" href="#23-recovery-and-buffer-management">2.3. Recovery and Buffer Management</a></h2>
<p>To simplify your job, we recommend that you implement a NO STEAL/FORCE buffer management policy.</p>
<p>ä¸ºäº†ç®€åŒ–ä½ çš„å·¥ä½œï¼Œæˆ‘ä»¬å»ºè®®ä½ å®æ–½ &quot;ä¸å·ä¸æŠ¢ &quot;çš„ç¼“å†²åŒºç®¡ç†æ”¿ç­–ã€‚</p>
<p>As we discussed in class, this means that:</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨è¯¾å ‚ä¸Šè®¨è®ºçš„é‚£æ ·ï¼Œè¿™æ„å‘³ç€ã€‚</p>
<p>You shouldn't evict dirty (updated) pages from the buffer pool if they are locked by an uncommitted transaction (this is NO STEAL).</p>
<p>ä½ ä¸åº”è¯¥ä»ç¼“å†²æ± ä¸­é©±é€è„çš„ï¼ˆæ›´æ–°çš„ï¼‰é¡µé¢ï¼Œå¦‚æœå®ƒä»¬è¢«ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡é”å®šï¼ˆè¿™ä¸æ˜¯å·çªƒï¼‰ã€‚</p>
<p>On transaction commit, you should force dirty pages to disk (e.g., write the pages out) (this is FORCE).</p>
<p>åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä½ åº”è¯¥æŠŠè„é¡µå¼ºåˆ¶åˆ°ç£ç›˜ä¸Šï¼ˆä¾‹å¦‚ï¼ŒæŠŠé¡µå†™å‡ºæ¥ï¼‰ï¼ˆè¿™å°±æ˜¯FORCEï¼‰ã€‚</p>
<p>To further simplify your life, you may assume that SimpleDB will not crash while processing a transactionComplete command. Note that these three points mean that you do not need to implement log-based recovery in this lab, since you will never need to undo any work (you never evict dirty pages) and you will never need to redo any work (you force updates on commit and will not crash during commit processing).</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ä½ çš„ç”Ÿæ´»ï¼Œä½ å¯ä»¥å‡è®¾SimpleDBåœ¨å¤„ç†transactionCompleteå‘½ä»¤æ—¶ä¸ä¼šå´©æºƒã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸‰ç‚¹æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨è¿™ä¸ªå®éªŒä¸­å®ç°åŸºäºæ—¥å¿—çš„æ¢å¤ï¼Œå› ä¸ºä½ æ°¸è¿œä¸éœ€è¦æ’¤é”€ä»»ä½•å·¥ä½œï¼ˆä½ æ°¸è¿œä¸ä¼šé©±é€è„é¡µï¼‰ï¼Œä¹Ÿä¸éœ€è¦é‡åšä»»ä½•å·¥ä½œï¼ˆä½ åœ¨æäº¤æ—¶å¼ºåˆ¶æ›´æ–°ï¼Œä¸ä¼šåœ¨æäº¤å¤„ç†æœŸé—´å´©æºƒï¼‰ã€‚</p>
<h2 id="24-granting-locks"><a class="header" href="#24-granting-locks">2.4. Granting Locks</a></h2>
<p>You will need to add calls to SimpleDB (in BufferPool, for example), that allow a caller to request or release a (shared or exclusive) lock on a specific object on behalf of a specific transaction.</p>
<p>ä½ å°†éœ€è¦å¢åŠ å¯¹SimpleDBçš„è°ƒç”¨ï¼ˆä¾‹å¦‚åœ¨BufferPoolä¸­ï¼‰ï¼Œå…è®¸è°ƒç”¨è€…ä»£è¡¨ç‰¹å®šäº‹åŠ¡è¯·æ±‚æˆ–é‡Šæ”¾ç‰¹å®šå¯¹è±¡çš„ï¼ˆå…±äº«æˆ–ç‹¬å ï¼‰é”ã€‚</p>
<p>We recommend locking at page granularity; please do not implement table-level locking (even though it is possible) for simplicity of testing. The rest of this document and our unit tests assume page-level locking.</p>
<p>æˆ‘ä»¬å»ºè®®ä»¥é¡µä¸ºå•ä½è¿›è¡Œé”å®šï¼›ä¸ºäº†æµ‹è¯•çš„ç®€å•æ€§ï¼Œè¯·ä¸è¦å®ç°è¡¨çº§çš„é”å®šï¼ˆå°½ç®¡å®ƒæ˜¯å¯èƒ½çš„ï¼‰ã€‚æœ¬æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†å’Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•éƒ½æ˜¯å‡è®¾é¡µçº§é”çš„ã€‚</p>
<p>You will need to create data structures that keep track of which locks each transaction holds and check to see if a lock should be granted to a transaction when it is requested.</p>
<p>ä½ å°†éœ€è¦åˆ›å»ºæ•°æ®ç»“æ„æ¥è·Ÿè¸ªæ¯ä¸ªäº‹åŠ¡æŒæœ‰å“ªäº›é”ï¼Œå¹¶åœ¨äº‹åŠ¡è¢«è¯·æ±‚æ—¶æ£€æŸ¥æ˜¯å¦åº”è¯¥æˆäºˆå…¶é”ã€‚</p>
<p>You will need to implement shared and exclusive locks; recall that these work as follows:</p>
<p>ä½ å°†éœ€è¦å®ç°å…±äº«é”å’Œç‹¬å é”ï¼›å›é¡¾ä¸€ä¸‹ï¼Œè¿™äº›é”çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ã€‚</p>
<p>Before a transaction can read an object, it must have a shared lock on it.</p>
<p>åœ¨ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–ä¸€ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œå®ƒå¿…é¡»æœ‰ä¸€ä¸ªå…±äº«é”åœ¨ä¸Šé¢ã€‚</p>
<p>Before a transaction can write an object, it must have an exclusive lock on it.</p>
<p>åœ¨ä¸€ä¸ªäº‹åŠ¡å¯ä»¥å†™å…¥ä¸€ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œå®ƒå¿…é¡»æœ‰ä¸€ä¸ªç‹¬å é”ã€‚</p>
<p>Multiple transactions can have a shared lock on an object.</p>
<p>å¤šä¸ªäº‹åŠ¡å¯ä»¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šæ‹¥æœ‰ä¸€ä¸ªå…±äº«é”ã€‚</p>
<p>Only one transaction may have an exclusive lock on an object.</p>
<p>åªæœ‰ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šæ‹¥æœ‰ä¸€ä¸ªç‹¬å é”ã€‚</p>
<p>If transaction t is the only transaction holding a shared lock on an object o, t may upgrade its lock on o to an exclusive lock.</p>
<p>å¦‚æœäº‹åŠ¡tæ˜¯å”¯ä¸€åœ¨å¯¹è±¡oä¸ŠæŒæœ‰å…±äº«é”çš„äº‹åŠ¡ï¼Œtå¯ä»¥å°†å…¶å¯¹oçš„é”å‡çº§ä¸ºç‹¬å é”ã€‚</p>
<p>If a transaction requests a lock that cannot be immediately granted, your code should block, waiting for that lock to become available (i.e., be released by another transaction running in a different thread). Be careful about race conditions in your lock implementation --- think about how concurrent invocations to your lock may affect the behavior. (you way wish to read about Synchronization in Java).</p>
<p>å¦‚æœä¸€ä¸ªäº‹åŠ¡è¯·æ±‚ä¸€ä¸ªä¸èƒ½ç«‹å³æˆäºˆçš„é”ï¼Œä½ çš„ä»£ç åº”è¯¥é˜»å¡ï¼Œç­‰å¾…è¯¥é”å˜å¾—å¯ç”¨ï¼ˆå³ï¼Œè¢«å¦ä¸€ä¸ªåœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œçš„äº‹åŠ¡é‡Šæ”¾ï¼‰ã€‚åœ¨ä½ çš„é”çš„å®ç°ä¸­è¦å°å¿ƒç«äº‰æ¡ä»¶------è€ƒè™‘å¯¹ä½ çš„é”çš„å¹¶å‘è°ƒç”¨ä¼šå¦‚ä½•å½±å“ä½ çš„è¡Œä¸ºã€‚(ä½ å¯ä»¥é˜…è¯»å…³äºJavaä¸­çš„åŒæ­¥çš„æ–‡ç« ï¼‰ã€‚</p>
<h2 id="exercise-1"><a class="header" href="#exercise-1">Exercise 1.</a></h2>
<p>Write the methods that acquire and release locks in BufferPool. Assuming you are using page-level locking, you will need to complete the following:</p>
<p>ç¼–å†™BufferPoolä¸­è·å–å’Œé‡Šæ”¾é”çš„æ–¹æ³•ã€‚å‡è®¾ä½ ä½¿ç”¨çš„æ˜¯é¡µçº§é”ï¼Œä½ å°†éœ€è¦å®Œæˆä»¥ä¸‹å·¥ä½œã€‚</p>
<p>Modify getPage() to block and acquire the desired lock before returning a page.
Implement unsafeReleasePage(). This method is primarily used for testing, and at the end of transactions.
Implement holdsLock() so that logic in Exercise 2 can determine whether a page is already locked by a transaction.
You may find it helpful to define a LockManager class that is responsible for maintaining state about transactions and locks, but the design decision is up to you.</p>
<p>ä¿®æ”¹getPage()ï¼Œä½¿å…¶åœ¨è¿”å›é¡µé¢å‰é˜»å¡å¹¶è·å¾—æ‰€éœ€çš„é”ã€‚
å®ç°unsafeReleasePage()ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºæµ‹è¯•ï¼Œä»¥åŠåœ¨äº‹åŠ¡ç»“æŸæ—¶ä½¿ç”¨ã€‚
å®ç° holdsLock()ï¼Œä»¥ä¾¿ç»ƒä¹ 2ä¸­çš„é€»è¾‘èƒ½å¤Ÿç¡®å®šä¸€ä¸ªé¡µé¢æ˜¯å¦å·²ç»è¢«äº‹åŠ¡é”å®šã€‚
ä½ å¯èƒ½ä¼šå‘ç°ï¼Œå®šä¹‰ä¸€ä¸ªLockManagerç±»æ¥è´Ÿè´£ç»´æŠ¤äº‹åŠ¡å’Œé”çš„çŠ¶æ€æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œä½†è®¾è®¡å†³å®šæƒåœ¨ä½ ã€‚</p>
<p>You may need to implement the next exercise before your code passes the unit tests in LockingTest.</p>
<p>åœ¨ä½ çš„ä»£ç é€šè¿‡LockingTestçš„å•å…ƒæµ‹è¯•ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦å®ç°ä¸‹ä¸€ä¸ªç»ƒä¹ ã€‚</p>
<h2 id="25-lock-lifetime"><a class="header" href="#25-lock-lifetime">2.5. Lock Lifetime</a></h2>
<p>You will need to implement strict two-phase locking. This means that transactions should acquire the appropriate type of lock on any object before accessing that object and shouldn't release any locks until after the transaction commits.</p>
<p>ä½ å°†éœ€è¦å®ç°ä¸¥æ ¼çš„ä¸¤é˜¶æ®µé”ã€‚è¿™æ„å‘³ç€äº‹åŠ¡åœ¨è®¿é—®ä»»ä½•å¯¹è±¡ä¹‹å‰åº”è¯¥è·å¾—ç›¸åº”ç±»å‹çš„é”ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ä¸åº”è¯¥é‡Šæ”¾ä»»ä½•é”ã€‚</p>
<p>Fortunately, the SimpleDB design is such that it is possible to obtain locks on pages in BufferPool.getPage() before you read or modify them. So, rather than adding calls to locking routines in each of your operators, we recommend acquiring locks in getPage(). Depending on your implementation, it is possible that you may not have to acquire a lock anywhere else. It is up to you to verify this!</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSimpleDBçš„è®¾è®¡æ˜¯è¿™æ ·çš„ï¼šåœ¨ä½ è¯»å–æˆ–ä¿®æ”¹é¡µé¢ä¹‹å‰ï¼Œæœ‰å¯èƒ½åœ¨BufferPool.getPage()ä¸­è·å¾—é¡µé¢çš„é”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®åœ¨getPage()ä¸­è·å–é”ï¼Œè€Œä¸æ˜¯åœ¨ä½ çš„æ¯ä¸ªæ“ä½œä¸­æ·»åŠ å¯¹é”ç¨‹åºçš„è°ƒç”¨ã€‚æ ¹æ®ä½ çš„å®ç°ï¼Œä½ æœ‰å¯èƒ½ä¸éœ€è¦åœ¨å…¶ä»–åœ°æ–¹è·å–é”ã€‚è¿™è¦é ä½ è‡ªå·±å»éªŒè¯!</p>
<p>You will need to acquire a shared lock on any page (or tuple) before you read it, and you will need to acquire an exclusive lock on any page (or tuple) before you write it. You will notice that we are already passing around Permissions objects in the BufferPool; these objects indicate the type of lock that the caller would like to have on the object being accessed (we have given you the code for the Permissions class.)</p>
<p>ä½ éœ€è¦åœ¨è¯»å–ä»»ä½•é¡µé¢ï¼ˆæˆ–å…ƒç»„ï¼‰ä¹‹å‰è·å¾—ä¸€ä¸ªå…±äº«é”ï¼Œä½ éœ€è¦åœ¨å†™å…¥ä»»ä½•é¡µé¢ï¼ˆæˆ–å…ƒç»„ï¼‰ä¹‹å‰è·å¾—ä¸€ä¸ªç‹¬å é”ã€‚ä½ ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å·²ç»åœ¨BufferPoolä¸­ä¼ é€’äº†è®¸å¯å¯¹è±¡ï¼›è¿™äº›å¯¹è±¡è¡¨æ˜è°ƒç”¨è€…å¸Œæœ›å¯¹è¢«è®¿é—®å¯¹è±¡æ‹¥æœ‰çš„é”çš„ç±»å‹ï¼ˆæˆ‘ä»¬å·²ç»ç»™äº†ä½ è®¸å¯ç±»çš„ä»£ç ã€‚ï¼‰</p>
<p>Note that your implementation of HeapFile.insertTuple() and HeapFile.deleteTuple(), as well as the implementation of the iterator returned by HeapFile.iterator() should access pages using BufferPool.getPage(). Double check that these different uses of getPage() pass the correct permissions object (e.g., Permissions.READ_WRITE or Permissions.READ_ONLY). You may also wish to double check that your implementation of BufferPool.insertTuple() and BufferPool.deleteTupe() call markDirty() on any of the pages they access (you should have done this when you implemented this code in lab 2, but we did not test for this case.)</p>
<p>è¯·æ³¨æ„ï¼Œä½ å¯¹HeapFile.insertTuple()å’ŒHeapFile.deleteTuple()çš„å®ç°ï¼Œä»¥åŠHeapFile.iterator()è¿”å›çš„è¿­ä»£å™¨çš„å®ç°åº”è¯¥ä½¿ç”¨BufferPool.getPage()è®¿é—®é¡µé¢ã€‚ä»”ç»†æ£€æŸ¥è¿™äº›getPage()çš„ä¸åŒç”¨æ³•æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„æƒé™å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼ŒPermissions.READ_WRITE æˆ– Permissions.READ_ONLYï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ä»”ç»†æ£€æŸ¥ä½ å®ç°çš„BufferPool.insertTuple()å’ŒBufferPool.deleteTupe()æ˜¯å¦åœ¨å®ƒä»¬è®¿é—®çš„ä»»ä½•é¡µé¢ä¸Šè°ƒç”¨markDirty()ï¼ˆä½ åœ¨å®éªŒ2ä¸­å®ç°è¿™æ®µä»£ç æ—¶åº”è¯¥è¿™æ ·åšï¼Œä½†æˆ‘ä»¬æ²¡æœ‰æµ‹è¯•è¿™ç§æƒ…å†µï¼‰ã€‚</p>
<p>After you have acquired locks, you will need to think about when to release them as well. It is clear that you should release all locks associated with a transaction after it has committed or aborted to ensure strict 2PL. However, it is possible for there to be other scenarios in which releasing a lock before a transaction ends might be useful. For instance, you may release a shared lock on a page after scanning it to find empty slots (as described below).</p>
<p>åœ¨ä½ è·å¾—é”ä¹‹åï¼Œä½ ä¹Ÿéœ€è¦è€ƒè™‘ä½•æ—¶é‡Šæ”¾å®ƒä»¬ã€‚å¾ˆæ˜æ˜¾ï¼Œä½ åº”è¯¥åœ¨ä¸€ä¸ªäº‹åŠ¡æäº¤æˆ–ä¸­æ­¢åé‡Šæ”¾æ‰€æœ‰ä¸ä¹‹ç›¸å…³çš„é”ï¼Œä»¥ç¡®ä¿ä¸¥æ ¼çš„2PLã€‚ç„¶è€Œï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œåœ¨äº‹åŠ¡ç»“æŸå‰é‡Šæ”¾é”å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨æ‰«æé¡µé¢æ‰¾åˆ°ç©ºæ§½åé‡Šæ”¾ä¸€ä¸ªå…±äº«é”ï¼ˆå¦‚ä¸‹æ‰€è¿°ï¼‰ã€‚</p>
<h2 id="exercise-2"><a class="header" href="#exercise-2">Exercise 2.</a></h2>
<p>Ensure that you acquire and release locks throughout SimpleDB. Some (but not necessarily all) actions that you should verify work properly:</p>
<p>ç¡®ä¿ä½ åœ¨æ•´ä¸ªSimpleDBè·å¾—å’Œé‡Šæ”¾é”ã€‚ä¸€äº›ï¼ˆä½†ä¸ä¸€å®šæ˜¯å…¨éƒ¨ï¼‰ä½ åº”è¯¥éªŒè¯çš„æ“ä½œæ­£å¸¸å·¥ä½œã€‚</p>
<p>Reading tuples off of pages during a SeqScan (if you implemented locking in BufferPool.getPage(), this should work correctly as long as your HeapFile.iterator() uses BufferPool.getPage().)</p>
<p>åœ¨SeqScanè¿‡ç¨‹ä¸­ä»é¡µé¢ä¸Šè¯»å– tupleï¼ˆå¦‚æœä½ åœ¨BufferPool.getPage()ä¸­å®ç°äº†é”å®šï¼Œåªè¦ä½ çš„HeapFile.iterator()ä½¿ç”¨BufferPool.getPage()ï¼Œè¿™åº”è¯¥å¯ä»¥æ­£ç¡®å·¥ä½œã€‚ï¼‰</p>
<p>Inserting and deleting tuples through BufferPool and HeapFile methods (if you implemented locking in BufferPool.getPage(), this should work correctly as long as HeapFile.insertTuple() and HeapFile.deleteTuple() use BufferPool.getPage().)
You will also want to think especially hard about acquiring and releasing locks in the following situations:</p>
<p>é€šè¿‡BufferPoolå’ŒHeapFileæ–¹æ³•æ’å…¥å’Œåˆ é™¤å›¾å…ƒï¼ˆå¦‚æœä½ åœ¨BufferPool.getPage()ä¸­å®ç°äº†é”ï¼Œåªè¦HeapFile.insertTuple()å’ŒHeapFile.deleteTuple()ä½¿ç”¨BufferPool.getPage()ï¼Œè¿™åº”è¯¥èƒ½æ­£ç¡®å·¥ä½œã€‚ï¼‰
ä½ è¿˜éœ€è¦ç‰¹åˆ«è€ƒè™‘åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è·å–å’Œé‡Šæ”¾é”çš„é—®é¢˜ã€‚</p>
<p>Adding a new page to a HeapFile. When do you physically write the page to disk? Are there race conditions with other transactions (on other threads) that might need special attention at the HeapFile level, regardless of page-level locking?</p>
<p>å‘HeapFileæ·»åŠ ä¸€ä¸ªæ–°çš„é¡µé¢ã€‚ä½ ä»€ä¹ˆæ—¶å€™æŠŠè¿™ä¸ªé¡µé¢å†™åˆ°ç£ç›˜ä¸Šï¼Ÿæ˜¯å¦å­˜åœ¨ä¸å…¶ä»–äº‹åŠ¡ï¼ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸Šï¼‰çš„ç«èµ›æ¡ä»¶ï¼Œå¯èƒ½éœ€è¦åœ¨HeapFileçº§åˆ«ä¸Šç‰¹åˆ«æ³¨æ„ï¼Œè€Œä¸è€ƒè™‘é¡µçº§é”å®šï¼Ÿ</p>
<p>Looking for an empty slot into which you can insert tuples. Most implementations scan pages looking for an empty slot, and will need a READ_ONLY lock to do this. Surprisingly, however, if a transaction t finds no free slot on a page p, t may immediately release the lock on p. Although this apparently contradicts the rules of two-phase locking, it is ok because t did not use any data from the page, such that a concurrent transaction t' which updated p cannot possibly effect the answer or outcome of t.</p>
<p>å¯»æ‰¾ä¸€ä¸ªå¯ä»¥æ’å…¥å›¾å…ƒçš„ç©ºæ§½ã€‚å¤§å¤šæ•°å®ç°éƒ½ä¼šæ‰«æé¡µé¢ï¼Œå¯»æ‰¾ä¸€ä¸ªç©ºæ§½ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªREAD_ONLYé”æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ç„¶è€Œï¼Œä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡tå‘ç°é¡µé¢pä¸Šæ²¡æœ‰ç©ºæ§½ï¼Œtå¯ä»¥ç«‹å³é‡Šæ”¾pä¸Šçš„é”ã€‚è™½ç„¶è¿™æ˜¾ç„¶ä¸ä¸¤é˜¶æ®µé”çš„è§„åˆ™ç›¸çŸ›ç›¾ï¼Œä½†å®ƒæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºtæ²¡æœ‰ä½¿ç”¨é¡µé¢ä¸Šçš„ä»»ä½•æ•°æ®ï¼Œè¿™æ ·ï¼Œä¸€ä¸ªæ›´æ–°pçš„å¹¶å‘äº‹åŠ¡t'ä¸å¯èƒ½å½±å“tçš„ç­”æ¡ˆæˆ–ç»“æœã€‚</p>
<p>At this point, your code should pass the unit tests in LockingTest.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡LockingTestä¸­çš„å•å…ƒæµ‹è¯•ã€‚</p>
<h2 id="26-implementing-no-steal"><a class="header" href="#26-implementing-no-steal">2.6. Implementing NO STEAL</a></h2>
<p>Modifications from a transaction are written to disk only after it commits. This means we can abort a transaction by discarding the dirty pages and rereading them from disk. Thus, we must not evict dirty pages. This policy is called NO STEAL.</p>
<p>ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹åªæœ‰åœ¨å®ƒæäº¤ä¹‹åæ‰ä¼šè¢«å†™å…¥ç£ç›˜ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¢å¼ƒè„é¡µå¹¶ä»ç£ç›˜é‡è¯»æ¥ä¸­æ­¢ä¸€ä¸ªäº‹åŠ¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä¸é©±é€è„é¡µã€‚è¿™ä¸ªç­–ç•¥è¢«ç§°ä¸ºNO STEALã€‚</p>
<p>You will need to modify the evictPage method in BufferPool. In particular, it must never evict a dirty page. If your eviction policy prefers a dirty page for eviction, you will have to find a way to evict an alternative page. In the case where all pages in the buffer pool are dirty, you should throw a DbException. If your eviction policy evicts a clean page, be mindful of any locks transactions may already hold to the evicted page and handle them appropriately in your implementation.</p>
<p>ä½ å°†éœ€è¦ä¿®æ”¹BufferPoolä¸­çš„evictPageæ–¹æ³•ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒå¿…é¡»æ°¸è¿œä¸é©±é€ä¸€ä¸ªè„é¡µã€‚å¦‚æœä½ çš„é©±é€ç­–ç•¥å€¾å‘äºé©±é€ä¸€ä¸ªè„é¡µï¼Œä½ å°†ä¸å¾—ä¸æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥é©±é€ä¸€ä¸ªæ›¿ä»£é¡µã€‚åœ¨ç¼“å†²æ± ä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯è„çš„æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠ›å‡ºä¸€ä¸ªDbExceptionã€‚å¦‚æœä½ çš„é©±é€ç­–ç•¥é©±é€äº†ä¸€ä¸ªå¹²å‡€çš„é¡µé¢ï¼Œè¦æ³¨æ„äº‹åŠ¡å¯èƒ½å·²ç»æŒæœ‰è¢«é©±é€çš„é¡µé¢çš„ä»»ä½•é”ï¼Œå¹¶åœ¨ä½ çš„å®ç°ä¸­é€‚å½“åœ°å¤„ç†å®ƒä»¬ã€‚</p>
<h2 id="exercise-3"><a class="header" href="#exercise-3">Exercise 3.</a></h2>
<p>Implement the necessary logic for page eviction without evicting dirty pages in the evictPage method in BufferPool.</p>
<p>åœ¨BufferPoolçš„evictPageæ–¹æ³•ä¸­å®ç°å¿…è¦çš„é¡µé¢é©±é€é€»è¾‘ï¼Œè€Œä¸é©±é€è„é¡µã€‚</p>
<h2 id="27-transactions"><a class="header" href="#27-transactions">2.7. Transactions</a></h2>
<p>In SimpleDB, a TransactionId object is created at the beginning of each query. This object is passed to each of the operators involved in the query. When the query is complete, the BufferPool method transactionComplete is called.</p>
<p>åœ¨SimpleDBä¸­ï¼Œæ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªTransactionIdå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡è¢«ä¼ é€’ç»™æ¯ä¸ªå‚ä¸æŸ¥è¯¢çš„æ“ä½œè€…ã€‚å½“æŸ¥è¯¢å®Œæˆåï¼ŒBufferPoolæ–¹æ³• transactionCompleteè¢«è°ƒç”¨ã€‚</p>
<p>Calling this method either commits or aborts the transaction, specified by the parameter flag commit. At any point during its execution, an operator may throw a TransactionAbortedException exception, which indicates an internal error or deadlock has occurred. The test cases we have provided you with create the appropriate TransactionId objects, pass them to your operators in the appropriate way, and invoke transactionComplete when a query is finished. We have also implemented TransactionId.</p>
<p>è°ƒç”¨æ­¤æ–¹æ³•å¯ä»¥æäº¤æˆ–ä¸­æ­¢äº‹åŠ¡ï¼Œç”±å‚æ•°æ ‡å¿—commitæŒ‡å®šã€‚åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»ä½•æ—¶å€™ï¼Œæ“ä½œè€…éƒ½å¯ä»¥æŠ›å‡ºä¸€ä¸ªTransactionAbortedExceptionå¼‚å¸¸ï¼Œè¿™è¡¨æ˜å‘ç”Ÿäº†å†…éƒ¨é”™è¯¯æˆ–æ­»é”ã€‚æˆ‘ä»¬ä¸ºä½ æä¾›çš„æµ‹è¯•æ¡ˆä¾‹åˆ›å»ºäº†é€‚å½“çš„TransactionIdå¯¹è±¡ï¼Œä»¥é€‚å½“çš„æ–¹å¼å°†å®ƒä»¬ä¼ é€’ç»™ä½ çš„æ“ä½œè€…ï¼Œå¹¶åœ¨æŸ¥è¯¢å®Œæˆåè°ƒç”¨ transactionCompleteã€‚æˆ‘ä»¬è¿˜å®ç°äº†TransactionIdã€‚</p>
<h2 id="exercise-4"><a class="header" href="#exercise-4">Exercise 4.</a></h2>
<p>Implement the transactionComplete() method in BufferPool. Note that there are two versions of transactionComplete, one which accepts an additional boolean commit argument, and one which does not. The version without the additional argument should always commit and so can simply be implemented by calling transactionComplete(tid, true).</p>
<p>åœ¨BufferPoolä¸­å®ç°transactionComplete()æ–¹æ³•ã€‚è¯·æ³¨æ„ï¼ŒtransactionCompleteæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯æ¥å—é¢å¤–çš„å¸ƒå°”æäº¤å‚æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸æ¥å—ã€‚æ²¡æœ‰é¢å¤–å‚æ•°çš„ç‰ˆæœ¬åº”è¯¥æ€»æ˜¯æäº¤ï¼Œæ‰€ä»¥å¯ä»¥ç®€å•åœ°é€šè¿‡è°ƒç”¨ transactionComplete(tid, true) æ¥å®ç°ã€‚</p>
<p>When you commit, you should flush dirty pages associated to the transaction to disk. When you abort, you should revert any changes made by the transaction by restoring the page to its on-disk state.</p>
<p>å½“ä½ æäº¤æ—¶ï¼Œä½ åº”è¯¥å°†ä¸äº‹åŠ¡ç›¸å…³çš„è„é¡µå†²åˆ°ç£ç›˜ä¸Šã€‚å½“ä½ æ”¾å¼ƒçš„æ—¶å€™ï¼Œä½ åº”è¯¥é€šè¿‡æ¢å¤é¡µé¢åˆ°ç£ç›˜ä¸Šçš„çŠ¶æ€æ¥æ¢å¤äº‹åŠ¡æ‰€åšçš„ä»»ä½•æ”¹å˜ã€‚</p>
<p>Whether the transaction commits or aborts, you should also release any state the BufferPool keeps regarding the transaction, including releasing any locks that the transaction held.</p>
<p>æ— è®ºäº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯ä¸­æ­¢ï¼Œä½ éƒ½åº”è¯¥é‡Šæ”¾BufferPoolä¿å­˜çš„å…³äºè¯¥äº‹åŠ¡çš„ä»»ä½•çŠ¶æ€ï¼ŒåŒ…æ‹¬é‡Šæ”¾è¯¥äº‹åŠ¡æŒæœ‰çš„ä»»ä½•é”ã€‚</p>
<p>At this point, your code should pass the TransactionTest unit test and the AbortEvictionTest system test. You may find the TransactionTest system test illustrative, but it will likely fail until you complete the next exercise.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çš„ä»£ç åº”è¯¥é€šè¿‡TransactionTestå•å…ƒæµ‹è¯•å’ŒAbortEvictionTestç³»ç»Ÿæµ‹è¯•ã€‚ä½ å¯èƒ½ä¼šå‘ç°TransactionTestç³»ç»Ÿæµ‹è¯•çš„è¯´æ˜æ€§ï¼Œä½†åœ¨ä½ å®Œæˆä¸‹ä¸€ä¸ªç»ƒä¹ ä¹‹å‰ï¼Œå®ƒå¯èƒ½ä¼šå¤±è´¥ã€‚</p>
<h2 id="28-deadlocks-and-aborts"><a class="header" href="#28-deadlocks-and-aborts">2.8. Deadlocks and Aborts</a></h2>
<p>It is possible for transactions in SimpleDB to deadlock (if you do not understand why, we recommend reading about deadlocks in Ramakrishnan &amp; Gehrke). You will need to detect this situation and throw a TransactionAbortedException.</p>
<p>SimpleDBä¸­çš„äº‹åŠ¡æœ‰å¯èƒ½å‡ºç°æ­»é”ï¼ˆå¦‚æœä½ ä¸æ˜ç™½ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬å»ºè®®é˜…è¯»Ramakrishnan &amp; Gehrkeä¸­å…³äºæ­»é”çš„å†…å®¹ï¼‰ã€‚ä½ éœ€è¦æ£€æµ‹è¿™ç§æƒ…å†µå¹¶æŠ›å‡ºä¸€ä¸ªTransactionAbortedExceptionã€‚</p>
<p>There are many possible ways to detect deadlock. A strawman example would be to implement a simple timeout policy that aborts a transaction if it has not completed after a given period of time. For a real solution, you may implement cycle-detection in a dependency graph data structure as shown in lecture. In this scheme, you would check for cycles in a dependency graph periodically or whenever you attempt to grant a new lock, and abort something if a cycle exists. After you have detected that a deadlock exists, you must decide how to improve the situation. Assume you have detected a deadlock while transaction t is waiting for a lock. If you're feeling homicidal, you might abort all transactions that t is waiting for; this may result in a large amount of work being undone, but you can guarantee that t will make progress. Alternately, you may decide to abort t to give other transactions a chance to make progress. This means that the end-user will have to retry transaction t.</p>
<p>æœ‰è®¸å¤šå¯èƒ½çš„æ–¹æ³•æ¥æ£€æµ‹æ­»é”ã€‚ä¸€ä¸ªè‰æ ¹çš„ä¾‹å­æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„è¶…æ—¶ç­–ç•¥ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨ç»™å®šçš„æ—¶é—´å†…è¿˜æ²¡æœ‰å®Œæˆï¼Œå°±ä¸­æ­¢å®ƒã€‚å¯¹äºä¸€ä¸ªçœŸæ­£çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªä¾èµ–å›¾æ•°æ®ç»“æ„ä¸­å®ç°å‘¨æœŸæ£€æµ‹ï¼Œå¦‚è®²åº§ä¸­æ‰€ç¤ºã€‚åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä½ å°†å®šæœŸæ£€æŸ¥ä¾èµ–å›¾ä¸­çš„å‘¨æœŸï¼Œæˆ–è€…æ¯å½“ä½ è¯•å›¾æˆäºˆä¸€ä¸ªæ–°çš„é”æ—¶ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå‘¨æœŸï¼Œå°±ä¸­æ­¢æŸäº‹ã€‚åœ¨ä½ æ£€æµ‹åˆ°æ­»é”å­˜åœ¨åï¼Œä½ å¿…é¡»å†³å®šå¦‚ä½•æ”¹å–„è¿™ç§æƒ…å†µã€‚å‡è®¾ä½ åœ¨äº‹åŠ¡tç­‰å¾…é”çš„æ—¶å€™æ£€æµ‹åˆ°äº†ä¸€ä¸ªæ­»é”ã€‚å¦‚æœä½ æœ‰æ€äººçš„å†²åŠ¨ï¼Œä½ å¯ä»¥ä¸­æ­¢tæ­£åœ¨ç­‰å¾…çš„æ‰€æœ‰äº‹åŠ¡ï¼›è¿™å¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„å·¥ä½œè¢«æ’¤é”€ï¼Œä½†ä½ å¯ä»¥ä¿è¯tä¼šå–å¾—è¿›å±•ã€‚å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å†³å®šä¸­æ­¢tï¼Œç»™å…¶ä»–äº‹åŠ¡ä¸€ä¸ªå–å¾—è¿›å±•çš„æœºä¼šã€‚è¿™æ„å‘³ç€ç»ˆç«¯ç”¨æˆ·å°†ä¸å¾—ä¸é‡è¯•äº‹åŠ¡tã€‚</p>
<p>Another approach is to use global orderings of transactions to avoid building the wait-for graph. This is sometimes preferred for performance reasons, but transactions that could have succeeded can be aborted by mistake under this scheme. Examples include the WAIT-DIE and WOUND-WAIT schemes.</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨äº‹åŠ¡çš„å…¨å±€æ’åºæ¥é¿å…å»ºç«‹ç­‰å¾…å›¾ã€‚å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œè¿™æœ‰æ—¶æ˜¯é¦–é€‰ï¼Œä½†æ˜¯åœ¨è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œæœ¬æ¥å¯ä»¥æˆåŠŸçš„äº‹åŠ¡å¯èƒ½ä¼šè¢«é”™è¯¯åœ°ä¸­æ­¢ã€‚ä¾‹å­åŒ…æ‹¬WAIT-DIEå’ŒWOUND-WAITæ–¹æ¡ˆã€‚</p>
<h2 id="exercise-5"><a class="header" href="#exercise-5">Exercise 5.</a></h2>
<p>Implement deadlock detection or prevention in src/simpledb/BufferPool.java. You have many design decisions for your deadlock handling system, but it is not necessary to do something highly sophisticated. We expect you to do better than a simple timeout on each transaction. A good starting point will be to implement cycle-detection in a wait-for graph before every lock request, and you will receive full credit for such an implementation. Please describe your choices in the lab writeup and list the pros and cons of your choice compared to the alternatives.</p>
<p>åœ¨ src/simpledb/BufferPool.java ä¸­å®ç°æ­»é”æ£€æµ‹æˆ–é¢„é˜²ã€‚å¯¹äºä½ çš„æ­»é”å¤„ç†ç³»ç»Ÿï¼Œä½ æœ‰å¾ˆå¤šè®¾è®¡å†³å®šï¼Œä½†æ²¡æœ‰å¿…è¦åšä¸€äº›éå¸¸å¤æ‚çš„äº‹æƒ…ã€‚æˆ‘ä»¬å¸Œæœ›ä½ èƒ½åšå¾—æ¯”æ¯ä¸ªäº‹åŠ¡çš„ç®€å•è¶…æ—¶æ›´å¥½ã€‚ä¸€ä¸ªå¥½çš„èµ·ç‚¹æ˜¯åœ¨æ¯ä¸ªé”è¯·æ±‚å‰çš„ç­‰å¾…å›¾ä¸­å®ç°å‘¨æœŸæ£€æµ‹ï¼Œè¿™æ ·çš„å®ç°å°†å¾—åˆ°å…¨é¢å¥–åŠ±ã€‚è¯·åœ¨å®éªŒæŠ¥å‘Šä¸­æè¿°ä½ çš„é€‰æ‹©ï¼Œå¹¶åˆ—å‡ºä½ çš„é€‰æ‹©ä¸å…¶ä»–é€‰æ‹©ç›¸æ¯”çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<p>You should ensure that your code aborts transactions properly when a deadlock occurs, by throwing a TransactionAbortedException exception. This exception will be caught by the code executing the transaction (e.g., TransactionTest.java), which should call transactionComplete() to cleanup after the transaction. You are not expected to automatically restart a transaction which fails due to a deadlock -- you can assume that higher level code will take care of this.</p>
<p>ä½ åº”è¯¥é€šè¿‡æŠ›å‡ºTransactionAbortedExceptionå¼‚å¸¸æ¥ç¡®ä¿ä½ çš„ä»£ç åœ¨å‘ç”Ÿæ­»é”æ—¶æ­£ç¡®ä¸­æ­¢äº‹åŠ¡ã€‚è¿™ä¸ªå¼‚å¸¸å°†è¢«æ‰§è¡Œäº‹åŠ¡çš„ä»£ç æ‰€æ•è·ï¼ˆä¾‹å¦‚ï¼ŒTransactionTest.javaï¼‰ï¼Œå®ƒåº”è¯¥è°ƒç”¨ transactionComplete() æ¥æ¸…ç†äº‹åŠ¡ã€‚æˆ‘ä»¬ä¸æœŸæœ›ä½ è‡ªåŠ¨é‡å¯ä¸€ä¸ªå› æ­»é”è€Œå¤±è´¥çš„äº‹åŠ¡--ä½ å¯ä»¥å‡è®¾æ›´é«˜çº§åˆ«çš„ä»£ç ä¼šå¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>We have provided some (not-so-unit) tests in test/simpledb/DeadlockTest.java. They are actually a bit involved, so they may take more than a few seconds to run (depending on your policy). If they seem to hang indefinitely, then you probably have an unresolved deadlock. These tests construct simple deadlock situations that your code should be able to escape.</p>
<p>æˆ‘ä»¬åœ¨test/simpledb/DeadlockTest.javaä¸­æä¾›äº†ä¸€äº›ï¼ˆä¸æ˜¯å•å…ƒçš„ï¼‰æµ‹è¯•ã€‚å®ƒä»¬å®é™…ä¸Šæœ‰ç‚¹å¤æ‚ï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½éœ€è¦è¶…è¿‡å‡ ç§’é’Ÿçš„æ—¶é—´æ¥è¿è¡Œï¼ˆå–å†³äºä½ çš„ç­–ç•¥ï¼‰ã€‚å¦‚æœå®ƒä»¬ä¼¼ä¹æ— é™æœŸåœ°æŒ‚èµ·ï¼Œé‚£ä¹ˆä½ å¯èƒ½æœ‰ä¸€ä¸ªæœªè§£å†³çš„æ­»é”ã€‚è¿™äº›æµ‹è¯•æ„å»ºäº†ç®€å•çš„æ­»é”æƒ…å†µï¼Œä½ çš„ä»£ç åº”è¯¥èƒ½å¤Ÿé€ƒè„±ã€‚</p>
<p>Note that there are two timing parameters near the top of DeadLockTest.java; these determine the frequency at which the test checks if locks have been acquired and the waiting time before an aborted transaction is restarted. You may observe different performance characteristics by tweaking these parameters if you use a timeout-based detection method. The tests will output TransactionAbortedExceptions corresponding to resolved deadlocks to the console.</p>
<p>æ³¨æ„ï¼Œåœ¨DeadLockTest.javaçš„é¡¶éƒ¨é™„è¿‘æœ‰ä¸¤ä¸ªè®¡æ—¶å‚æ•°ï¼›è¿™äº›å‚æ•°å†³å®šäº†æµ‹è¯•æ£€æŸ¥æ˜¯å¦å·²ç»è·å¾—é”çš„é¢‘ç‡ï¼Œä»¥åŠä¸­æ­¢çš„äº‹åŠ¡è¢«é‡æ–°å¯åŠ¨å‰çš„ç­‰å¾…æ—¶é—´ã€‚å¦‚æœä½ ä½¿ç”¨åŸºäºè¶…æ—¶çš„æ£€æµ‹æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒæ•´è¿™äº›å‚æ•°è§‚å¯Ÿåˆ°ä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚æµ‹è¯•å°†æŠŠè§£å†³æ­»é”å¯¹åº”çš„TransactionAbortedExceptionsè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p>
<p>Your code should now should pass the TransactionTest system test (which may also run for quite a long time depending on your implementation).</p>
<p>ä½ çš„ä»£ç ç°åœ¨åº”è¯¥é€šè¿‡TransactionTestç³»ç»Ÿæµ‹è¯•ï¼ˆæ ¹æ®ä½ çš„å®ç°ï¼Œå®ƒä¹Ÿå¯èƒ½è¿è¡Œç›¸å½“é•¿çš„æ—¶é—´ï¼‰ã€‚</p>
<p>At this point, you should have a recoverable database, in the sense that if the database system crashes (at a point other than transactionComplete()) or if the user explicitly aborts a transaction, the effects of any running transaction will not be visible after the system restarts (or the transaction aborts.) You may wish to verify this by running some transactions and explicitly killing the database server.</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ åº”è¯¥æœ‰ä¸€ä¸ªå¯æ¢å¤çš„æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ•°æ®åº“ç³»ç»Ÿå´©æºƒï¼ˆåœ¨ transactionComplete() ä»¥å¤–çš„åœ°æ–¹ï¼‰ï¼Œæˆ–è€…å¦‚æœç”¨æˆ·æ˜¾å¼åœ°ä¸­æ­¢ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆåœ¨ç³»ç»Ÿé‡æ–°å¯åŠ¨ï¼ˆæˆ–è€…äº‹åŠ¡ä¸­æ­¢ï¼‰ä¹‹åï¼Œä»»ä½•æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡çš„å½±å“å°†ä¸å¯è§ã€‚ ä½ å¯èƒ½å¸Œæœ›é€šè¿‡è¿è¡Œä¸€äº›äº‹åŠ¡å’Œæ˜¾å¼åœ°æ€æ­»æ•°æ®åº“æœåŠ¡å™¨æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="29-design-alternatives"><a class="header" href="#29-design-alternatives">2.9. Design alternatives</a></h2>
<p>During the course of this lab, we have identified some substantial design choices that you have to make:</p>
<p>åœ¨è¿™ä¸ªå®éªŒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šäº†ä¸€äº›ä½ å¿…é¡»åšå‡ºçš„å®è´¨æ€§è®¾è®¡é€‰æ‹©ã€‚</p>
<p>Locking granularity: page-level versus tuple-level
Deadlock handling: detection vs. prevention, aborting yourself vs. others.
Bonus Exercise 6. (20% extra credit)</p>
<p>é”å®šé¢—ç²’åº¦ï¼šé¡µçº§ä¸å…ƒç»„çº§
æ­»é”å¤„ç†ï¼šæ£€æµ‹ä¸é¢„é˜²ï¼Œç»ˆæ­¢è‡ªå·±ä¸ç»ˆæ­¢ä»–äººã€‚
å¥–åŠ±ç»ƒä¹ 6. (20%çš„é¢å¤–å­¦åˆ†)</p>
<p>For one or more of these choices, implement both alternatives and experimentally compare their performance charateristics. Include your benchmarking code and a brief evaluation (possibly with graphs) in your writeup.</p>
<p>å¯¹äºè¿™äº›é€‰æ‹©ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå®ç°ä¸¤ç§é€‰æ‹©ï¼Œå¹¶é€šè¿‡å®éªŒæ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½ç‰¹å¾ã€‚åœ¨ä½ çš„æ–‡ç« ä¸­åŒ…æ‹¬ä½ çš„åŸºå‡†ä»£ç å’Œç®€çŸ­çš„è¯„ä¼°ï¼ˆå¯èƒ½æœ‰å›¾è¡¨ï¼‰ã€‚</p>
<p>You have now completed this lab. Good work!</p>
<p>ä½ ç°åœ¨å·²ç»å®Œæˆäº†è¿™ä¸ªå®éªŒã€‚å¹²å¾—å¥½!</p>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../../6.830/cn/4-lab3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../6.830/cn/6-lab5.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../../6.830/cn/4-lab3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../../6.830/cn/6-lab5.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "6.830/cn/5-lab4.md"
    </script>


    <!-- Custom JS scripts -->


</body>
</html>